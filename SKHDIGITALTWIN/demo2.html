<!DOCTYPE html>
<html lang="zh-TW" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>醫療戰情中心 & AI 決策模擬器 (Demo 2)</title>
    
    <script src="[https://cdn.tailwindcss.com](https://cdn.tailwindcss.com)"></script>
    <script src="[https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js](https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js)"></script>
    <script src="[https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js](https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js)"></script>
    <link href="[https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600&display=swap](https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600&display=swap)" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dashboard: {
                            bg: '#121212',
                            card: '#1E1E1E',
                            border: '#333333',
                            accent: '#42A5F5',
                            alert: '#EF5350',
                            warning: '#FFA726',
                            success: '#66BB6A',
                            text: '#E0E0E0',
                            muted: '#9E9E9E'
                        }
                    },
                    fontFamily: {
                        mono:,
                        sans: ['"Inter"', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #121212; color: #E0E0E0; }
       .chart-container { position: relative; height: 100%; width: 100%; overflow: hidden; }
        /* 自定義捲軸 */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1E1E1E; }
        ::-webkit-scrollbar-thumb { background: #424242; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #616161; }
        
        /* 閃爍動畫用於緊急警報 */
        @keyframes pulse-alert {
            0% { box-shadow: 0 0 0 0 rgba(239, 83, 80, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(239, 83, 80, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 83, 80, 0); }
        }
       .animate-pulse-alert {
            animation: pulse-alert 2s infinite;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden font-sans text-sm">

    <div id="app" class="flex h-full">
        
        <aside class="w-80 flex-shrink-0 bg-dashboard-card border-r border-dashboard-border flex flex-col z-20 shadow-lg">
            <div class="p-4 border-b border-dashboard-border">
                <h1 class="text-xl font-bold text-dashboard-accent tracking-wider flex items-center gap-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                    MCC SIMULATOR
                </h1>
                <p class="text-xs text-dashboard-muted mt-1">AI-Driven Patient Flow Digital Twin</p>
            </div>

            <div class="flex-1 overflow-y-auto p-4 space-y-8">
                
                <div class="space-y-4">
                    <h3 class="text-xs font-bold text-dashboard-accent uppercase tracking-widest border-l-2 border-dashboard-accent pl-2">環境變數 (Environment)</h3>
                    
                    <div>
                        <div class="flex justify-between mb-1">
                            <label class="text-xs text-gray-400">氣溫 (Temperature)</label>
                            <span :class="{'text-dashboard-alert': params.temperature > 32, 'text-dashboard-success': params.temperature <= 32}" class="font-mono">{{ params.temperature }}°C</span>
                        </div>
                        <input type="range" v-model.number="params.temperature" min="10" max="40" step="1" class="w-full accent-dashboard-accent h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                        <p class="text-[10px] text-gray-500 mt-1" v-if="params.temperature > 32">⚠️ 高溫將增加 N17 (腎衰竭) 與 I20 (心血管) 入院率</p>
                    </div>

                    <div>
                        <div class="flex justify-between mb-1">
                            <label class="text-xs text-gray-400">流感嚴重度 (Flu Severity)</label>
                            <span class="font-mono text-dashboard-warning">Lv {{ params.fluIndex }}</span>
                        </div>
                        <input type="range" v-model.number="params.fluIndex" min="1" max="10" step="1" class="w-full accent-dashboard-warning h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                        <p class="text-[10px] text-gray-500 mt-1">影響 J10/J11 呼吸道疾病入院量</p>
                    </div>
                </div>

                <div class="space-y-4">
                    <h3 class="text-xs font-bold text-dashboard-accent uppercase tracking-widest border-l-2 border-dashboard-accent pl-2">營運參數 (Operations)</h3>
                    
                    <div>
                        <div class="flex justify-between mb-1">
                            <label class="text-xs text-gray-400">護理人力 (Nurse Staffing)</label>
                            <span class="font-mono">{{ params.staffingLevel }}%</span>
                        </div>
                        <input type="range" v-model.number="params.staffingLevel" min="50" max="120" step="5" class="w-full accent-dashboard-success h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                    </div>

                    <div>
                        <div class="flex justify-between mb-1">
                            <label class="text-xs text-gray-400">床位周轉時間 (Turnover Time)</label>
                            <span class="font-mono">{{ params.turnoverTime }} min</span>
                        </div>
                        <input type="range" v-model.number="params.turnoverTime" min="30" max="240" step="15" class="w-full accent-purple-500 h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                        <p class="text-[10px] text-gray-500 mt-1">影響急診滯留時間 (Boarding Time)</p>
                    </div>

                    <div class="flex items-center justify-between py-2 border-t border-gray-800">
                        <label class="text-xs text-gray-400">大量傷患模式 (MCI Mode)</label>
                        <button 
                            @click="toggleMCI"
                            :class="params.isMCI? 'bg-dashboard-alert animate-pulse-alert' : 'bg-gray-700'"
                            class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none">
                            <span :class="params.isMCI? 'translate-x-6' : 'translate-x-1'" class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"></span>
                        </button>
                    </div>
                </div>

                <div class="flex-1 min-h-[150px] bg-black/30 rounded p-2 font-mono text-[10px] overflow-y-auto border border-gray-800">
                    <div v-for="(log, idx) in logs" :key="idx" class="mb-1" :class="log.type === 'alert'? 'text-red-400' : 'text-gray-500'">
                        <span class="opacity-50">[{{ log.time }}]</span> {{ log.msg }}
                    </div>
                </div>
            </div>
        </aside>

        <main class="flex-1 flex flex-col min-w-0 bg-dashboard-bg">
            
            <header class="h-16 border-b border-dashboard-border flex items-center justify-between px-6 bg-dashboard-bg/95 backdrop-blur z-10">
                <div class="flex items-center gap-4">
                    <h2 class="text-lg font-semibold">Hospital Command Center</h2>
                    <span class="px-2 py-0.5 rounded text-xs border" 
                          :class="systemStatus.class">
                        {{ systemStatus.text }}
                    </span>
                </div>
                <div class="flex items-center gap-6 font-mono">
                    <div class="text-right">
                        <div class="text-xs text-dashboard-muted">SIMULATION TIME</div>
                        <div class="text-lg text-dashboard-accent">{{ currentTime }}</div>
                    </div>
                    <div class="h-8 w-px bg-dashboard-border"></div>
                    <div class="text-right">
                        <div class="text-xs text-dashboard-muted">NEDOCS SCORE</div>
                        <div class="text-2xl font-bold" :class="nedocsColor">{{ nedocsScore }}</div>
                    </div>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto p-6">
                <div class="grid grid-cols-12 gap-6 auto-rows-min">
                    
                    <div class="col-span-3 bg-dashboard-card rounded-lg p-4 border border-dashboard-border relative overflow-hidden group hover:border-dashboard-accent transition-colors">
                        <div class="absolute top-0 right-0 p-2 opacity-10 text-dashboard-accent">
                            <svg class="w-16 h-16" fill="currentColor" viewBox="0 0 20 20"><path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z"></path><path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z"></path></svg>
                        </div>
                        <h4 class="text-dashboard-muted text-xs uppercase mb-1">預測今日總入院數</h4>
                        <div class="text-3xl font-mono font-bold">{{ metrics.predictedAdmissions }} <span class="text-sm text-dashboard-muted font-normal">人</span></div>
                        <div class="mt-2 text-xs flex items-center gap-1" :class="metrics.admissionTrend > 0? 'text-dashboard-alert' : 'text-dashboard-success'">
                            <span v-if="metrics.admissionTrend > 0">▲</span><span v-else>▼</span>
                            {{ Math.abs(metrics.admissionTrend) }}% vs 30-day avg
                        </div>
                    </div>

                    <div class="col-span-3 bg-dashboard-card rounded-lg p-4 border border-dashboard-border relative overflow-hidden">
                        <h4 class="text-dashboard-muted text-xs uppercase mb-1">急診擁塞指標 (NEDOCS)</h4>
                        <div class="flex items-end gap-2">
                            <div class="text-3xl font-mono font-bold" :class="nedocsColor">{{ nedocsScore }}</div>
                            <div class="text-xs pb-1 text-dashboard-muted">/ 200</div>
                        </div>
                        <div class="w-full bg-gray-700 h-1.5 mt-3 rounded-full overflow-hidden">
                            <div class="h-full transition-all duration-500" 
                                 :class="{'bg-dashboard-success': nedocsScore < 60, 'bg-dashboard-warning': nedocsScore >= 60 && nedocsScore < 100, 'bg-dashboard-alert': nedocsScore >= 100}"
                                 :style="{width: Math.min(nedocsScore/2, 100) + '%'}"></div>
                        </div>
                    </div>

                    <div class="col-span-3 bg-dashboard-card rounded-lg p-4 border border-dashboard-border">
                        <h4 class="text-dashboard-muted text-xs uppercase mb-1">目前住院佔床率</h4>
                        <div class="text-3xl font-mono font-bold">{{ metrics.occupancyRate }}%</div>
                        <div class="mt-2 text-xs text-dashboard-muted">
                            空床: <span class="text-dashboard-success font-bold">{{ metrics.availableBeds }}</span> / 總床: {{ metrics.totalBeds }}
                        </div>
                    </div>

                    <div class="col-span-3 bg-dashboard-card rounded-lg p-4 border border-dashboard-border">
                        <h4 class="text-dashboard-muted text-xs uppercase mb-1">未看診離院率 (LWBS)</h4>
                        <div class="text-3xl font-mono font-bold" :class="metrics.lwbs > 5? 'text-dashboard-alert' : 'text-dashboard-text'">{{ metrics.lwbs }}%</div>
                        <div class="mt-2 text-xs text-dashboard-muted">
                            等待人數: <span class="font-bold">{{ metrics.waitingCount }}</span> 人
                        </div>
                    </div>

                    <div class="col-span-8 bg-dashboard-card rounded-lg border border-dashboard-border flex flex-col h-[400px]">
                        <div class="p-4 border-b border-dashboard-border flex justify-between items-center">
                            <div>
                                <h3 class="font-semibold text-dashboard-text">AI 入院流量預測 (24H)</h3>
                                <p class="text-xs text-dashboard-muted">包含 95% 信心區間 (Confidence Interval)</p>
                            </div>
                            <div class="flex items-center gap-2 text-xs">
                                <span class="w-3 h-3 rounded-full bg-dashboard-accent opacity-50"></span> 預測範圍
                                <span class="w-3 h-3 rounded-sm bg-dashboard-accent"></span> 預測均值
                            </div>
                        </div>
                        <div class="flex-1 p-2 relative">
                            <div ref="predictionChart" class="chart-container"></div>
                        </div>
                    </div>

                    <div class="col-span-4 flex flex-col gap-6">
                        
                        <div class="flex-1 bg-dashboard-card rounded-lg border border-dashboard-border flex flex-col overflow-hidden">
                            <div class="p-4 border-b border-dashboard-border bg-dashboard-card z-10">
                                <h3 class="font-semibold text-dashboard-text flex items-center gap-2">
                                    <svg class="w-4 h-4 text-dashboard-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                                    AI 決策建議
                                </h3>
                            </div>
                            <div class="flex-1 overflow-y-auto p-4 space-y-3">
                                <div v-if="recommendations.length === 0" class="text-center text-dashboard-muted py-10 text-xs">
                                    目前系統運作正常，無特殊建議。
                                </div>
                                <div v-for="(rec, idx) in recommendations" :key="idx" 
                                     class="p-3 rounded border-l-4 bg-black/20 hover:bg-black/40 transition-colors cursor-pointer"
                                     :class="{
                                         'border-dashboard-alert': rec.priority === 'high',
                                         'border-dashboard-warning': rec.priority === 'medium',
                                         'border-dashboard-success': rec.priority === 'low'
                                     }">
                                    <div class="flex justify-between items-start mb-1">
                                        <span class="text-xs font-bold uppercase" 
                                              :class="{
                                                  'text-dashboard-alert': rec.priority === 'high',
                                                  'text-dashboard-warning': rec.priority === 'medium',
                                                  'text-dashboard-success': rec.priority === 'low'
                                              }">{{ rec.type }}</span>
                                        <span class="text-[10px] text-dashboard-muted">{{ rec.time }}</span>
                                    </div>
                                    <p class="text-sm font-medium">{{ rec.message }}</p>
                                    <div class="mt-2 text-[10px] text-gray-500 font-mono">
                                        因子: {{ rec.factors }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="h-48 bg-dashboard-card rounded-lg border border-dashboard-border flex flex-col">
                             <div class="p-3 border-b border-dashboard-border">
                                <h3 class="text-xs font-semibold text-dashboard-text uppercase">高風險 ICD-10 趨勢</h3>
                            </div>
                            <div class="flex-1 p-2 overflow-y-auto">
                                <table class="w-full text-left text-xs">
                                    <thead>
                                        <tr class="text-dashboard-muted border-b border-gray-800">
                                            <th class="pb-2 pl-2">Code</th>
                                            <th class="pb-2">Diagnosis</th>
                                            <th class="pb-2 text-right">Trend</th>
                                        </tr>
                                    </thead>
                                    <tbody class="font-mono">
                                        <tr v-for="d in topDiseases" :key="d.code" class="border-b border-gray-800/50 last:border-0">
                                            <td class="py-2 pl-2 text-dashboard-accent">{{ d.code }}</td>
                                            <td class="py-2 text-gray-400 truncate max-w-[120px]">{{ d.name }}</td>
                                            <td class="py-2 text-right">
                                                <span :class="d.trend > 0? 'text-dashboard-alert' : 'text-dashboard-success'">
                                                    {{ d.trend > 0? '+' : ''}}{{ d.trend }}%
                                                </span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </main>

    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                // --- State ---
                const params = ref({
                    temperature: 28, // 攝氏度
                    fluIndex: 2, // 1-10
                    staffingLevel: 100, // %
                    turnoverTime: 120, // minutes
                    isMCI: false // Mass Casualty Incident
                });

                const metrics = ref({
                    predictedAdmissions: 145,
                    admissionTrend: 5,
                    occupancyRate: 85,
                    totalBeds: 500,
                    availableBeds: 75,
                    lwbs: 2.1,
                    waitingCount: 12
                });

                const logs = ref();
                const recommendations = ref();
                const currentTime = ref(new Date().toLocaleTimeString('en-US', {hour12: false, hour: '2-digit', minute:'2-digit'}));
                
                // Charts instances
                let chartInstance = null;

                // --- Computed Logic for Simulation ---

                // NEDOCS Score Calculation (Simplified Simulation)
                // NEDOCS = -20 + 85.8(Ladmit) + 600(Lresp) + 13.4(Nvent) + 0.93(OED) + 5.64(Twait)
                // We simulate these components based on our sliders
                const nedocsScore = computed(() => {
                    let baseScore = 40; 
                    
                    // Environmental Impact
                    if (params.value.temperature > 32) baseScore += (params.value.temperature - 32) * 3; // Heatwave effect
                    baseScore += params.value.fluIndex * 4; // Flu effect
                    
                    // Staffing Impact (Lower staffing = higher score)
                    if (params.value.staffingLevel < 100) baseScore += (100 - params.value.staffingLevel) * 1.5;
                    
                    // Turnover Time Impact
                    baseScore += (params.value.turnoverTime - 60) * 0.2;

                    // MCI Impact
                    if (params.value.isMCI) baseScore += 80;

                    // Random noise
                    return Math.min(200, Math.floor(baseScore + (Math.random() * 10 - 5)));
                });

                const nedocsColor = computed(() => {
                    const s = nedocsScore.value;
                    if (s > 100) return 'text-dashboard-alert animate-pulse';
                    if (s > 60) return 'text-dashboard-warning';
                    return 'text-dashboard-success';
                });

                const systemStatus = computed(() => {
                    if (params.value.isMCI) return { text: 'CODE BLACK (MCI)', class: 'bg-red-900 text-white border-red-500 animate-pulse' };
                    if (nedocsScore.value > 100) return { text: 'DANGEROUS OVERCROWDING', class: 'bg-red-900/50 text-red-200 border-red-500' };
                    if (nedocsScore.value > 60) return { text: 'BUSY', class: 'bg-yellow-900/30 text-yellow-500 border-yellow-600' };
                    return { text: 'NORMAL OPERATIONS', class: 'bg-green-900/30 text-green-400 border-green-600' };
                });

                const topDiseases = computed(() => {
                    const list =;
                    // Heat related
                    if (params.value.temperature > 30) {
                        list.push({ code: 'N17.9', name: 'Acute Kidney Failure', trend: Math.floor((params.value.temperature - 25) * 4) });
                        list.push({ code: 'I20.9', name: 'Angina Pectoris', trend: Math.floor((params.value.temperature - 25) * 2.5) });
                        list.push({ code: 'T67.0', name: 'Heatstroke', trend: Math.floor((params.value.temperature - 30) * 15) });
                    }
                    // Flu related
                    if (params.value.fluIndex > 3) {
                        list.push({ code: 'J10.1', name: 'Influenza w/ resp', trend: params.value.fluIndex * 8 });
                        list.push({ code: 'J18.9', name: 'Pneumonia, unsp.', trend: params.value.fluIndex * 5 });
                    }
                    // Baseline
                    list.push({ code: 'I50.9', name: 'Heart Failure', trend: 2 });
                    list.push({ code: 'A41.9', name: 'Sepsis, unspec', trend: 5 + (params.value.fluIndex * 2) }); // Sepsis correlates with flu complications

                    return list.sort((a, b) => b.trend - a.trend).slice(0, 5);
                });

                // --- Methods ---

                const addLog = (msg, type = 'info') => {
                    logs.value.unshift({
                        time: new Date().toLocaleTimeString('en-US', {hour12: false}),
                        msg,
                        type
                    });
                    if (logs.value.length > 50) logs.value.pop();
                };

                const updateAIRecommendations = () => {
                    const recs =;
                    
                    if (params.value.isMCI) {
                        recs.push({
                            type: 'CRITICAL',
                            message: '啟動大量傷患機制 (Code Triage)。暫停所有非緊急手術，釋出 ICU 床位。',
                            priority: 'high',
                            factors: 'MCI Mode Active',
                            time: 'Now'
                        });
                    }

                    if (nedocsScore.value > 100) {
                        recs.push({
                            type: 'CAPACITY',
                            message: '啟動滿床機制 (Full Capacity Protocol)。建議開放 5B 病房作為臨時留觀區。',
                            priority: 'high',
                            factors: `NEDOCS ${nedocsScore.value} > 100`,
                            time: 'Now'
                        });
                    }

                    if (params.value.temperature > 35) {
                        recs.push({
                            type: 'CLINICAL',
                            message: '預測 N17 (腎衰竭) 病患將在 48 小時內增加 30%。建議通知腎臟科值班醫師待命。',
                            priority: 'medium',
                            factors: `Temp ${params.value.temperature}°C > 35°C`,
                            time: 'Forecast +4h'
                        });
                    }

                    if (params.value.staffingLevel < 80) {
                        recs.push({
                            type: 'STAFFING',
                            message: '護理人力不足，預測 LWBS 將上升至 8%。建議調度休假人員或啟動跨單位支援。',
                            priority: 'medium',
                            factors: `Staffing ${params.value.staffingLevel}%`,
                            time: 'Now'
                        });
                    }

                    recommendations.value = recs;
                };

                const toggleMCI = () => {
                    params.value.isMCI =!params.value.isMCI;
                    addLog(params.value.isMCI? '啟動大量傷患模式 (MCI ACTIVATED)' : '解除大量傷患模式 (MCI DEACTIVATED)', 'alert');
                };

                // Generate Mock Data for Chart
                const generateChartData = () => {
                    const now = new Date();
                    const hours =;
                    const dataMean =;
                    const dataLower =;
                    const dataUpper =;

                    // Base load sine wave
                    const baseLoad = 10 + (params.value.fluIndex * 2) + (params.value.isMCI? 50 : 0);
                    
                    for (let i = 0; i < 24; i++) {
                        const t = new Date(now.getTime() + i * 3600000);
                        hours.push(t.getHours() + ':00');
                        
                        // Simulation Logic: Peak at 10am and 6pm
                        const hourVal = t.getHours();
                        const timeFactor = Math.sin((hourVal - 8) / 24 * Math.PI * 2); 
                        
                        let val = baseLoad + (timeFactor * 5);
                        
                        // Add Temperature Lag effect
                        if (params.value.temperature > 32 && i > 4) val += (params.value.temperature - 32);

                        // Random noise
                        val += Math.random() * 4;

                        // Confidence Interval (uncertainty increases with time)
                        const uncertainty = 2 + (i * 0.5) + (params.value.fluIndex * 0.5); 

                        dataMean.push(Math.floor(val));
                        dataLower.push(Math.floor(val - uncertainty));
                        dataUpper.push(Math.floor(val + uncertainty));
                    }

                    return { hours, dataMean, dataLower, dataUpper };
                };

                const initCharts = () => {
                    const chartDom = document.querySelector('[ref="predictionChart"]'); // Note: Vue ref usage inside template logic below
                    // Actually accessing via refs in setup
                };
                
                // --- Lifecycle & Watchers ---

                onMounted(() => {
                    // Update Time
                    setInterval(() => {
                        currentTime.value = new Date().toLocaleTimeString('en-US', {hour12: false, hour: '2-digit', minute:'2-digit'});
                    }, 1000);

                    // Initialize Chart
                    chartInstance = echarts.init(document.querySelector('.chart-container'));
                    
                    const updateChart = () => {
                        const { hours, dataMean, dataLower, dataUpper } = generateChartData();
                        
                        // metrics update based on chart
                        const totalPred = dataMean.reduce((a, b) => a + b, 0);
                        metrics.value.predictedAdmissions = totalPred;
                        metrics.value.lwbs = (2 + (nedocsScore.value / 40) + (100 - params.value.staffingLevel)/10).toFixed(1);
                        metrics.value.occupancyRate = Math.min(100, Math.floor(80 + (totalPred / 50) - (params.value.turnoverTime / 60)));
                        metrics.value.availableBeds = Math.floor(metrics.value.totalBeds * (1 - metrics.value.occupancyRate/100));

                        const option = {
                            backgroundColor: 'transparent',
                            tooltip: {
                                trigger: 'axis',
                                backgroundColor: 'rgba(30,30,30,0.9)',
                                borderColor: '#333',
                                textStyle: { color: '#fff' }
                            },
                            grid: { left: '3%', right: '4%', bottom: '3%', top: '10%', containLabel: true },
                            xAxis: {
                                type: 'category',
                                boundaryGap: false,
                                data: hours,
                                axisLine: { lineStyle: { color: '#555' } },
                                axisLabel: { color: '#999' }
                            },
                            yAxis: {
                                type: 'value',
                                splitLine: { lineStyle: { color: '#333' } },
                                axisLabel: { color: '#999' }
                            },
                            series:) // Stack logic needs difference
                                },
                                {
                                    name: 'Predicted Admissions',
                                    type: 'line',
                                    symbol: 'circle',
                                    symbolSize: 6,
                                    itemStyle: { color: '#42A5F5' },
                                    lineStyle: { width: 3 },
                                    data: dataMean
                                }
                            ]
                        };
                        chartInstance.setOption(option);
                    };

                    // Initial render
                    updateChart();
                    updateAIRecommendations();

                    // Reactive Loop
                    watch(params, () => {
                        updateChart();
                        updateAIRecommendations();
                        addLog('Simulation parameters updated. Recalculating models...');
                    }, { deep: true });

                    // Simulate Live Data Ticks
                    setInterval(() => {
                         // Random small fluctuation
                         if(Math.random() > 0.7) {
                             metrics.value.waitingCount += Math.floor(Math.random() * 3) - 1;
                             if(metrics.value.waitingCount < 0) metrics.value.waitingCount = 0;
                         }
                    }, 2000);
                    
                    // Resize handler
                    window.addEventListener('resize', () => chartInstance && chartInstance.resize());
                });

                return {
                    params,
                    metrics,
                    logs,
                    recommendations,
                    currentTime,
                    nedocsScore,
                    nedocsColor,
                    systemStatus,
                    topDiseases,
                    toggleMCI
                };
            }
        }).mount('#app');
    </script>
</body>
</html>