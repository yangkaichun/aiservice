<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>放射腫瘤科營運績效戰情室</title>
    <link rel="icon" href="image/feticon.ico" type="image/x-icon">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome 6 (Icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* Custom Scrollbar for Sidebar */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animations */
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        body { font-family: 'Microsoft JhengHei', 'Segoe UI', Roboto, sans-serif; background-color: #f8fafc; }
        
        /* Table Styles */
        .data-table th { @apply bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider py-3 px-4; }
        .data-table td { @apply whitespace-nowrap text-sm text-gray-700 py-3 px-4 border-b border-gray-100; }
        .data-table tr:hover { @apply bg-gray-50; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Mock Data Generators ---
        const generateDailyData = () => {
            const hours = Array.from({length: 12}, (_, i) => `${i+8}:00`);
            const revenue = hours.map(() => Math.floor(Math.random() * 50000) + 20000);
            const costs = hours.map(() => Math.floor(Math.random() * 20000) + 10000);
            return { labels: hours, revenue, costs };
        };

        const generateTDABCData = () => [
            { role: '主治醫師', time: 25, costPerMin: 80, total: 2000 },
            { role: '醫學物理師', time: 40, costPerMin: 45, total: 1800 },
            { role: '放射師', time: 15, costPerMin: 35, total: 525 },
            { role: '護理師', time: 10, costPerMin: 25, total: 250 },
            { role: '行政人員', time: 10, costPerMin: 15, total: 150 },
        ];

        // --- Components ---

        // 1. Recursive Menu Component
        const MenuItem = ({ item, level = 0, onSelect, currentView }) => {
            const [isOpen, setIsOpen] = useState(level < 2); // Default open top levels
            const hasChildren = item.children && item.children.length > 0;
            const paddingLeft = level * 16 + 20;
            
            // Check if this item or any child is currently active to highlight parent
            const isActive = item.view === currentView;

            const handleClick = (e) => {
                e.stopPropagation();
                if (hasChildren) {
                    setIsOpen(!isOpen);
                } else if (item.view) {
                    onSelect(item.view);
                }
            };

            return (
                <div className="text-sm select-none">
                    <div 
                        className={`flex items-center py-3 px-4 cursor-pointer transition-all duration-200 border-l-4
                            ${isActive 
                                ? 'bg-cyan-50 border-cyan-600 text-cyan-700 font-bold' 
                                : 'border-transparent hover:bg-gray-50 text-gray-600'}`}
                        style={{ paddingLeft: `${paddingLeft}px` }}
                        onClick={handleClick}
                    >
                        <div className={`w-5 flex justify-center mr-3 ${isActive ? 'text-cyan-600' : 'text-gray-400'}`}>
                            <i className={`fa-solid ${item.icon} text-sm`}></i>
                        </div>
                        <span className="flex-1 truncate">{item.title}</span>
                        {hasChildren && (
                            <i className={`fa-solid fa-chevron-down text-[10px] transition-transform duration-200 text-gray-400 ${isOpen ? 'transform rotate-180' : ''}`}></i>
                        )}
                    </div>
                    
                    {hasChildren && isOpen && (
                        <div className="border-l border-gray-100 ml-6">
                            {item.children.map((child, idx) => (
                                <MenuItem key={idx} item={child} level={level + 1} onSelect={onSelect} currentView={currentView} />
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // 2. Charts
        const LineChart = ({ title, color }) => {
            const canvasRef = useRef(null);
            const chartRef = useRef(null);

            useEffect(() => {
                if (!canvasRef.current) return;
                const ctx = canvasRef.current.getContext('2d');
                const { labels, revenue, costs } = generateDailyData();
                if (chartRef.current) chartRef.current.destroy();

                chartRef.current = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            { label: '門診營收', data: revenue, borderColor: '#0891b2', backgroundColor: 'rgba(8, 145, 178, 0.1)', tension: 0.4, fill: true },
                            { label: '營運成本', data: costs, borderColor: '#ef4444', borderDash: [5, 5], tension: 0.4 }
                        ]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { position: 'top', align: 'end', labels: { usePointStyle: true, boxWidth: 6 } } },
                        scales: { y: { grid: { borderDash: [2, 4] }, beginAtZero: true }, x: { grid: { display: false } } }
                    }
                });
                return () => { if (chartRef.current) chartRef.current.destroy(); };
            }, []);

            return (
                <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 h-80 flex flex-col">
                    <h3 className="text-gray-700 font-bold mb-4 flex items-center gap-2"><i className="fa-solid fa-chart-line text-cyan-600"></i> {title}</h3>
                    <div className="flex-1 relative"><canvas ref={canvasRef}></canvas></div>
                </div>
            );
        };

        // 3. Detailed Views (The Content that changes)
        
        // --- Dashboard View ---
        const DashboardView = () => (
            <div className="space-y-6 fade-in">
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div className="bg-white p-5 rounded-xl shadow-sm border border-gray-100 flex justify-between items-start hover:shadow-md transition">
                        <div><p className="text-gray-500 text-xs font-bold uppercase">今日門診收入</p><h4 className="text-2xl font-bold text-gray-800 mt-1">NT$ 185,400</h4><p className="text-xs text-green-500 mt-2 font-bold"><i className="fa-solid fa-arrow-up"></i> +12%</p></div>
                        <div className="p-3 bg-cyan-100 text-cyan-600 rounded-lg"><i className="fa-solid fa-sack-dollar text-xl"></i></div>
                    </div>
                    <div className="bg-white p-5 rounded-xl shadow-sm border border-gray-100 flex justify-between items-start hover:shadow-md transition">
                        <div><p className="text-gray-500 text-xs font-bold uppercase">健保申報點數</p><h4 className="text-2xl font-bold text-gray-800 mt-1">245,000</h4><p className="text-xs text-green-500 mt-2 font-bold"><i className="fa-solid fa-check"></i> 98% 達成</p></div>
                        <div className="p-3 bg-blue-100 text-blue-600 rounded-lg"><i className="fa-solid fa-file-invoice-dollar text-xl"></i></div>
                    </div>
                    <div className="bg-white p-5 rounded-xl shadow-sm border border-gray-100 flex justify-between items-start hover:shadow-md transition">
                        <div><p className="text-gray-500 text-xs font-bold uppercase">治療人次</p><h4 className="text-2xl font-bold text-gray-800 mt-1">42 人</h4><p className="text-xs text-orange-500 mt-2 font-bold"><i className="fa-solid fa-arrow-right"></i> 持平</p></div>
                        <div className="p-3 bg-orange-100 text-orange-600 rounded-lg"><i className="fa-solid fa-user-group text-xl"></i></div>
                    </div>
                    <div className="bg-white p-5 rounded-xl shadow-sm border border-gray-100 flex justify-between items-start hover:shadow-md transition">
                        <div><p className="text-gray-500 text-xs font-bold uppercase">儀器妥善率</p><h4 className="text-2xl font-bold text-gray-800 mt-1">99.2%</h4><p className="text-xs text-green-500 mt-2 font-bold"><i className="fa-solid fa-bolt"></i> 運轉正常</p></div>
                        <div className="p-3 bg-emerald-100 text-emerald-600 rounded-lg"><i className="fa-solid fa-microchip text-xl"></i></div>
                    </div>
                </div>
                
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div className="lg:col-span-2"><LineChart title="每日營運收入與成本趨勢" /></div>
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex flex-col">
                        <h3 className="text-gray-700 font-bold mb-4 text-sm flex items-center gap-2"><i className="fa-solid fa-stopwatch text-cyan-600"></i> 設備負載概況</h3>
                        <div className="space-y-6 flex-1 overflow-y-auto">
                            {[
                                { name: 'Elekta Versa HD', load: 85, status: '運轉中', color: 'bg-green-500' },
                                { name: 'Varian TrueBeam', load: 60, status: '待機中', color: 'bg-yellow-500' },
                                { name: 'CT-Sim', load: 45, status: '排程空檔', color: 'bg-blue-500' }
                            ].map((m, i) => (
                                <div key={i}>
                                    <div className="flex justify-between text-sm mb-1">
                                        <span className="font-medium text-gray-700">{m.name}</span>
                                        <span className="text-xs text-gray-500">{m.status} ({m.load}%)</span>
                                    </div>
                                    <div className="w-full bg-gray-100 rounded-full h-2.5">
                                        <div className={`${m.color} h-2.5 rounded-full`} style={{width: `${m.load}%`}}></div>
                                    </div>
                                </div>
                            ))}
                        </div>
                        <div className="mt-4 p-3 bg-gray-50 rounded border border-gray-100 text-xs text-gray-500">
                            <i className="fa-solid fa-circle-info mr-1"></i> 資料來源：HIS/排程系統即時同步
                        </div>
                    </div>
                </div>
            </div>
        );

        // --- Financial Tables View ---
        const FinancialView = ({ type }) => {
            const titleMap = {
                'nhi_trend': '健保點值收入 - 每日趨勢',
                'nhi_status': '健保申報狀態列表',
                'self_vmat': '自費療程 - VMAT 營收',
                'self_sbrt': '自費療程 - SBRT/SRS 營收',
                'daily_reg': '每日門診 - 掛號費統計',
                'daily_part': '每日門診 - 部分負擔統計'
            };

            return (
                <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden fade-in h-full flex flex-col">
                    <div className="p-6 border-b border-gray-100 flex justify-between items-center bg-slate-50">
                        <h2 className="text-lg font-bold text-gray-800 flex items-center gap-3">
                            <i className="fa-solid fa-table-list text-cyan-600"></i>
                            {titleMap[type] || '財務報表'}
                        </h2>
                        <button className="px-4 py-2 bg-white border border-gray-200 text-gray-600 rounded text-sm hover:bg-gray-50 shadow-sm">
                            <i className="fa-solid fa-download mr-2"></i>匯出 Excel
                        </button>
                    </div>
                    <div className="overflow-x-auto flex-1 p-6">
                        <table className="min-w-full w-full text-left border-collapse">
                            <thead>
                                <tr className="border-b-2 border-gray-100">
                                    <th className="p-4 text-sm font-bold text-gray-600">日期</th>
                                    <th className="p-4 text-sm font-bold text-gray-600">項目代碼 / 名稱</th>
                                    <th className="p-4 text-sm font-bold text-gray-600">病歷號</th>
                                    <th className="p-4 text-sm font-bold text-gray-600">負責醫師</th>
                                    <th className="p-4 text-sm font-bold text-gray-600 text-right">金額 / 點數</th>
                                    <th className="p-4 text-sm font-bold text-gray-600 text-center">狀態</th>
                                </tr>
                            </thead>
                            <tbody>
                                {[...Array(8)].map((_, i) => (
                                    <tr key={i} className="hover:bg-slate-50 border-b border-gray-50">
                                        <td className="p-4 text-sm text-gray-600">2023-11-{15-i}</td>
                                        <td className="p-4 text-sm text-gray-800 font-medium">{type.includes('nhi') ? '36012B 深部放射治療' : '自費 VMAT 弧形治療'}</td>
                                        <td className="p-4 text-sm text-gray-500 font-mono">8829{10+i}</td>
                                        <td className="p-4 text-sm text-gray-600">Dr. Chen</td>
                                        <td className="p-4 text-sm text-gray-800 font-bold font-mono text-right">{type.includes('nhi') ? '4,200' : '$ 12,000'}</td>
                                        <td className="p-4 text-center">
                                            <span className="px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full font-bold">已入帳</span>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    <div className="p-4 border-t border-gray-100 bg-gray-50 text-right text-sm text-gray-500">
                        資料來源：批價系統 (同步時間 10:45 AM)
                    </div>
                </div>
            );
        };

        // --- Cost/TDABC View ---
        const CostView = ({ type }) => {
            const data = generateTDABCData();
            
            if (type === 'energy_daily') {
                return (
                    <div className="space-y-6 fade-in">
                        <div className="grid grid-cols-3 gap-6">
                            <div className="bg-white p-6 rounded-xl shadow-sm border-l-4 border-yellow-400">
                                <h4 className="text-gray-500 text-xs font-bold uppercase">總用電量 (今日)</h4>
                                <p className="text-3xl font-bold text-gray-800 mt-2">485 <span className="text-sm text-gray-400">kWh</span></p>
                            </div>
                            <div className="bg-white p-6 rounded-xl shadow-sm border-l-4 border-red-400">
                                <h4 className="text-gray-500 text-xs font-bold uppercase">尖峰負載</h4>
                                <p className="text-3xl font-bold text-gray-800 mt-2">14:30 <span className="text-sm text-gray-400">PM</span></p>
                            </div>
                            <div className="bg-white p-6 rounded-xl shadow-sm border-l-4 border-green-400">
                                <h4 className="text-gray-500 text-xs font-bold uppercase">節能績效</h4>
                                <p className="text-3xl font-bold text-gray-800 mt-2">-5.2 <span className="text-sm text-gray-400">% YoY</span></p>
                            </div>
                        </div>
                        <LineChart title="24小時電力消耗監控 (kW)" />
                    </div>
                )
            }

            return (
                <div className="bg-white p-8 rounded-xl shadow-sm border border-gray-100 fade-in max-w-4xl mx-auto">
                    <h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                        <i className="fa-solid fa-stopwatch text-cyan-600"></i>
                        TDABC 人員時間驅動成本分析
                    </h2>
                    <div className="mb-6 bg-blue-50 p-4 rounded-lg text-sm text-blue-800 flex gap-3">
                         <i className="fa-solid fa-circle-info mt-0.5"></i>
                         <div>
                            <strong>計算公式：</strong> 單位成本 = (人員每分鐘成本費率 × 投入時間) <br/>
                            此模型用於計算單次放射治療療程中，各職類人員實際投入的資源成本。
                         </div>
                    </div>
                    <table className="w-full text-left border-collapse">
                        <thead>
                            <tr className="border-b-2 border-gray-200">
                                <th className="p-3 text-gray-600">職類 (Role)</th>
                                <th className="p-3 text-gray-600 text-right">投入時間 (分)</th>
                                <th className="p-3 text-gray-600 text-right">費率 ($/分)</th>
                                <th className="p-3 text-gray-600 text-right">單次成本小計</th>
                                <th className="p-3 text-gray-600">佔比</th>
                            </tr>
                        </thead>
                        <tbody>
                            {data.map((row, i) => (
                                <tr key={i} className="border-b border-gray-100 hover:bg-gray-50">
                                    <td className="p-3 font-medium text-gray-800">{row.role}</td>
                                    <td className="p-3 text-right font-mono text-gray-600">{row.time}</td>
                                    <td className="p-3 text-right font-mono text-gray-600">{row.costPerMin}</td>
                                    <td className="p-3 text-right font-bold font-mono text-gray-800">$ {row.total}</td>
                                    <td className="p-3">
                                        <div className="flex items-center gap-2">
                                            <div className="w-24 bg-gray-200 rounded-full h-1.5">
                                                <div className="bg-cyan-600 h-1.5 rounded-full" style={{width: `${(row.total/4725)*100}%`}}></div>
                                            </div>
                                            <span className="text-xs text-gray-400">{Math.round((row.total/4725)*100)}%</span>
                                        </div>
                                    </td>
                                </tr>
                            ))}
                            <tr className="bg-gray-50 font-bold">
                                <td className="p-4 text-gray-800">總計 (Total)</td>
                                <td className="p-4 text-right font-mono text-gray-800">100 min</td>
                                <td className="p-4"></td>
                                <td className="p-4 text-right font-mono text-red-600 text-lg">$ 4,725</td>
                                <td className="p-4"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            );
        };

        // --- Equipment Detail View ---
        const EquipmentView = ({ device }) => {
            const deviceDetails = {
                'elekta': { name: 'Elekta Versa HD', img: 'image/elekta.jpg', status: '運轉中', uptime: '99.8%', lastMaint: '2023/10/15' },
                'varian': { name: 'Varian TrueBeam', img: null, status: '待機中', uptime: '95.2%', lastMaint: '2023/11/01' },
                'ct': { name: 'CT-Sim 模擬定位儀', img: null, status: '維修中', uptime: '88.5%', lastMaint: '2023/11/20' }
            };
            const info = deviceDetails[device] || deviceDetails['elekta'];

            return (
                <div className="space-y-6 fade-in">
                    {/* Header Status */}
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex flex-col md:flex-row gap-6">
                        <div className="w-full md:w-1/3 h-64 bg-gray-100 rounded-lg overflow-hidden relative flex items-center justify-center border border-gray-200">
                             <img 
                                src={info.img || "placeholder.jpg"} 
                                alt={info.name}
                                className="w-full h-full object-cover"
                                onError={(e) => {
                                    e.target.style.display = 'none';
                                    e.target.nextSibling.style.display = 'flex';
                                }}
                            />
                            <div className="hidden absolute inset-0 flex flex-col items-center justify-center text-gray-400 bg-gray-50">
                                <i className="fa-solid fa-x-ray text-4xl mb-2"></i>
                                <span>{info.name} Image</span>
                            </div>
                            <div className="absolute top-3 right-3 px-3 py-1 bg-white/90 backdrop-blur rounded-full text-xs font-bold shadow-sm text-gray-700">
                                ID: LINAC-01
                            </div>
                        </div>
                        <div className="flex-1 flex flex-col justify-between py-2">
                            <div>
                                <h2 className="text-2xl font-bold text-gray-800 mb-2">{info.name}</h2>
                                <div className="flex gap-3 mb-6">
                                    <span className={`px-3 py-1 rounded-full text-xs font-bold ${info.status === '運轉中' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}`}>
                                        <i className="fa-solid fa-circle text-[8px] mr-2"></i>{info.status}
                                    </span>
                                    <span className="px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-xs font-bold">
                                        <i className="fa-solid fa-location-dot mr-1"></i> 第 2 治療室
                                    </span>
                                </div>
                                <div className="grid grid-cols-3 gap-4">
                                    <div className="p-4 bg-slate-50 rounded-lg border border-gray-100">
                                        <p className="text-xs text-gray-500 mb-1">月平均妥善率</p>
                                        <p className="text-xl font-bold text-cyan-700">{info.uptime}</p>
                                    </div>
                                    <div className="p-4 bg-slate-50 rounded-lg border border-gray-100">
                                        <p className="text-xs text-gray-500 mb-1">累計治療人次 (本月)</p>
                                        <p className="text-xl font-bold text-gray-700">458</p>
                                    </div>
                                    <div className="p-4 bg-slate-50 rounded-lg border border-gray-100">
                                        <p className="text-xs text-gray-500 mb-1">上次保養日期</p>
                                        <p className="text-xl font-bold text-gray-700">{info.lastMaint}</p>
                                    </div>
                                </div>
                            </div>
                            <div className="mt-4 flex gap-3">
                                <button className="flex-1 py-2 bg-cyan-600 text-white rounded hover:bg-cyan-700 transition text-sm font-bold shadow-sm">
                                    <i className="fa-solid fa-clipboard-list mr-2"></i> 查看排程
                                </button>
                                <button className="flex-1 py-2 bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50 transition text-sm font-bold shadow-sm">
                                    <i className="fa-solid fa-wrench mr-2"></i> 報修紀錄
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Maintenance Log Table */}
                    <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 className="font-bold text-gray-700 mb-4">近期維修與異常紀錄</h3>
                        <table className="w-full text-left text-sm">
                            <thead className="bg-gray-50 text-gray-500 font-medium border-b border-gray-200">
                                <tr>
                                    <th className="py-3 px-4">日期</th>
                                    <th className="py-3 px-4">事件類型</th>
                                    <th className="py-3 px-4">描述</th>
                                    <th className="py-3 px-4">處理人員</th>
                                    <th className="py-3 px-4 text-center">狀態</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100">
                                <tr>
                                    <td className="py-3 px-4 text-gray-600">2023-11-18</td>
                                    <td className="py-3 px-4"><span className="text-orange-500 font-bold">異常訊號</span></td>
                                    <td className="py-3 px-4 text-gray-600">MLC 葉片定位誤差微調</td>
                                    <td className="py-3 px-4 text-gray-600">王工程師</td>
                                    <td className="py-3 px-4 text-center"><span className="text-xs bg-green-100 text-green-600 px-2 py-1 rounded">已解決</span></td>
                                </tr>
                                <tr>
                                    <td className="py-3 px-4 text-gray-600">2023-10-15</td>
                                    <td className="py-3 px-4"><span className="text-blue-500 font-bold">定期保養</span></td>
                                    <td className="py-3 px-4 text-gray-600">季度校正與射束測量</td>
                                    <td className="py-3 px-4 text-gray-600">原廠團隊</td>
                                    <td className="py-3 px-4 text-center"><span className="text-xs bg-green-100 text-green-600 px-2 py-1 rounded">完成</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        // 4. Main App Container
        const App = () => {
            const [currentView, setCurrentView] = useState('dashboard');

            // Menu Data with Icons for EVERY item
            const menuData = [
                { title: "總覽 Dashboard", icon: "fa-table-columns", view: "dashboard" },
                { 
                    title: "營運績效管理", 
                    icon: "fa-chart-pie",
                    children: [
                        { 
                            title: "財務分析", 
                            icon: "fa-file-invoice-dollar",
                            children: [
                                { title: "健保點值收入", icon: "fa-hospital-user", children: [
                                    { title: "每日趨勢", icon: "fa-chart-line", view: "nhi_trend" }, 
                                    { title: "申報狀態", icon: "fa-list-check", view: "nhi_status" }
                                ]},
                                { title: "自費療程收入", icon: "fa-star-of-life", children: [
                                    { title: "VMAT 營收", icon: "fa-bullseye", view: "self_vmat" }, 
                                    { title: "SBRT/SRS", icon: "fa-crosshairs", view: "self_sbrt" }
                                ]},
                                { title: "每日門診收入", icon: "fa-cash-register", children: [
                                    { title: "掛號費", icon: "fa-ticket", view: "daily_reg" }, 
                                    { title: "部分負擔", icon: "fa-coins", view: "daily_part" }
                                ]}
                            ]
                        },
                        { 
                            title: "成本控制", 
                            icon: "fa-scale-balanced",
                            children: [
                                { title: "人員成本 (TDABC)", icon: "fa-users-gear", children: [
                                    { title: "主治醫師", icon: "fa-user-doctor", view: "cost_personnel_doc" }, 
                                    { title: "醫學物理師", icon: "fa-atom", view: "cost_personnel_phy" }
                                ]},
                                { title: "能源消耗", icon: "fa-plug-circle-bolt", children: [
                                    { title: "電力日報", icon: "fa-bolt", view: "energy_daily" }
                                ]}
                            ]
                        }
                    ]
                },
                {
                    title: "放射設備管理",
                    icon: "fa-x-ray",
                    children: [
                        {
                            title: "Elekta Versa HD",
                            icon: "fa-circle-radiation",
                            children: [
                                { title: "妥善率與狀態", icon: "fa-heart-pulse", view: "elekta_status" }, 
                                { title: "維修紀錄", icon: "fa-screwdriver-wrench", view: "elekta_status" }
                            ]
                        },
                        { title: "Varian TrueBeam", icon: "fa-dharmachakra", view: "varian_status" },
                        { title: "CT-Sim 模擬定位", icon: "fa-ring", view: "ct_status" }
                    ]
                },
                { title: "系統設定", icon: "fa-gear", view: "settings" }
            ];

            // Render Content Switcher
            const renderContent = () => {
                // Dashboard
                if (currentView === 'dashboard') return <DashboardView />;
                
                // Financial
                if (['nhi_trend', 'nhi_status', 'self_vmat', 'self_sbrt', 'daily_reg', 'daily_part'].includes(currentView)) {
                    return <FinancialView type={currentView} />;
                }

                // Cost
                if (currentView.startsWith('cost_personnel')) return <CostView type="personnel" />;
                if (currentView === 'energy_daily') return <CostView type="energy_daily" />;

                // Equipment
                if (currentView.startsWith('elekta')) return <EquipmentView device="elekta" />;
                if (currentView.startsWith('varian')) return <EquipmentView device="varian" />;
                if (currentView.startsWith('ct')) return <EquipmentView device="ct" />;

                // Default/Settings
                return (
                    <div className="flex items-center justify-center h-full text-gray-400 fade-in">
                        <div className="text-center">
                            <i className="fa-solid fa-wrench text-4xl mb-4"></i>
                            <p>此模組功能開發中...</p>
                        </div>
                    </div>
                );
            };

            return (
                <div className="flex h-screen overflow-hidden text-gray-800">
                    {/* Sidebar */}
                    <aside className="w-72 bg-white border-r border-gray-200 flex flex-col z-20 shadow-[4px_0_24px_rgba(0,0,0,0.02)]">
                        <div className="h-16 flex items-center px-6 border-b border-gray-100 bg-white">
                            <div className="flex items-center gap-3 cursor-pointer" onClick={() => setCurrentView('dashboard')}>
                                <img 
                                    src="image/fetlogo.png" 
                                    alt="FET" 
                                    className="h-8 w-auto object-contain"
                                    onError={(e) => {e.target.style.display='none'; e.target.nextSibling.style.display='flex'}}
                                />
                                <div className="hidden font-black text-red-600 text-xl tracking-tighter">FET</div>
                                <span className="font-bold text-gray-700 text-sm tracking-wide">放射腫瘤戰情室</span>
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto scrollbar-hide py-4">
                            {menuData.map((item, idx) => (
                                <MenuItem key={idx} item={item} onSelect={setCurrentView} currentView={currentView} />
                            ))}
                        </div>

                        <div className="p-4 border-t border-gray-100 bg-gray-50">
                            <div className="flex items-center gap-3">
                                <div className="w-9 h-9 rounded-full bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-white text-xs font-bold shadow-sm">
                                    DR
                                </div>
                                <div>
                                    <p className="text-xs font-bold text-gray-700">Dr. Chen</p>
                                    <p className="text-[10px] text-gray-500">主任醫師 | 管理員</p>
                                </div>
                                <button className="ml-auto text-gray-400 hover:text-gray-600"><i className="fa-solid fa-right-from-bracket"></i></button>
                            </div>
                        </div>
                    </aside>

                    {/* Main Area */}
                    <main className="flex-1 flex flex-col h-screen overflow-hidden bg-slate-50">
                        <header className="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-8 shadow-sm shrink-0 z-10">
                            <h2 className="text-lg font-bold text-gray-700 flex items-center gap-2">
                                <span className="text-gray-400 font-normal text-sm">當前視圖 /</span>
                                {menuData.find(m => m.view === currentView)?.title || 
                                 '營運管理詳細資料'}
                            </h2>
                            <div className="flex items-center gap-4">
                                <div className="hidden md:flex items-center gap-3">
                                    <span className="px-3 py-1 bg-green-50 text-green-700 text-xs rounded-full border border-green-100 flex items-center gap-2">
                                        <span className="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span> HIS 連線
                                    </span>
                                    <span className="px-3 py-1 bg-green-50 text-green-700 text-xs rounded-full border border-green-100 flex items-center gap-2">
                                        <span className="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span> 批價系統
                                    </span>
                                </div>
                                <div className="h-8 w-px bg-gray-200 mx-2"></div>
                                <p className="text-xs text-gray-500 font-mono">{new Date().toLocaleDateString()}</p>
                            </div>
                        </header>

                        <div className="flex-1 overflow-y-auto p-8 relative">
                            {renderContent()}
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>