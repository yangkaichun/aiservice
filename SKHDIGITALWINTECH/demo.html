<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>入院疾病分析與預測戰情室 | 遠傳智慧醫療</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Noto+Sans+TC:wght@300;400;500;700&family=Rajdhani:wght@500;600;700&display=swap');
        
        :root {
            --bg-dark: #0f172a;
            --card-dark: #1e293b;
            --accent-cyan: #06b6d4;
            --accent-purple: #8b5cf6;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
        }

        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: #0b1121; /* Deepest Blue/Black */
            background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, #0b1121 70%);
            color: var(--text-main);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Tech/Data Font for Numbers */
        .font-tech { font-family: 'Rajdhani', sans-serif; }
        .font-mono-tech { font-family: 'JetBrains Mono', monospace; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; border: 1px solid #1e293b; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Glass/Tech Card Style */
        .tech-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }
        .tech-card:hover {
            border-color: rgba(6, 182, 212, 0.3);
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.1);
        }

        /* Neon Glow Text */
        .text-glow-cyan { text-shadow: 0 0 10px rgba(6, 182, 212, 0.5); }
        .text-glow-purple { text-shadow: 0 0 10px rgba(139, 92, 246, 0.5); }
        .text-glow-rose { text-shadow: 0 0 10px rgba(244, 63, 94, 0.5); }

        /* Animation */
        .animate-fade-in { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Modal Backdrop */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(5px);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icons ---
        const IconDashboard = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>;
        const IconBrain = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"/><path d="M17.599 6.5a3 3 0 0 0 .399-1.375"/><path d="M6.003 5.125A3 3 0 0 0 6.401 6.5"/><path d="M3.477 10.896a4 4 0 0 1 .585-.396"/><path d="M19.938 10.5a4 4 0 0 1 .585.396"/><path d="M6 18a4 4 0 0 1-1.97-3.284"/><path d="M17.97 14.716A4 4 0 0 1 16 18"/></svg>;
        const IconActivity = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>;
        const IconUsers = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>;
        const IconAlert = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>;
        const IconArrowUp = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m5 12 7-7 7 7"/><path d="M12 19V5"/></svg>;
        const IconArrowDown = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5v14"/><path d="m19 12-7 7-7-7"/></svg>;
        const IconBed = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 4v16"/><path d="M2 8h18a2 2 0 0 1 2 2v10"/><path d="M2 17h20"/><path d="M6 8v9"/></svg>;
        const IconCpu = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="4" width="16" height="16" rx="2" /><rect x="9" y="9" width="6" height="6" /><path d="M9 1V4" /><path d="M15 1V4" /><path d="M9 20V23" /><path d="M15 20V23" /><path d="M20 9H23" /><path d="M20 14H23" /><path d="M1 9H4" /><path d="M1 14H4" /></svg>;
        const IconSignal = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 20h.01"/><path d="M7 20v-4"/><path d="M12 20v-8"/><path d="M17 20V8"/><path d="M22 20V4"/></svg>;
        const IconClose = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 18 12"/></svg>;

        // --- Components ---

        // Sidebar
        const Sidebar = ({ activeTab, setActiveTab }) => {
            const menuItems = [
                { id: 'dashboard', label: '戰情監控總覽', icon: <IconDashboard /> },
                { id: 'prediction', label: 'AI 模擬與決策', icon: <IconBrain /> },
            ];
            return (
                <div className="w-64 bg-slate-900/80 backdrop-blur-md border-r border-slate-700 h-screen fixed left-0 top-0 flex flex-col z-20">
                    <div className="p-6 border-b border-slate-700/50">
                        <div className="flex items-center space-x-3">
                            <div className="w-10 h-10 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-lg flex items-center justify-center text-white font-bold text-xl shadow-[0_0_15px_rgba(6,182,212,0.5)]">遠</div>
                            <div><h1 className="font-bold text-white text-lg tracking-wider">遠傳<span className="text-cyan-400">智慧醫療</span></h1></div>
                        </div>
                    </div>
                    <div className="flex-1 py-6 px-3 space-y-2">
                        {menuItems.map(item => (
                            <button key={item.id} onClick={() => setActiveTab(item.id)} className={`w-full flex items-center space-x-3 px-3 py-3 rounded-lg transition-all duration-300 font-medium ${activeTab === item.id ? 'bg-gradient-to-r from-cyan-900/40 to-transparent text-cyan-300 border-l-4 border-cyan-400' : 'text-slate-400 hover:bg-slate-800/50 hover:text-slate-200'}`}>
                                <span>{item.icon}</span><span>{item.label}</span>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // Modal Component
        const Modal = ({ title, isOpen, onClose, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center modal-backdrop p-4 animate-fade-in">
                    <div className="bg-slate-900 border border-slate-700 w-full max-w-5xl h-[85vh] rounded-2xl shadow-2xl flex flex-col relative overflow-hidden">
                        <div className="p-6 border-b border-slate-700 flex justify-between items-center bg-slate-800/50">
                            <h3 className="text-2xl font-bold text-white flex items-center gap-3">
                                <span className="w-2 h-8 bg-cyan-500 rounded-sm"></span> {title}
                            </h3>
                            <button onClick={onClose} className="text-slate-400 hover:text-white transition-colors p-2 rounded-full hover:bg-slate-700"><IconClose /></button>
                        </div>
                        <div className="flex-1 overflow-y-auto p-6 custom-scrollbar bg-slate-900/80">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        // Generic Chart Component
        const ChartCanvas = ({ id, type, data, options }) => {
            const chartRef = useRef(null);
            useEffect(() => {
                const ctx = document.getElementById(id);
                if (chartRef.current) chartRef.current.destroy();
                if (ctx) {
                    chartRef.current = new Chart(ctx, { type, data, options });
                }
                return () => chartRef.current?.destroy();
            }, [data, type, options, id]);
            return <canvas id={id}></canvas>;
        };

        // Modal Content Components
        
        // 1. Admission Modal
        const AdmissionModalContent = () => {
            return (
                <div className="space-y-6">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                         <div className="tech-card p-5 rounded-xl text-center border-t-4 border-cyan-500">
                            <p className="text-slate-400 text-xs uppercase">今日總入院</p>
                            <p className="text-4xl font-bold text-white mt-2 font-tech">84</p>
                         </div>
                         <div className="tech-card p-5 rounded-xl text-center border-t-4 border-blue-500">
                            <p className="text-slate-400 text-xs uppercase">來自急診</p>
                            <p className="text-4xl font-bold text-blue-400 mt-2 font-tech">52</p>
                         </div>
                         <div className="tech-card p-5 rounded-xl text-center border-t-4 border-purple-500">
                            <p className="text-slate-400 text-xs uppercase">來自門診</p>
                            <p className="text-4xl font-bold text-purple-400 mt-2 font-tech">32</p>
                         </div>
                    </div>
                    
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 h-[300px]">
                        <div className="tech-card p-5 rounded-xl">
                            <h4 className="text-white font-bold mb-4">今日每小時入院趨勢</h4>
                            <div className="h-60 w-full">
                                <ChartCanvas id="modalAdmissionHourly" type="line" 
                                    data={{
                                        labels: ['08:00','10:00','12:00','14:00','16:00','18:00'],
                                        datasets: [{label: '人數', data: [5, 12, 18, 15, 22, 12], borderColor: '#06b6d4', tension: 0.4, fill: true, backgroundColor: 'rgba(6,182,212,0.1)'}]
                                    }} 
                                    options={{responsive: true, maintainAspectRatio: false, scales: {y: {grid: {color: '#334155'}}, x: {grid: {display:false}}}}} 
                                />
                            </div>
                        </div>
                         <div className="tech-card p-5 rounded-xl">
                            <h4 className="text-white font-bold mb-4">科別分佈</h4>
                            <div className="h-60 w-full flex justify-center">
                                <ChartCanvas id="modalAdmissionDept" type="doughnut" 
                                    data={{
                                        labels: ['胸腔內科','心臟內科','一般外科','骨科','神經內科'],
                                        datasets: [{data: [30, 25, 20, 15, 10], backgroundColor: ['#06b6d4','#3b82f6','#8b5cf6','#ec4899','#f59e0b'], borderWidth: 0}]
                                    }} 
                                    options={{responsive: true, maintainAspectRatio: false, plugins: {legend: {position:'right', labels:{color:'#cbd5e1'}}}}} 
                                />
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // 2. ER Waiting Modal
        const ERModalContent = () => {
            const patients = [
                { id: 'ER-8821', triage: 1, name: '林O豪', time: '4h 15m', dept: '胸腔內科', status: '待床 (ICU)' },
                { id: 'ER-8825', triage: 2, name: '陳O美', time: '3h 50m', dept: '心臟內科', status: '待床 (一般)' },
                { id: 'ER-8830', triage: 2, name: '王O明', time: '3h 20m', dept: '一般外科', status: '待床 (一般)' },
                { id: 'ER-8832', triage: 2, name: '李O華', time: '2h 45m', dept: '神經內科', status: '檢查中' },
                { id: 'ER-8841', triage: 3, name: '張O銘', time: '1h 10m', dept: '骨科', status: '待床 (一般)' },
            ];

            return (
                <div className="space-y-6">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div className="tech-card p-5 rounded-xl">
                            <h4 className="text-white font-bold mb-4">檢傷分級分佈</h4>
                            <div className="h-40 w-full">
                                <ChartCanvas id="modalERTriage" type="bar" 
                                    data={{
                                        labels: ['一級 (復甦)', '二級 (危急)', '三級 (緊急)', '四級', '五級'],
                                        datasets: [{label: '人數', data: [3, 8, 15, 5, 2], backgroundColor: ['#ef4444','#f97316','#eab308','#22c55e','#3b82f6'], borderRadius: 4}]
                                    }} 
                                    options={{indexAxis: 'y', responsive: true, maintainAspectRatio: false, scales: {x: {grid: {color: '#334155'}}, y: {grid: {display:false}}}}} 
                                />
                            </div>
                        </div>
                        <div className="tech-card p-5 rounded-xl flex flex-col justify-center">
                            <div className="flex justify-between items-center border-b border-slate-700 pb-2 mb-2">
                                <span className="text-slate-400">平均待床時間</span>
                                <span className="text-2xl font-bold text-rose-400 font-tech">4.2 hrs</span>
                            </div>
                            <div className="flex justify-between items-center">
                                <span className="text-slate-400">最長等待</span>
                                <span className="text-2xl font-bold text-rose-500 font-tech">12.5 hrs</span>
                            </div>
                        </div>
                    </div>

                    <div className="tech-card p-6 rounded-xl">
                        <h4 className="text-white font-bold mb-4">即時待床清單</h4>
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm text-left text-slate-300">
                                <thead className="text-xs text-slate-500 uppercase bg-slate-800/80">
                                    <tr>
                                        <th className="px-4 py-3">檢傷</th>
                                        <th className="px-4 py-3">病歷號</th>
                                        <th className="px-4 py-3">姓名</th>
                                        <th className="px-4 py-3">等待時間</th>
                                        <th className="px-4 py-3">科別</th>
                                        <th className="px-4 py-3">狀態</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-700">
                                    {patients.map((p, i) => (
                                        <tr key={i} className="hover:bg-slate-700/30">
                                            <td className="px-4 py-3"><span className={`px-2 py-1 rounded text-xs font-bold ${p.triage === 1 ? 'bg-red-500 text-white' : 'bg-orange-500 text-white'}`}>Level {p.triage}</span></td>
                                            <td className="px-4 py-3 font-mono-tech">{p.id}</td>
                                            <td className="px-4 py-3">{p.name}</td>
                                            <td className="px-4 py-3 font-mono-tech text-amber-400">{p.time}</td>
                                            <td className="px-4 py-3">{p.dept}</td>
                                            <td className="px-4 py-3">{p.status}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        }

        // 3. Occupancy Modal
        const OccupancyModalContent = () => {
            return (
                <div className="space-y-6">
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div className="tech-card p-5 rounded-xl">
                            <h4 className="text-white font-bold mb-4">各樓層/病房類型佔床率</h4>
                            <div className="h-60 w-full">
                                <ChartCanvas id="modalOccBar" type="bar" 
                                    data={{
                                        labels: ['ICU', '10F 特需', '8F 一般', '7F 一般', '6F 一般', '3F 產科'],
                                        datasets: [{label: '佔用率 %', data: [95, 70, 98, 92, 88, 65], backgroundColor: ['#ef4444','#8b5cf6','#3b82f6','#3b82f6','#3b82f6','#10b981'], borderRadius: 4}]
                                    }} 
                                    options={{responsive: true, maintainAspectRatio: false, scales: {y: {max: 100, grid: {color: '#334155'}}, x: {grid: {display:false}}}}} 
                                />
                            </div>
                        </div>
                        <div className="tech-card p-5 rounded-xl">
                             <h4 className="text-white font-bold mb-4">過去 30 天全院佔床趨勢</h4>
                             <div className="h-60 w-full">
                                <ChartCanvas id="modalOccTrend" type="line" 
                                    data={{
                                        labels: Array.from({length: 10}, (_, i) => `Day ${i+1}`),
                                        datasets: [{label: '佔床率', data: [88, 89, 90, 92, 91, 93, 95, 94, 92, 92.5], borderColor: '#10b981', tension: 0.3, fill: true, backgroundColor: 'rgba(16, 185, 129, 0.1)'}]
                                    }} 
                                    options={{responsive: true, maintainAspectRatio: false, scales: {y: {min: 80, max: 100, grid: {color: '#334155'}}, x: {grid: {display:false}}}}} 
                                />
                            </div>
                        </div>
                    </div>
                    
                    <div className="tech-card p-6 rounded-xl border-l-4 border-rose-500">
                        <h4 className="text-white font-bold mb-2 flex items-center gap-2"><IconAlert className="text-rose-500"/> 滿床預警</h4>
                        <p className="text-slate-300 text-sm">根據目前急診待床數 (18人) 與預計出院數 (12人)，預計今日下午 16:00 全院一般病床將達 100% 滿載。建議啟動 <span className="text-rose-400 font-bold">Level 1 調度機制</span>，加快 7F 病房清消速度。</p>
                    </div>
                </div>
            )
        }

        // 4. AI Prediction Modal (Rich Content)
        const AIPredictionModalContent = () => {
             return (
                <div className="space-y-6">
                    {/* Top Summary */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div className="tech-card p-4 rounded-xl bg-gradient-to-br from-amber-900/20 to-slate-900 border border-amber-500/30">
                            <p className="text-slate-400 text-xs uppercase">預測明日需求</p>
                            <p className="text-4xl font-bold text-amber-400 font-tech mt-1">95 <span className="text-sm text-slate-400">Beds</span></p>
                            <p className="text-[10px] text-rose-400 font-bold mt-1">▲ High Pressure</p>
                        </div>
                        <div className="tech-card p-4 rounded-xl">
                            <p className="text-slate-400 text-xs uppercase">預測信心指數</p>
                            <p className="text-3xl font-bold text-cyan-400 font-tech mt-1">98.2%</p>
                        </div>
                        <div className="tech-card p-4 rounded-xl">
                            <p className="text-slate-400 text-xs uppercase">主要影響因子</p>
                            <p className="text-lg font-bold text-white mt-2">氣溫驟降</p>
                            <p className="text-xs text-slate-500">權重: 0.85</p>
                        </div>
                        <div className="tech-card p-4 rounded-xl">
                            <p className="text-slate-400 text-xs uppercase">次要影響因子</p>
                            <p className="text-lg font-bold text-white mt-2">連假結束</p>
                            <p className="text-xs text-slate-500">權重: 0.62</p>
                        </div>
                    </div>

                    {/* Main Chart */}
                    <div className="tech-card p-6 rounded-xl">
                        <div className="flex justify-between items-center mb-4">
                            <h4 className="text-white font-bold flex items-center gap-2">
                                <IconBrain className="text-purple-500" /> 明日每小時壓力預測
                            </h4>
                            <div className="flex gap-4 text-xs">
                                <span className="flex items-center gap-1"><span className="w-2 h-2 bg-amber-500 rounded-full"></span> 預測需求</span>
                                <span className="flex items-center gap-1"><span className="w-2 h-2 bg-slate-500 rounded-full"></span> 可用量能</span>
                            </div>
                        </div>
                        <div className="h-64 w-full">
                            <ChartCanvas id="modalAIPredHourly" type="line" 
                                data={{
                                    labels: ['00:00','04:00','08:00','12:00','14:00','16:00','20:00','23:59'],
                                    datasets: [
                                        {label: '預測需求 (床)', data: [20, 15, 45, 85, 95, 90, 60, 40], borderColor: '#f59e0b', tension: 0.4, borderWidth: 3},
                                        {label: '可用量能 (床)', data: [30, 30, 50, 80, 80, 75, 50, 40], borderColor: '#64748b', borderDash: [5,5], tension: 0.4}
                                    ]
                                }} 
                                options={{responsive: true, maintainAspectRatio: false, scales: {y: {grid: {color: '#334155'}}, x: {grid: {display:false}}}}} 
                            />
                        </div>
                    </div>

                    {/* Actionable Insights */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div className="tech-card p-5 rounded-xl border-l-4 border-rose-500 bg-rose-900/10">
                            <h5 className="text-rose-400 font-bold mb-2 text-sm uppercase tracking-wider">資源瓶頸預警</h5>
                            <p className="text-slate-200 text-sm leading-relaxed">
                                系統預測明日 <span className="font-bold text-white">14:00 - 16:00</span> 將出現床位短缺交叉點（需求 > 供給）。
                                <br/>預估缺口：<span className="font-bold text-white">15 床</span>。
                                <br/>高風險科別：<span className="text-rose-300">胸腔內科、心臟內科</span>。
                            </p>
                        </div>
                        <div className="tech-card p-5 rounded-xl border-l-4 border-emerald-500 bg-emerald-900/10">
                            <h5 className="text-emerald-400 font-bold mb-2 text-sm uppercase tracking-wider">AI 建議行動方案</h5>
                            <ul className="text-slate-200 text-sm space-y-2 list-disc list-inside">
                                <li>通知 8F/10F 護理站，明日上午 10:00 前加速辦理出院手續。</li>
                                <li>啟動急診留觀區 B 區作為臨時緩衝區。</li>
                                <li>暫緩明日下午非緊急住院檢查之排程。</li>
                            </ul>
                        </div>
                    </div>
                </div>
             )
        }

        // KPICard (Neon Style) with onClick
        const KPICard = ({ title, value, change, trend, icon, color, onClick }) => {
            const isUp = trend === 'up';
            const colorMap = {
                cyan: 'text-cyan-400 bg-cyan-900/30 border-cyan-500/30',
                rose: 'text-rose-400 bg-rose-900/30 border-rose-500/30',
                emerald: 'text-emerald-400 bg-emerald-900/30 border-emerald-500/30',
                amber: 'text-amber-400 bg-amber-900/30 border-amber-500/30',
            };
            const accentClass = colorMap[color] || colorMap['cyan'];
            const trendColor = isUp ? 'text-rose-400' : 'text-emerald-400';

            return (
                <div onClick={onClick} className="tech-card rounded-xl p-5 flex flex-col justify-between h-full relative overflow-hidden group cursor-pointer">
                    <div className={`absolute top-0 right-0 p-20 opacity-0 group-hover:opacity-10 bg-[radial-gradient(circle,rgba(255,255,255,0.1)_0%,transparent_70%)] transition-opacity duration-500 pointer-events-none`}></div>
                    <div className="flex justify-between items-start mb-4 relative z-10">
                        <div>
                            <p className="text-xs font-semibold text-slate-400 tracking-wider uppercase mb-1">{title}</p>
                            <h3 className="text-3xl font-bold text-white font-tech tracking-wide">{value}</h3>
                        </div>
                        <div className={`p-2.5 rounded-lg border ${accentClass} shadow-[0_0_10px_rgba(0,0,0,0.2)] group-hover:scale-110 transition-transform`}>
                            {icon}
                        </div>
                    </div>
                    <div className="flex items-center text-sm relative z-10">
                        <span className={`flex items-center font-bold ${trendColor} mr-2 drop-shadow-sm`}>
                            {isUp ? <IconArrowUp /> : <IconArrowDown />}
                            {change}
                        </span>
                        <span className="text-slate-500 text-xs">點擊查看詳情</span>
                    </div>
                </div>
            );
        };

        // Chart Wrapper
        const ChartCard = ({ title, children, action }) => (
            <div className="tech-card rounded-xl p-6 h-full flex flex-col relative">
                <div className="flex justify-between items-center mb-6">
                    <h3 className="text-lg font-bold text-white flex items-center gap-2">
                        <span className="w-1 h-4 bg-cyan-500 rounded-sm shadow-[0_0_8px_#06b6d4]"></span>
                        {title}
                    </h3>
                    {action}
                </div>
                <div className="flex-1 relative min-h-[250px] w-full">
                    {children}
                </div>
            </div>
        );

        // --- View 1: Dashboard Content ---
        const DashboardView = () => {
            const lineChartRef = useRef(null);
            const barChartRef = useRef(null);
            const [modalOpen, setModalOpen] = useState(false);
            const [modalType, setModalType] = useState(null); // 'admission', 'er', 'occupancy', 'ai'

            const openModal = (type) => {
                setModalType(type);
                setModalOpen(true);
            };

            const getModalTitle = () => {
                switch(modalType) {
                    case 'admission': return '今日入院詳細分析';
                    case 'er': return '急診待床監控中心';
                    case 'occupancy': return '全院病床佔用狀態';
                    case 'ai': return 'AI 模擬預測與決策支援';
                    default: return '';
                }
            };

            useEffect(() => {
                const lineCtx = document.getElementById('admissionTrendChart');
                const barCtx = document.getElementById('diseaseDistChart');

                if (lineChartRef.current) lineChartRef.current.destroy();
                if (barChartRef.current) barChartRef.current.destroy();

                Chart.defaults.color = '#94a3b8';
                Chart.defaults.borderColor = '#334155';

                // Line Chart
                if (lineCtx) {
                    const gradient = lineCtx.getContext('2d').createLinearGradient(0, 0, 0, 400);
                    gradient.addColorStop(0, 'rgba(6, 182, 212, 0.5)');
                    gradient.addColorStop(1, 'rgba(6, 182, 212, 0)');

                    lineChartRef.current = new Chart(lineCtx, {
                        type: 'line',
                        data: {
                            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                            datasets: [{
                                label: '本週入院',
                                data: [45, 52, 48, 60, 55, 40, 35],
                                borderColor: '#06b6d4',
                                backgroundColor: gradient,
                                tension: 0.4, fill: true, borderWidth: 3
                            }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { grid: { color: '#334155' }, beginAtZero: true }, x: { grid: { display: false } } } }
                    });
                }

                // Bar Chart
                if (barCtx) {
                    barChartRef.current = new Chart(barCtx, {
                        type: 'bar',
                        data: {
                            labels: ['呼吸道', '心血管', '消化系', '創傷', '神經系'],
                            datasets: [{ label: '病患數', data: [120, 95, 80, 45, 30], backgroundColor: ['rgba(6,182,212,0.8)', 'rgba(236,72,153,0.8)', 'rgba(16,185,129,0.8)', 'rgba(245,158,11,0.8)', 'rgba(139,92,246,0.8)'], borderRadius: 4 }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { display: false } }, scales: { x: { grid: { color: '#334155' } }, y: { grid: { display: false } } } }
                    });
                }
            }, []);

            return (
                <div className="space-y-6 animate-fade-in pb-10">
                    <div className="flex justify-between items-end border-b border-slate-700/50 pb-4">
                        <div>
                            <h1 className="text-3xl font-bold text-white tracking-tight flex items-center gap-3">全院戰情總覽 <span className="text-xs px-2 py-1 bg-cyan-900/50 text-cyan-400 border border-cyan-500/30 rounded font-mono-tech">LIVE</span></h1>
                            <p className="text-slate-400 text-sm mt-1 font-mono-tech">Last Update: {new Date().toLocaleTimeString()}</p>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <KPICard title="今日入院人數" value="84" change="12%" trend="up" icon={<IconUsers />} color="cyan" onClick={() => openModal('admission')} />
                        <KPICard title="急診待床數" value="18" change="5%" trend="up" icon={<IconAlert />} color="rose" onClick={() => openModal('er')} />
                        <KPICard title="全院佔床率" value="92.5%" change="1.2%" trend="down" icon={<IconBed />} color="emerald" onClick={() => openModal('occupancy')} />
                        <KPICard title="AI 預測明日需求" value="95" change="High" trend="up" icon={<IconBrain />} color="amber" onClick={() => openModal('ai')} />
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 h-[400px]">
                        <div className="lg:col-span-2 h-full"><ChartCard title="入院人數趨勢分析"><canvas id="admissionTrendChart"></canvas></ChartCard></div>
                        <div className="h-full"><ChartCard title="疾病類別分佈 (Top 5)"><canvas id="diseaseDistChart"></canvas></ChartCard></div>
                    </div>
                    
                    {/* MODAL */}
                    <Modal title={getModalTitle()} isOpen={modalOpen} onClose={() => setModalOpen(false)}>
                        {modalType === 'admission' && <AdmissionModalContent />}
                        {modalType === 'er' && <ERModalContent />}
                        {modalType === 'occupancy' && <OccupancyModalContent />}
                        {modalType === 'ai' && <AIPredictionModalContent />}
                    </Modal>
                </div>
            );
        };

        // --- App Component ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            return (
                <div className="flex min-h-screen font-sans selection:bg-cyan-500 selection:text-white">
                    <Sidebar activeTab={activeTab} setActiveTab={setActiveTab} />
                    <main className="ml-64 flex-1 p-8 h-screen overflow-y-auto relative">
                        <div className="fixed inset-0 z-[-1] pointer-events-none" style={{backgroundImage: 'linear-gradient(rgba(148, 163, 184, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(148, 163, 184, 0.03) 1px, transparent 1px)', backgroundSize: '40px 40px'}}></div>
                        {activeTab === 'dashboard' ? <DashboardView /> : <div className="text-center text-slate-500 mt-20">Module Loading...</div>}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>