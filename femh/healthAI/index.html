<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>整合性疾病風險預測平台 - 原型展示</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
     <link rel="shortcut icon" href="feticon.ico">
    <style>
        :root {
    --primary-color: #007bff;
    --secondary-color: #6c757d;
    --background-color: #f8f9fa;
    --text-color: #343a40;
    --widget-bg: #ffffff;
    --border-color: #dee2e6;
    --highlight-color: #e63946;
    --font-family: 'Noto Sans TC', sans-serif;
}
body {
    font-family: var(--font-family);
    margin: 0;
    background-color: var(--background-color);
    color: var(--text-color);
    line-height: 1.6;
}
.hidden { display: none!important; }

/* --- 登入頁面樣式 --- */
.login-container {
    max-width: 1000px; /* 增加寬度以容納三張卡片 */
    margin: 5vh auto;
    padding: 40px;
    text-align: center;
}
.portal-header.logo { margin-bottom: 20px; }
.portal-header h1 { font-size: 2.5rem; margin-bottom: 10px; }
.portal-header p { font-size: 1.1rem; color: #6c757d; }
.login-options { display: flex; justify-content: center; gap: 30px; margin-top: 40px; flex-wrap: wrap; }
.login-card {
    width: 300px;
    padding: 30px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: var(--widget-bg);
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    transition: transform 0.2s, box-shadow 0.2s;
}
.login-card:hover { transform: translateY(-5px); box-shadow: 0 8px 12px rgba(0,0,0,0.1); }
.login-card h2 { margin-top: 0; font-size: 1.5rem; }
.login-card p { color: #6c757d; }

/* --- 通用按鈕樣式 --- */
.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s;
}
.btn-primary { background-color: var(--primary-color); color: white; }
.btn-primary:hover { background-color: #0056b3; }
.btn-secondary { background-color: var(--secondary-color); color: white; }
.btn-secondary:hover { background-color: #5a6268; }
.btn-logout { background-color: transparent; color: white; border: 1px solid white; }
.btn-link { background: none; color: var(--primary-color); padding: 0; font-weight: 700; }
.btn-link-disabled { background: none; color: #adb5bd; padding: 0; font-weight: 700; cursor: not-allowed; }
.btn-back { background: none; border: 1px solid var(--border-color); padding: 5px 10px; border-radius: 20px; cursor: pointer; }
.btn-danger { background-color: #dc3545; color: white; }
.btn-danger:hover { background-color: #c82333; }
.btn-success { background-color: #28a745; color: white; }
.btn-success:hover { background-color: #218838; }

/* --- Portal 容器與導覽列 --- */
.portal-container { max-width: 1200px; margin: 0 auto; }
.navbar {
    padding: 15px 30px;
    background-color: var(--primary-color);
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.navbar-dark { background-color: #343a40; }
.navbar-brand { font-size: 1.5rem; font-weight: 700; }

/* --- 儀表板樣式 --- */
.dashboard { padding: 30px; }
.dashboard-header { margin-bottom: 30px; }
.dashboard-header h2 { margin: 0; font-size: 2rem; }
.dashboard-header p { color: #6c757d; font-size: 1.1rem; }
.highlight { color: var(--highlight-color); font-weight: 700; }
.highlight-danger { color: #dc3545; font-weight: 700; }

.widget-grid,.widget-grid-clinical {
    display: grid;
    gap: 25px;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
}
.widget,.widget-large {
    background-color: var(--widget-bg);
    padding: 25px;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    box-shadow: 0 2px 4px rgba(0,0,0,0.03);
}
.widget-grid-clinical { grid-template-columns: 2fr 1fr; }
.widget-large { grid-column: 1 / -1; } /* For clinical view */
@media (max-width: 992px) {
   .widget-grid-clinical { grid-template-columns: 1fr; }
}

.widget h3 { margin-top: 0; display: flex; align-items: center; gap: 10px; }
.widget p { margin-bottom: 15px; }
.widget-meta { font-size: 0.85rem; color: #adb5bd; margin-top: 20px; }
.recommendation-list { padding-left: 20px; margin: 10px 0; }

/* --- 子頁面樣式 --- */
.sub-page { padding: 30px; background-color: #fff; }
.subpage-header { display: flex; align-items: center; gap: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 20px; margin-bottom: 30px; }
.subpage-header h2 { margin: 0; font-size: 1.8rem; }
.content-container { max-width: 800px; }
.subpage-footer { margin-top: 40px; font-size: 0.8rem; color: #6c757d; text-align: center; border-top: 1px solid #eee; padding-top: 15px; }

/* --- 特定模組樣式 --- */
.timeline { list-style: none; padding: 0; }
.timeline-item { border-left: 3px solid var(--border-color); padding: 15px 20px; margin-bottom: 15px; position: relative; }
.timeline-item::before { content: ''; width: 15px; height: 15px; background-color: var(--border-color); border-radius: 50%; position: absolute; left: -9px; top: 18px; }
.timeline-item.completed { border-left-color: #28a745; }
.timeline-item.completed::before { background-color: #28a745; }
.timeline-item.upcoming { border-left-color: #ffc107; }
.timeline-item.upcoming::before { background-color: #ffc107; }
.timeline-item strong { display: block; font-size: 1.1rem; }
.recommendation-note { background-color: #e9ecef; padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 0.9rem; }

.recommendation-card { border: 1px solid var(--border-color); padding: 20px; border-radius: 5px; margin-bottom: 15px; }
.recommendation-card h4 { margin-top: 0; }
.recommendation-card p { margin-bottom: 5px; }

.patient-table, .data-table { width: 100%; border-collapse: collapse; }
.patient-table th,.patient-table td,
.data-table th, .data-table td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border-color); }
.patient-table th, .data-table th { background-color: #f8f9fa; }
.risk-high { color: #dc3545; font-weight: 700; }
.btn-sm { padding: 5px 10px; font-size: 0.9rem; }
.btn-sm-disabled { padding: 5px 10px; font-size: 0.9rem; background-color: #e9ecef; color: #6c757d; cursor: not-allowed; border: 1px solid #ced4da; border-radius: 5px; }

.risk-factor-list { list-style: none; padding: 0; }
.risk-factor-list li { padding: 10px; border-radius: 5px; margin-bottom: 8px; }
.risk-factor-list li.positive { background-color: #f8d7da; color: #721c24; }
.risk-factor-list li.negative { background-color: #d4edda; color: #155724; }
.action-panel { margin-top: 30px; display: flex; gap: 15px; }
.btn-secondary-disabled { background-color: #e9ecef; color: #6c757d; cursor: not-allowed; border: 1px solid #ced4da; }

.ai-tool-layout { display: flex; gap: 30px; }
.form-panel { flex: 1; }
.result-panel { flex: 1; background-color: #f8f9fa; padding: 20px; border-radius: 8px; }
.form-group { margin-bottom: 15px; }
.form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
.form-group input,.form-group select { width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; box-sizing: border-box; }
.result-display { display: flex; justify-content: space-around; text-align: center; margin-bottom: 20px; }
.result-metric.metric-value { font-size: 2.5rem; font-weight: 700; display: block; }
.result-metric.metric-label { color: #6c757d; }
.risk-medium { color: #fd7e14; }

/* --- 補全的管理員後台樣式 --- */
.status-active { color: #28a745; font-weight: 700; }
.status-inactive { color: #6c757d; }

.api-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    margin-bottom: 15px;
    background-color: var(--widget-bg);
}
.api-info h4 { margin: 0 0 5px 0; }
.api-info p { margin: 0; color: #6c757d; }
.api-status { display: flex; align-items: center; gap: 10px; font-weight: 700; }
.status-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
}
.status-indicator.status-connected { background-color: #28a745; box-shadow: 0 0 8px rgba(40, 167, 69, 0.7); }
.status-indicator.status-error { background-color: #dc3545; box-shadow: 0 0 8px rgba(220, 53, 69, 0.7); }
.api-status .status-connected { color: #28a745; }
.api-status .status-error { color: #dc3545; }

    </style>
</head>
<body>

    <main id="login-portal" class="page">
        <div class="login-container">
            <header class="portal-header">
                <img src="fetlogo.png" alt="醫院標誌" class="logo">
                <h1>整合性疾病風險預測平台</h1>
                <p>以預防醫學為導向的新世代智慧醫療服務</p>
            </header>
            <div class="login-options">
                <div class="login-card" id="login-public">
                    <h2>民眾入口</h2>
                    <p>查詢個人健康提醒、疫苗接種時程與健檢建議。</p>
                    <button class="btn btn-primary">登入</button>
                </div>
                <div class="login-card" id="login-clinical">
                    <h2>臨床入口</h2>
                    <p>管理高風險個案、使用AI決策輔助工具。</p>
                    <button class="btn btn-secondary">登入</button>
                </div>
                <div class="login-card" id="login-admin">
                    <h2>管理員入口</h2>
                    <p>管理使用者權限與監控系統服務。</p>
                    <button class="btn">登入</button>
                </div>
            </div>
        </div>
    </main>

    <div id="public-portal-container" class="portal-container hidden">
        <nav class="navbar">
            <span class="navbar-brand">民眾健康儀表板</span>
            <button id="logout-public" class="btn btn-logout">登出</button>
        </nav>

        <section id="public-dashboard" class="page dashboard" data-page="public-dashboard">
            <header class="dashboard-header">
                <h2>王大明 先生，您好！</h2>
                <p>以下是您的個人化健康總覽與建議。</p>
            </header>
            <div class="widget-grid">
                <div id="vaccine-widget" class="widget">
                    <h3><i class="icon-vaccine"></i>我的疫苗時程</h3>
                    <p>您有 <span class="highlight">1</span> 項即將到期的疫苗接種建議。</p>
                    <div class="progress-bar">
                        <div class="progress" style="width: 80%;"></div>
                    </div>
                    <p class="widget-meta">上次更新：2025-11-03</p>
                    <button class="btn btn-link" onclick="showSubPage('vaccine-details')">查看疫苗詳情 &rarr;</button>
                </div>

                <div id="screening-widget" class="widget">
                    <h3><i class="icon-screening"></i>我的健檢建議</h3>
                    <p>根據您的年齡與性別，建議您進行 <span class="highlight">2</span> 項篩檢。</p>
                     <ul class="recommendation-list">
                        <li>大腸癌篩檢 (USPSTF Grade: A)</li>
                        <li>高血壓篩檢 (USPSTF Grade: A)</li>
                    </ul>
                    <p class="widget-meta">資料來源：美國預防服務工作組 (USPSTF)</p>
                    <button class="btn btn-link" onclick="showSubPage('screening-details')">查看所有建議 &rarr;</button>
                </div>
                 <div class="widget">
                    <h3><i class="icon-health"></i>健康存摺摘要</h3>
                    <p>您的健康數據已同步。</p>
                    <p class="widget-meta">上次同步：2025-11-01</p>
                    <button class="btn btn-link-disabled" disabled>查看詳情 (整合中)</button>
                </div>
            </div>
        </section>

        <section id="vaccine-details" class="page sub-page hidden" data-page="vaccine-details">
            <header class="subpage-header">
                <button class="btn-back" onclick="showDashboard('public-dashboard')">&larr; 返回儀表板</button>
                <h2>疫苗接種詳情</h2>
            </header>
            <div class="content-container">
                <h4>接種時程總覽</h4>
                <ul class="timeline">
                    <li class="timeline-item completed">
                        <strong>B型肝炎疫苗 第三劑</strong>
                        <span>接種日期：2000-05-10</span>
                    </li>
                     <li class="timeline-item completed">
                        <strong>COVID-19 疫苗 第三劑</strong>
                        <span>接種日期：2023-01-15</span>
                    </li>
                    <li class="timeline-item upcoming">
                        <strong>季節性流感疫苗 (公費)</strong>
                        <span>建議接種期間：2025-10-01 ~ 2026-03-31</span>
                        <p class="recommendation-note">提醒：年度流感疫苗可有效降低流感嚴重性與併發症風險。</p>
                    </li>
                </ul>
                <footer class="subpage-footer">疫苗時程建議係依據國家衛生主管機關公告之最新接種時程。</footer>
            </div>
        </section>

        <section id="screening-details" class="page sub-page hidden" data-page="screening-details">
            <header class="subpage-header">
                <button class="btn-back" onclick="showDashboard('public-dashboard')">&larr; 返回儀表板</button>
                <h2>健康篩檢建議詳情</h2>
            </header>
            <div class="content-container">
                 <p>根據您的個人資料 (55歲，男性)，以下是基於美國預防服務工作組 (USPSTF) 指引的建議：</p>
                <div class="recommendation-card">
                    <h4>大腸癌篩檢</h4>
                    <p><strong>建議等級：A</strong> (USPSTF 強烈建議)</p>
                    <p>建議50至75歲的成年人定期進行大腸癌篩檢。您可以選擇糞便潛血檢查或大腸鏡檢查。</p>
                </div>
                 <div class="recommendation-card">
                    <h4>高血壓篩檢</h4>
                    <p><strong>建議等級：A</strong> (USPSTF 強烈建議)</p>
                    <p>建議18歲以上的成年人定期測量血壓，以早期發現高血壓並進行管理。</p>
                </div>
                 <div class="recommendation-card">
                    <h4>肺癌篩檢</h4>
                    <p><strong>建議等級：B</strong> (USPSTF 建議)</p>
                    <p>若您有長期吸菸史 (符合特定條件)，建議與醫師討論是否需進行低劑量電腦斷層掃描 (LDCT) 篩檢。</p>
                </div>
            </div>
        </section>
    </div>

    <div id="clinical-portal-container" class="portal-container hidden">
        <nav class="navbar navbar-dark">
            <span class="navbar-brand">臨床決策輔助平台</span>
            <button id="logout-clinical" class="btn btn-logout">登出</button>
        </nav>

        <section id="clinical-dashboard" class="page dashboard" data-page="clinical-dashboard">
            <header class="dashboard-header">
                <h2>林醫師，您好！</h2>
                <p>歡迎使用臨床決策輔助平台。目前有 <span class="highlight-danger">3</span> 位高風險個案需要您關注。</p>
            </header>
            <div class="widget-grid-clinical">
                <div id="metabolic-syndrome-cohort" class="widget-large">
                    <h3><i class="icon-cohort"></i>高風險個案列表 (代謝症候群)</h3>
                    <table class="patient-table">
                        <thead>
                            <tr>
                                <th>病歷號</th>
                                <th>姓名</th>
                                <th>年齡</th>
                                <th>風險因子數量</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>HN123456</td>
                                <td>陳 O 雄</td>
                                <td>62</td>
                                <td><span class="risk-high">4/5</span></td>
                                <td><button class="btn btn-sm" onclick="showSubPage('case-management-details')">查看詳情</button></td>
                            </tr>
                             <tr>
                                <td>HN789012</td>
                                <td>黃 O 玲</td>
                                <td>58</td>
                                <td><span class="risk-high">3/5</span></td>
                                <td><button class="btn btn-sm-disabled" disabled>已納管</button></td>
                            </tr>
                             <tr>
                                <td>HN345678</td>
                                <td>張 O 華</td>
                                <td>65</td>
                                <td><span class="risk-high">3/5</span></td>
                                <td><button class="btn btn-sm" onclick="showSubPage('case-management-details')">查看詳情</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="sarcopenia-tool-widget" class="widget">
                    <h3><i class="icon-ai"></i>AI 風險評估工具</h3>
                    <p>使用院內AI模型，快速評估長者肌少症風險。</p>
                    <button class="btn btn-secondary" onclick="showSubPage('sarcopenia-assessment')">啟動肌少症風險評估 &rarr;</button>
                </div>
            </div>
        </section>

        <section id="case-management-details" class="page sub-page hidden" data-page="case-management-details">
            <header class="subpage-header">
                <button class="btn-back" onclick="showDashboard('clinical-dashboard')">&larr; 返回儀表板</button>
                <h2>個案詳情：陳 O 雄 (HN123456)</h2>
            </header>
            <div class="content-container">
                <h4>代謝症候群風險因子分析</h4>
                <ul class="risk-factor-list">
                    <li class="positive"><strong>腹部肥胖：</strong>腰圍 95 cm (標準: &lt;90 cm)</li>
                    <li class="positive"><strong>血壓偏高：</strong>收縮壓/舒張壓 140/90 mmHg (標準: &lt;130/85 mmHg)</li>
                    <li class="negative"><strong>空腹血糖：</strong>98 mg/dL (標準: &lt;100 mg/dL)</li>
                    <li class="positive"><strong>三酸甘油酯偏高：</strong>180 mg/dL (標準: &lt;150 mg/dL)</li>
                    <li class="positive"><strong>高密度脂蛋白膽固醇偏低：</strong>35 mg/dL (標準: &gt;40 mg/dL)</li>
                </ul>
                <div class="action-panel">
                    <button class="btn btn-primary">納入個案管理</button>
                    <button class="btn btn-secondary-disabled" disabled title="此功能將於第二階段整合">開立數位處方</button>
                </div>
            </div>
        </section>

        <section id="sarcopenia-assessment" class="page sub-page hidden" data-page="sarcopenia-assessment">
            <header class="subpage-header">
                <button class="btn-back" onclick="showDashboard('clinical-dashboard')">&larr; 返回儀表板</button>
                <h2>肌少症 AI 風險評估</h2>
            </header>
            <div class="content-container ai-tool-layout">
                <div class="form-panel">
                    <h4>輸入個案參數</h4>
                    <form id="sarcopenia-form">
                        <div class="form-group">
                            <label for="age">年齡</label>
                            <input type="number" id="age" value="72">
                        </div>
                        <div class="form-group">
                            <label for="gender">性別</label>
                            <select id="gender">
                                <option value="male" selected>男</option>
                                <option value="female">女</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="grip-strength">握力 (kg)</label>
                            <input type="number" id="grip-strength" value="25">
                        </div>
                         <div class="form-group">
                            <label for="gait-speed">行走速度 (m/s)</label>
                            <input type="number" id="gait-speed" step="0.1" value="0.7">
                        </div>
                        <button type="submit" class="btn btn-primary">計算風險</button>
                    </form>
                </div>
                <div id="ai-result-panel" class="result-panel hidden">
                    <h4>AI 模型預測結果</h4>
                    <div class="result-display">
                        <div class="result-metric">
                            <span class="metric-value">42%</span>
                            <span class="metric-label">罹病機率</span>
                        </div>
                        <div class="result-metric">
                            <span class="metric-value risk-medium">中度風險</span>
                            <span class="metric-label">風險分級</span>
                        </div>
                    </div>
                    <div class="recommendation-note">
                        <strong>臨床建議：</strong>建議安排進一步的身體組成分析 (如 DXA) 與功能性體能評估，並考慮轉介營養與復健科。
                    </div>
                </div>
            </div>
        </section>
    </div>

    <div id="admin-portal-container" class="portal-container hidden">
        <section id="admin-dashboard" class="page dashboard" data-page="admin-dashboard">
            <header class="dashboard-header">
                <h2>系統管理員，您好！</h2>
                <p>管理平台使用者權限與監控系統介接服務狀態。</p>
            </header>
            <div class="widget-grid">
                <div class="widget">
                    <h3>使用者管理</h3>
                    <p>管理臨床人員與系統管理員的帳號及權限。</p>
                    <button class="btn btn-link" onclick="showSubPage('user-management-details')">進入使用者管理 &rarr;</button>
                </div>
                <div class="widget">
                    <h3>API 介接管理</h3>
                    <p>監控與外部系統的 API 連線狀態與健康度。</p>
                    <button class="btn btn-link" onclick="showSubPage('api-management-details')">查看 API 狀態 &rarr;</button>
                </div>
            </div>
        </section>

        <section id="user-management-details" class="page sub-page hidden" data-page="user-management-details">
            <header class="subpage-header">
                <button class="btn-back" onclick="showDashboard('admin-dashboard')">&larr; 返回儀表板</button>
                <h2>使用者管理</h2>
            </header>
            <div class="content-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>使用者 ID</th>
                            <th>姓名</th>
                            <th>角色</th>
                            <th>狀態</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>dr_lin</td>
                            <td>林醫師</td>
                            <td>臨床人員</td>
                            <td><span class="status-active">啟用</span></td>
                            <td><button class="btn btn-sm">編輯權限</button> <button class="btn btn-sm btn-danger">停用</button></td>
                        </tr>
                        <tr>
                            <td>nurse_chen</td>
                            <td>陳個管師</td>
                            <td>臨床人員</td>
                            <td><span class="status-active">啟用</span></td>
                            <td><button class="btn btn-sm">編輯權限</button> <button class="btn btn-sm btn-danger">停用</button></td>
                        </tr>
                        <tr>
                            <td>sys_admin</td>
                            <td>系統管理員</td>
                            <td>管理員</td>
                            <td><span class="status-active">啟用</span></td>
                            <td><button class="btn btn-sm">編輯權限</button> <button class="btn btn-sm btn-danger" disabled>停用</button></td>
                        </tr>
                        <tr>
                            <td>dr_wang</td>
                            <td>王醫師</td>
                            <td>臨床人員</td>
                            <td><span class="status-inactive">停用</span></td>
                            <td><button class="btn btn-sm">編輯權限</button> <button class="btn btn-sm btn-success">啟用</button></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section id="api-management-details" class="page sub-page hidden" data-page="api-management-details">
            <header class="subpage-header">
                <button class="btn-back" onclick="showDashboard('admin-dashboard')">&larr; 返回儀表板</button>
                <h2>API 介接狀態監控</h2>
            </header>
            <div class="content-container">
                <div class="api-card">
                    <div class="api-info">
                        <h4>院內 HIS 系統介接</h4>
                        <p>提供病患基本資料與臨床數據</p>
                    </div>
                    <div class="api-status">
                        <span class="status-indicator status-connected"></span>
                        <span class="status-connected">正常連線</span>
                    </div>
                </div>
                <div class="api-card">
                    <div class="api-info">
                        <h4>國健署風險預測模組 (肌少症)</h4>
                        <p>院內 AI 模型 API 服務</p>
                    </div>
                    <div class="api-status">
                        <span class="status-indicator status-connected"></span>
                        <span class="status-connected">正常連線</span>
                    </div>
                </div>
                <div class="api-card">
                    <div class="api-info">
                        <h4>USPSTF 指引資料庫 API</h4>
                        <p>獲取國際最新預防醫學篩檢建議</p>
                    </div>
                    <div class="api-status">
                        <span class="status-indicator status-connected"></span>
                        <span class="status-connected">正常連線</span>
                    </div>
                </div>
                <div class="api-card">
                    <div class="api-info">
                        <h4>亞東 Chatbot 推播 API</h4>
                        <p>向民眾發送個人化健康提醒</p>
                    </div>
                    <div class="api-status">
                        <span class="status-indicator status-error"></span>
                        <span class="status-error">連線異常</span>
                    </div>
                </div>
            </div>
        </section>
    </div> <script>
   document.addEventListener('DOMContentLoaded', () => {
    // 全域狀態變數
    let currentUserRole = null; // 'public', 'clinical', or 'admin'

    // DOM 元素參考
    const loginPortal = document.getElementById('login-portal');
    const publicPortalContainer = document.getElementById('public-portal-container');
    const clinicalPortalContainer = document.getElementById('clinical-portal-container');
    const adminPortalContainer = document.getElementById('admin-portal-container'); // 
    const allPages = document.querySelectorAll('[data-page]');

    // ====================================================
    // 核心導覽函式
    // ====================================================

    /**
     * 顯示指定的頁面，並隱藏所有其他頁面
     * @param {string} pageId 要顯示的頁面的 ID
     */
    function showPage(pageId) {
        // 隱藏所有頁面
        allPages.forEach(page => page.classList.add('hidden'));

        // 顯示目標頁面
        const targetPage = document.getElementById(pageId);
        if (targetPage) {
            targetPage.classList.remove('hidden');
        }

        // 根據角色顯示或隱藏主入口容器
        if (currentUserRole === 'public') {
            loginPortal.classList.add('hidden');
            publicPortalContainer.classList.remove('hidden');
            clinicalPortalContainer.classList.add('hidden');
            if(adminPortalContainer) adminPortalContainer.classList.add('hidden'); // 
        } else if (currentUserRole === 'clinical') {
            loginPortal.classList.add('hidden');
            publicPortalContainer.classList.add('hidden');
            clinicalPortalContainer.classList.remove('hidden');
            if(adminPortalContainer) adminPortalContainer.classList.add('hidden'); // 
        } else if (currentUserRole === 'admin') { // 
            loginPortal.classList.add('hidden');
            publicPortalContainer.classList.add('hidden');
            clinicalPortalContainer.classList.add('hidden');
            if(adminPortalContainer) adminPortalContainer.classList.remove('hidden'); // 
        } else {
            // 登出狀態
            loginPortal.classList.remove('hidden');
            publicPortalContainer.classList.add('hidden');
            clinicalPortalContainer.classList.add('hidden');
            if(adminPortalContainer) adminPortalContainer.classList.add('hidden'); // 
        }
    }

    /**
     * 顯示子頁面 (第三層)
     * @param {string} subPageId 子頁面的 ID
     */
    window.showSubPage = function(subPageId) {
        showPage(subPageId);
    }

    /**
     * 返回到對應的儀表板 (第二層)
     * @param {string} dashboardId 儀表板的 ID
     */
    window.showDashboard = function(dashboardId) {
        showPage(dashboardId);
    }

    // ====================================================
    // D7A/D7A邏輯
    // ====================================================

    function login(role) {
        currentUserRole = role;
        let dashboardId;
        if (role === 'public') {
            dashboardId = 'public-dashboard';
        } else if (role === 'clinical') {
            dashboardId = 'clinical-dashboard';
        } else if (role === 'admin') {
            dashboardId = 'admin-dashboard';
        }
        showPage(dashboardId);
    }

    function logout() {
        currentUserRole = null;
        showPage('login-portal'); // 返回登入頁面
    }

    // ====================================================
    // 事件監聽器綁定
    // ====================================================

    // 登入按鈕
    document.getElementById('login-public').addEventListener('click', () => login('public'));
    document.getElementById('login-clinical').addEventListener('click', () => login('clinical'));
    document.getElementById('login-admin').addEventListener('click', () => login('admin')); // 

    // 登出按鈕
    document.getElementById('logout-public').addEventListener('click', logout);
    document.getElementById('logout-clinical').addEventListener('click', logout);
    // 如果您為管理員後台加上了登出按鈕 (如上方註解所示)，記得也要綁定：
    // document.getElementById('logout-admin').addEventListener('click', logout);

    // 肌少症 AI 模型表單提交模擬
    const sarcopeniaForm = document.getElementById('sarcopenia-form');
    const aiResultPanel = document.getElementById('ai-result-panel');

    sarcopeniaForm.addEventListener('submit', (event) => {
        event.preventDefault(); // 防止表單實際提交
        
        // 模擬 API 呼叫與結果返回
        // 這裡可以使用更複雜的邏輯來根據輸入生成不同的模擬結果
        aiResultPanel.classList.remove('hidden');
    });


    // ====================================================
    // 初始狀態設定
    // ====================================================
    showPage('login-portal'); // 應用程式啟動時顯示登入頁面
});

        async function getSarcopeniaPrediction(patientData) {
    const API_ENDPOINT = 'https://api.hospital.org/v1/predict/sarcopenia';
    const authToken = 'Bearer ' + getJwtToken(); // 從 localStorage 或其他地方獲取 JWT

    try {
        const response = await fetch(API_ENDPOINT, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': authToken // 附加驗證 Token
            },
            body: JSON.stringify(patientData)
        });

        if (!response.ok) {
            throw new Error(`API Error: ${response.status}`);
        }

        const result = await response.json();
        // 返回的 result 應包含 probability 和 riskLevel
        return result; 
    } catch (error) {
        console.error("Failed to fetch prediction:", error);
        // 在 UI 中顯示錯誤訊息
        return null;
    }
}
    </script>
</body>
</html>
