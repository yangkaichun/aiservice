<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YangHome Health | ç™»å…¥èˆ‡è¼¸å…¥</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/x-icon" href="image/yanghealth.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F8FAFC; }
        .glass-card { background: white; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); padding: 2rem; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div id="login-view" class="w-full max-w-md glass-card text-center transition-all duration-500">
        <div class="mb-6">
            <div class="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4">
                <i data-lucide="activity" class="w-8 h-8 text-blue-600"></i>
            </div>
            <h1 class="text-2xl font-bold text-slate-800">YangHome Health</h1>
            <p class="text-slate-500 mt-2">è«‹ç™»å…¥ä»¥é–‹å§‹è¨˜éŒ„æ‚¨çš„å¥åº·æ•¸æ“š</p>
        </div>
        <div id="g_id_onload"
             data-client_id="YOUR_GOOGLE_CLIENT_ID" 
             data-callback="handleCredentialResponse"
             data-auto_select="true"
             data-itp_support="true">
        </div>
        <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline" data-text="sign_in_with" data-shape="rectangular" data-logo_alignment="left"></div>
    </div>

    <div id="input-view" class="hidden w-full max-w-md glass-card transition-all duration-500">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h2 class="text-xl font-bold text-slate-800">æ–°å¢ç´€éŒ„</h2>
                <p id="user-greeting" class="text-sm text-slate-500"></p>
            </div>
            <button onclick="logout()" class="p-2 hover:bg-slate-100 rounded-full text-slate-400 hover:text-slate-600 transition-colors">
                <i data-lucide="log-out" class="w-5 h-5"></i>
            </button>
        </div>

        <form id="healthForm" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">æ¸¬é‡æƒ…å¢ƒ</label>
                <select id="context" class="w-full rounded-lg border-slate-200 focus:border-blue-500 focus:ring-blue-500 p-2.5 bg-slate-50 text-slate-800 text-sm transition-all">
                    <option value="èµ·åºŠç©ºè…¹">ğŸŒ… èµ·åºŠç©ºè…¹</option>
                    <option value="æ—©é¤å¾Œ">ğŸ³ æ—©é¤å¾Œ</option>
                    <option value="åˆé¤å¾Œ">ğŸ± åˆé¤å¾Œ</option>
                    <option value="æ™šé¤å¾Œ">ğŸ½ï¸ æ™šé¤å¾Œ</option>
                    <option value="ç¡å‰">ğŸŒ™ ç¡å‰</option>
                    <option value="èº«é«”ä¸é©">âš ï¸ èº«é«”ä¸é©</option>
                </select>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">æ”¶ç¸®å£“ (SBP)</label>
                    <div class="relative">
                        <input type="number" id="sbp" required class="w-full rounded-lg border-slate-200 focus:border-blue-500 focus:ring-blue-500 pl-10 p-2.5 bg-slate-50 text-slate-800" placeholder="120">
                        <i data-lucide="heart" class="w-4 h-4 text-slate-400 absolute left-3 top-3"></i>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">èˆ’å¼µå£“ (DBP)</label>
                    <div class="relative">
                        <input type="number" id="dbp" required class="w-full rounded-lg border-slate-200 focus:border-blue-500 focus:ring-blue-500 pl-10 p-2.5 bg-slate-50 text-slate-800" placeholder="80">
                        <i data-lucide="activity" class="w-4 h-4 text-slate-400 absolute left-3 top-3"></i>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">å¿ƒç‡ (HR)</label>
                    <div class="relative">
                        <input type="number" id="hr" required class="w-full rounded-lg border-slate-200 focus:border-blue-500 focus:ring-blue-500 pl-10 p-2.5 bg-slate-50 text-slate-800" placeholder="72">
                        <i data-lucide="zap" class="w-4 h-4 text-slate-400 absolute left-3 top-3"></i>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">è¡€ç³– (é¸å¡«)</label>
                    <div class="relative">
                        <input type="number" id="glucose" class="w-full rounded-lg border-slate-200 focus:border-blue-500 focus:ring-blue-500 pl-10 p-2.5 bg-slate-50 text-slate-800" placeholder="100">
                        <i data-lucide="droplet" class="w-4 h-4 text-slate-400 absolute left-3 top-3"></i>
                    </div>
                </div>
            </div>

            <div>
                 <label class="block text-sm font-medium text-slate-700 mb-1">å‚™è¨» (é¸å¡«)</label>
                 <textarea id="note" rows="2" class="w-full rounded-lg border-slate-200 focus:border-blue-500 focus:ring-blue-500 p-2.5 bg-slate-50 text-slate-800 text-sm" placeholder="ä¾‹å¦‚ï¼šå‰›é‹å‹•å®Œ..."></textarea>
            </div>

            <button type="submit" id="btn-submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2.5 rounded-lg shadow-sm hover:shadow transition-all flex items-center justify-center gap-2 mt-2">
                <i data-lucide="send" class="w-4 h-4"></i>
                æäº¤ç´€éŒ„
            </button>
            
            <div id="status-msg" class="text-center text-sm min-h-[20px]"></div>
        </form>

        <div class="mt-6 flex justify-center gap-4 border-t pt-4">
             <a href="dashboard.html" class="flex flex-col items-center gap-1 text-slate-400 hover:text-blue-600 transition-colors">
                 <div class="p-2 bg-slate-50 rounded-lg"><i data-lucide="bar-chart-2" class="w-5 h-5"></i></div>
                 <span class="text-xs">å„€è¡¨æ¿</span>
             </a>
             <a href="phd.html" class="flex flex-col items-center gap-1 text-slate-400 hover:text-blue-600 transition-colors">
                 <div class="p-2 bg-slate-50 rounded-lg"><i data-lucide="user-cog" class="w-5 h-5"></i></div>
                 <span class="text-xs">å¸³è™Ÿè¨­å®š</span>
             </a>
        </div>
    </div>

    <script>
        lucide.createIcons();
        const API_URL = "https://script.google.com/macros/s/AKfycbzQpB9tT-M0Fh.../exec"; // æ›¿æ›ç‚ºä½ çš„ Web App URL
        let currentUser = null;

        function handleCredentialResponse(response) {
            const data = decodeJwtResponse(response.credential);
            currentUser = { 
                email: data.email, 
                name: data.name, 
                picture: data.picture 
            };
            localStorage.setItem('healthUser', JSON.stringify(currentUser));
            showInputView();
        }

        function decodeJwtResponse(token) {
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        function showInputView() {
            document.getElementById('login-view').classList.add('hidden');
            document.getElementById('input-view').classList.remove('hidden');
            document.getElementById('user-greeting').innerText = `Hi, ${currentUser.name}`;
        }

        // Check login
        const savedUser = localStorage.getItem('healthUser');
        if (savedUser) {
            currentUser = JSON.parse(savedUser);
            showInputView();
        }

        function logout() {
            localStorage.removeItem('healthUser');
            location.reload();
        }

        document.getElementById('healthForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn-submit');
            const status = document.getElementById('status-msg');
            const originalContent = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> è™•ç†ä¸­...`;
            lucide.createIcons();

            const payload = {
                action: 'input',
                userEmail: currentUser.email, // å‚³é€ Email çµ¦å¾Œç«¯ï¼Œå¾Œç«¯æœƒè½‰æˆ UID
                context: document.getElementById('context').value,
                sbp: document.getElementById('sbp').value,
                dbp: document.getElementById('dbp').value,
                hr: document.getElementById('hr').value,
                glucose: document.getElementById('glucose').value,
                note: document.getElementById('note').value
            };

            try {
                // ä½¿ç”¨ no-cors æ¨¡å¼ç™¼é€
                await fetch(API_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                status.innerHTML = `<span class="text-emerald-600 flex items-center justify-center gap-1"><i data-lucide="check-circle" class="w-4 h-4"></i> ç´€éŒ„æˆåŠŸï¼</span>`;
                document.getElementById("healthForm").reset();
                lucide.createIcons();

            } catch (error) {
                status.innerHTML = `<span class="text-rose-600">æäº¤å¤±æ•—ï¼Œè«‹é‡è©¦</span>`;
            } finally {
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = originalContent;
                    status.innerHTML = '';
                    lucide.createIcons();
                }, 2000);
            }
        });
    </script>
</body>
</html>