<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>è³‡æ–™è®€å–è¨ºæ–·å·¥å…·</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #222; color: #eee; }
        .box { border: 1px solid #444; padding: 20px; margin-bottom: 20px; background: #333; border-radius: 8px; }
        h2 { margin-top: 0; color: #60a5fa; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; background: #2563eb; color: white; border: none; border-radius: 4px; }
        button:hover { background: #1d4ed8; }
        .log-item { margin: 5px 0; border-bottom: 1px dashed #555; padding-bottom: 2px; }
        .success { color: #4ade80; font-weight: bold; }
        .fail { color: #f87171; font-weight: bold; }
    </style>
</head>
<body>

    <div class="box">
        <h2>ğŸ” è³‡æ–™é€£çµè¨ºæ–·</h2>
        <p>æ¸¬è©¦å¸³è™Ÿ: <strong style="color:#fbbf24">kaichun.yang@gmail.com</strong></p>
        <button onclick="runTest()">é–‹å§‹è¨ºæ–·</button>
    </div>

    <div class="box">
        <h2>ğŸ“ è¨ºæ–·æ—¥èªŒ (Server Log)</h2>
        <div id="logs">ç­‰å¾…é–‹å§‹...</div>
    </div>

    <div class="box">
        <h2>ğŸ“Š æŠ“å–åˆ°çš„è³‡æ–™é è¦½</h2>
        <pre id="data-preview">---</pre>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbzX0k_hP6poVZAxty89nQ6yJyuhNHw4M713G2IQolRPDQnNLFd_By3xqgfpQRtytOQT4A/exec';
        const EMAIL = "kaichun.yang@gmail.com";

        async function runTest() {
            const logDiv = document.getElementById('logs');
            const preview = document.getElementById('data-preview');
            
            logDiv.innerHTML = "é€£ç·šä¸­...";
            preview.innerText = "";

            try {
                // å‘¼å«å¾Œç«¯å°ˆç”¨çš„æ¸¬è©¦æ¥å£
                const res = await fetch(`${API_URL}?action=test_user&email=${EMAIL}&t=${Date.now()}`);
                const json = await res.json();

                // é¡¯ç¤ºæ—¥èªŒ
                if (json.log) {
                    logDiv.innerHTML = json.log.map(l => `<div class="log-item">${l}</div>`).join('');
                }

                // é¡¯ç¤ºçµæœ
                if (json.status === 'success') {
                    if (json.data_count > 0) {
                        logDiv.innerHTML += `<div class="log-item success">ğŸ‰ æˆåŠŸï¼å¾Œç«¯ç¢ºèªæœ‰ ${json.data_count} ç­†è³‡æ–™åŒ¹é…ã€‚</div>`;
                        preview.innerText = JSON.stringify(json.sample_data, null, 2);
                    } else {
                        logDiv.innerHTML += `<div class="log-item fail">âš ï¸ è­¦å‘Šï¼šæ‰¾åˆ°äº†ä½¿ç”¨è€… UIDï¼Œä½†åœ¨ Data è¡¨ä¸­æ²’æœ‰å°æ‡‰çš„è³‡æ–™ã€‚è«‹æª¢æŸ¥ Data è¡¨çš„ B æ¬„æ˜¯å¦å¡«å¯«æ­£ç¢ºçš„ UIDã€‚</div>`;
                    }
                } else {
                    logDiv.innerHTML += `<div class="log-item fail">âŒ å¤±æ•—ï¼š${JSON.stringify(json)}</div>`;
                }

            } catch (e) {
                logDiv.innerHTML = `<div class="fail">é€£ç·šéŒ¯èª¤: ${e.message}</div>`;
            }
        }
    </script>
</body>
</html>