<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>API è¨ºæ–·å·¥å…· v2.0</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f0f0f0; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { margin-top: 0; color: #333; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
        button { background: #2563eb; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; margin-right: 10px; }
        button.debug { background: #dc2626; }
        #status { font-weight: bold; margin: 10px 0; }
        pre { background: #2d2d2d; color: #76e068; padding: 15px; overflow-x: auto; border-radius: 5px; white-space: pre-wrap; }
    </style>
</head>
<body>

    <div class="card">
        <h2>ğŸ” API è³‡æ–™è®€å–è¨ºæ–·</h2>
        <p>æ¸¬è©¦ç›®æ¨™ï¼š<strong>kaichun.yang@gmail.com</strong></p>
        <button onclick="runTest('getDataByUser')">1. è®€å–ä½¿ç”¨è€…è³‡æ–™</button>
        <button onclick="runTest('debug')" class="debug">2. è¨ºæ–·æ¨¡å¼ (æª¢æŸ¥ Sheet å…§å®¹)</button>
        <div id="status">æº–å‚™å°±ç·’...</div>
    </div>

    <div class="card">
        <h2>ğŸ“ ä¼ºæœå™¨å›æ‡‰</h2>
        <pre id="raw-json">ç­‰å¾…åŸ·è¡Œ...</pre>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbzX0k_hP6poVZAxty89nQ6yJyuhNHw4M713G2IQolRPDQnNLFd_By3xqgfpQRtytOQT4A/exec';
        const TARGET_USER = "kaichun.yang@gmail.com";

        async function runTest(action) {
            const statusDiv = document.getElementById('status');
            const rawPre = document.getElementById('raw-json');
            
            statusDiv.innerText = "â³ è«‹æ±‚ä¸­...";
            rawPre.innerText = "Loading...";

            try {
                let url = `${API_URL}?action=${action}&t=${new Date().getTime()}`;
                if(action === 'getDataByUser') url += `&user=${encodeURIComponent(TARGET_USER)}`;

                const response = await fetch(url);
                const text = await response.text();
                
                try {
                    const json = JSON.parse(text);
                    rawPre.innerText = JSON.stringify(json, null, 2);
                    
                    if (action === 'getDataByUser') {
                        statusDiv.innerText = `âœ… è®€å–æˆåŠŸï¼å…± ${json.length} ç­†è³‡æ–™`;
                    } else {
                        statusDiv.innerText = "âœ… è¨ºæ–·è³‡æ–™å·²å›å‚³ï¼Œè«‹æª¢æŸ¥ä¸‹æ–¹ Users/Data è¡¨é ­æ˜¯å¦æ­£ç¢º";
                    }
                } catch (e) {
                    rawPre.innerText = text;
                    statusDiv.innerText = "âŒ JSON è§£æå¤±æ•—";
                }
            } catch (error) {
                statusDiv.innerText = "âŒ é€£ç·šå¤±æ•—: " + error.message;
            }
        }
    </script>
</body>
</html>