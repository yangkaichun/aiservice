<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>亞東紀念醫院 - 全齡預防保健平台</title>
    <link rel="icon" href="image/feticon.ico" type="image/x-icon">
    <link href="[https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css](https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css)" rel="stylesheet">
    <link rel="stylesheet" href="[https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css](https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css)">
    
    <style>
        /* UI/UX: Base Settings - White Background & Clinical Minimalism */
        :root {
            --femh-blue: #0056b3;
            --mono-grey: #555555;
            --mono-light: #f8f9fa;
            --border-color: #dee2e6;
        }

        body {
            background-color: #FFFFFF; /* 強制白色底色 */
            color: #333;
            font-family: "Microsoft JhengHei", Arial, sans-serif;
        }

        /* Sidebar Styling */
       .sidebar {
            background-color: #FFFFFF;
            border-right: 1px solid var(--border-color);
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            z-index: 1000;
            overflow-y: auto;
            padding-top: 1rem;
        }

        /* Monochrome Icons & Links */
       .nav-link {
            color: var(--mono-grey); /* 單色系 ICON 設定 */
            font-weight: 500;
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            transition: all 0.2s;
        }

       .nav-link i {
            margin-right: 12px;
            font-size: 1.1rem;
            color: var(--mono-grey); /* 確保 ICON 為單色 */
        }

       .nav-link:hover {
            background-color: var(--mono-light);
            color: #000;
        }

       .nav-link.active {
            background-color: #f0f7ff;
            color: var(--femh-blue);
            border-right: 3px solid var(--femh-blue);
        }

       .nav-link.active i {
            color: var(--femh-blue);
        }

        /* Level 3 Sub-menu Styling */
       .btn-toggle-nav a {
            padding-left: 3rem;
            font-size: 0.9rem;
            color: #666;
        }
        
       .btn-toggle-nav a:hover {
            background-color: var(--mono-light);
        }

       .btn-toggle-nav a.active {
            color: var(--femh-blue);
            font-weight: 600;
            background-color: transparent;
        }

        /* Main Content Area */
       .main-content {
            margin-left: 280px; /* Match sidebar width */
            padding: 2rem;
        }

        /* Header/Navbar */
       .top-navbar {
            background-color: #FFFFFF;
            border-bottom: 1px solid var(--border-color);
            padding: 0.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 999;
            margin-left: 280px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Utility Cards */
       .content-card {
            background: #fff;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 20px;
        }

       .card-header-custom {
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 1.2rem;
            color: #2c3e50;
        }

        /* Indicator Status Colors */
       .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
       .status-normal { background-color: #198754; }
       .status-warning { background-color: #ffc107; }
       .status-danger { background-color: #dc3545; }

    </style>
</head>
<body>

    <nav class="sidebar d-flex flex-column flex-shrink-0">
        <a href="#" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-dark text-decoration-none px-4" onclick="loadPage('dashboard')">
            <img src="image/fetlogo.png" alt="FEMH Logo" height="40" class="me-3">
            <span class="fs-5 fw-bold text-secondary">預防保健平台</span>
        </a>
        <hr>
        <ul class="nav nav-pills flex-column mb-auto">
            <li class="nav-item">
                <a href="#" class="nav-link active" id="link-dashboard" onclick="loadPage('dashboard')">
                    <i class="bi bi-speedometer2"></i>
                    總覽儀表板
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link collapsed" href="#submenu-preventive" data-bs-toggle="collapse" role="button" aria-expanded="false">
                    <i class="bi bi-heart-pulse"></i>
                    個人化預防保健
                    <i class="bi bi-chevron-down ms-auto" style="font-size: 0.8rem;"></i>
                </a>
                <div class="collapse" id="submenu-preventive">
                    <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                        <li><a href="#" class="nav-link link-dark rounded" id="link-vaccine" onclick="loadPage('vaccine')">疫苗推播管理</a></li>
                        <li><a href="#" class="nav-link link-dark rounded" id="link-cancer" onclick="loadPage('cancer')">USPSTF 癌篩建議</a></li>
                        <li><a href="#" class="nav-link link-dark rounded" id="link-metabolic" onclick="loadPage('metabolic')">代謝症候群管理</a></li>
                    </ul>
                </div>
            </li>

            <li class="nav-item">
                <a class="nav-link collapsed" href="#submenu-ai" data-bs-toggle="collapse" role="button" aria-expanded="false">
                    <i class="bi bi-cpu"></i>
                    AI 風險預測模型
                    <i class="bi bi-chevron-down ms-auto" style="font-size: 0.8rem;"></i>
                </a>
                <div class="collapse" id="submenu-ai">
                    <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                        <li><a href="#" class="nav-link link-dark rounded" id="link-sarcopenia" onclick="loadPage('sarcopenia')">肌少症風險預測</a></li>
                        <li><a href="#" class="nav-link link-secondary rounded text-muted" style="cursor: not-allowed;">骨質疏鬆評估 (Phase 2)</a></li>
                        <li><a href="#" class="nav-link link-secondary rounded text-muted" style="cursor: not-allowed;">衰弱評估 (Phase 2)</a></li>
                    </ul>
                </div>
            </li>
        </ul>
        
        <div class="px-4 pb-4">
            <hr>
            <div class="d-flex align-items-center">
                <div class="flex-shrink-0">
                    <i class="bi bi-person-circle fs-4 text-secondary"></i>
                </div>
                <div class="flex-grow-1 ms-3">
                    <div class="fw-bold">Dr. Lin</div>
                    <div class="text-muted small">家庭醫學科</div>
                </div>
            </div>
        </div>
    </nav>

    <header class="top-navbar">
        <div class="fw-bold text-secondary">
            <span id="page-title">總覽儀表板</span>
        </div>
        <div>
            <button class="btn btn-outline-secondary btn-sm me-2">
                <i class="bi bi-bell"></i>
            </button>
            <button class="btn btn-sm btn-outline-dark">登出</button>
        </div>
    </header>

    <main class="main-content" id="app-content">
        </main>

    <script src="[https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js](https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js)"></script>
    <script src="[https://cdn.jsdelivr.net/npm/chart.js](https://cdn.jsdelivr.net/npm/chart.js)"></script> 
    
    <script>
        // --- Page Templates (Simulating 3-Level Architecture) ---

        const pages = {
            dashboard: `
                <div class="row">
                    <div class="col-md-4">
                        <div class="content-card">
                            <h5 class="text-secondary mb-3">待辦疫苗推播</h5>
                            <h2 class="fw-bold">124 <span class="fs-6 text-muted">件</span></h2>
                            <div class="progress mt-2" style="height: 5px;">
                                <div class="progress-bar bg-primary" role="progressbar" style="width: 75%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="content-card">
                            <h5 class="text-secondary mb-3">AI 高風險篩出 (肌少症)</h5>
                            <h2 class="fw-bold text-danger">18 <span class="fs-6 text-muted">人</span></h2>
                            <div class="text-muted small mt-2">今日新增 3 位高風險個案</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="content-card">
                            <h5 class="text-secondary mb-3">代謝症候群收案</h5>
                            <h2 class="fw-bold text-success">856 <span class="fs-6 text-muted">人</span></h2>
                            <div class="text-muted small mt-2">本月達成率 92%</div>
                        </div>
                    </div>
                </div>
                <div class="content-card">
                    <div class="card-header-custom">近期系統公告</div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div><span class="badge bg-primary me-2">系統</span> USPSTF 癌篩建議指引已更新至 v2025.11 版</div>
                            <span class="text-muted small">2025/11/20</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div><span class="badge bg-warning text-dark me-2">維護</span> 預計於週六進行 AI 模型伺服器維護</div>
                            <span class="text-muted small">2025/11/18</span>
                        </li>
                    </ul>
                </div>
            `,
            metabolic: `
                <div class="content-card">
                    <div class="card-header-custom">代謝症候群風險篩選 (Metabolic Syndrome Screening)</div>
                    <p class="text-muted mb-4">請輸入病患生理數值，系統將依據台灣國健署標準自動判定。</p>
                    
                    <form id="metabolic-form" onsubmit="calculateMetabolic(event)">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">性別</label>
                                <select class="form-select" id="meta-gender">
                                    <option value="M">男 (Male)</option>
                                    <option value="F">女 (Female)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">腰圍 (cm)</label>
                                <input type="number" class="form-control" id="meta-waist" placeholder="男性標準<90, 女性<80">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">收縮壓 (mmHg)</label>
                                <input type="number" class="form-control" id="meta-sbp" placeholder="標準 <130">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">舒張壓 (mmHg)</label>
                                <input type="number" class="form-control" id="meta-dbp" placeholder="標準 <85">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">空腹血糖 (mg/dL)</label>
                                <input type="number" class="form-control" id="meta-glu" placeholder="標準 <100">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">三酸甘油酯 (TG)</label>
                                <input type="number" class="form-control" id="meta-tg" placeholder="標準 <150">
                            </div>
                             <div class="col-md-6">
                                <label class="form-label">HDL-C (mg/dL)</label>
                                <input type="number" class="form-control" id="meta-hdl" placeholder="男>40, 女>50">
                            </div>
                        </div>
                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary"><i class="bi bi-calculator"></i> 計算風險</button>
                            <button type="reset" class="btn btn-outline-secondary">重置</button>
                        </div>
                    </form>

                    <div id="meta-result" class="alert mt-4 d-none" role="alert">
                        </div>
                </div>
            `,
            sarcopenia: `
                <div class="row">
                    <div class="col-md-8">
                        <div class="content-card">
                            <div class="card-header-custom">肌少症 AI 風險預測 (Sarcopenia AI Model)</div>
                            <form>
                                <h6 class="text-primary mb-3">第一部分：SARC-F 問卷 (自我評估)</h6>
                                <div class="mb-3">
                                    <label class="form-label">1. 提舉 4.5 公斤重物有困難嗎？ (Strength)</label>
                                    <select class="form-select form-select-sm"><option>沒有困難 (0)</option><option>有些困難 (1)</option><option>很困難/無法完成 (2)</option></select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">2. 步行穿越一個房間有困難嗎？ (Assistance in walking)</label>
                                    <select class="form-select form-select-sm"><option>沒有困難 (0)</option><option>有些困難 (1)</option><option>很困難/需輔具 (2)</option></select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">3. 從椅子/床上起身有困難嗎？ (Rise from a chair)</label>
                                    <select class="form-select form-select-sm"><option>沒有困難 (0)</option><option>有些困難 (1)</option><option>很困難/無法完成 (2)</option></select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">4. 爬 10 階樓梯有困難嗎？ (Climb stairs)</label>
                                    <select class="form-select form-select-sm"><option>沒有困難 (0)</option><option>有些困難 (1)</option><option>很困難/無法完成 (2)</option></select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">5. 過去一年跌倒過幾次？ (Falls)</label>
                                    <select class="form-select form-select-sm"><option>沒有 (0)</option><option>1-3 次 (1)</option><option>4 次以上 (2)</option></select>
                                </div>

                                <hr class="my-4">
                                <h6 class="text-primary mb-3">第二部分：臨床測量指標 (Clinical Metrics)</h6>
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label class="form-label">小腿圍 (cm)</label>
                                        <input type="number" class="form-control" value="32">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">握力 (kg)</label>
                                        <input type="number" class="form-control" value="24">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">BMI</label>
                                        <input type="number" class="form-control" value="21.5" readonly>
                                    </div>
                                </div>
                                <div class="mt-4 text-end">
                                    <button type="button" class="btn btn-primary btn-lg" onclick="mockAiPredict()">
                                        <i class="bi bi-cpu"></i> 執行 AI 預測
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="content-card text-center" id="ai-result-card" style="opacity: 0.5;">
                            <div class="card-header-custom">預測結果</div>
                            <div class="my-4">
                                <h1 class="display-1 fw-bold" id="risk-score">--%</h1>
                                <p class="text-muted">肌少症風險機率</p>
                            </div>
                            <div id="risk-badges">
                                <span class="badge bg-secondary">等待分析...</span>
                            </div>
                            <hr>
                            <div class="text-start small text-muted">
                                <p><strong>主要風險因子 (SHAP):</strong></p>
                                <ul>
                                    <li>握力不足 (貢獻度: High)</li>
                                    <li>SARC-F 分數 (貢獻度: Med)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            vaccine: `
                <div class="content-card">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div class="card-header-custom mb-0 border-0">疫苗接種時程檢視 (Vaccine Timeline)</div>
                        <div class="input-group w-25">
                            <input type="text" class="form-control" placeholder="輸入病歷號...">
                            <button class="btn btn-outline-primary">查詢</button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>狀態</th>
                                    <th>疫苗名稱</th>
                                    <th>劑次</th>
                                    <th>建議接種日期</th>
                                    <th>實際接種日期</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="badge bg-success rounded-pill">已完成</span></td>
                                    <td>B型肝炎疫苗 (HepB)</td>
                                    <td>第 1 劑</td>
                                    <td>2023/01/01</td>
                                    <td>2023/01/02</td>
                                    <td><button class="btn btn-sm btn-link text-muted">檢視</button></td>
                                </tr>
                                <tr>
                                    <td><span class="badge bg-success rounded-pill">已完成</span></td>
                                    <td>B型肝炎疫苗 (HepB)</td>
                                    <td>第 2 劑</td>
                                    <td>2023/02/01</td>
                                    <td>2023/02/05</td>
                                    <td><button class="btn btn-sm btn-link text-muted">檢視</button></td>
                                </tr>
                                <tr class="table-danger bg-opacity-10">
                                    <td><span class="badge bg-danger rounded-pill">逾期</span></td>
                                    <td>五合一疫苗 (DTaP-IPV-Hib)</td>
                                    <td>第 1 劑</td>
                                    <td>2023/03/01</td>
                                    <td>--</td>
                                    <td><button class="btn btn-sm btn-primary">發送提醒 (Push)</button></td>
                                </tr>
                                <tr>
                                    <td><span class="badge bg-warning text-dark rounded-pill">即將到期</span></td>
                                    <td>結合型肺炎鏈球菌 (PCV13)</td>
                                    <td>第 1 劑</td>
                                    <td>2023/03/15</td>
                                    <td>--</td>
                                    <td><button class="btn btn-sm btn-outline-primary">預約</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `,
            cancer: `
                <div class="content-card">
                    <div class="card-header-custom">USPSTF 智慧癌篩建議 (Smart Screening)</div>
                    <div class="alert alert-info d-flex align-items-center">
                        <i class="bi bi-info-circle-fill me-2"></i>
                        <div>目前模擬對象：<strong>52歲 男性，有吸菸史</strong> (資料來源: API/EMR)</div>
                    </div>
                    
                    <h6 class="mt-4 mb-3 fw-bold">Grade A & B (高度建議項目)</h6>
                    <div class="list-group mb-4">
                        <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-start">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold"><span class="badge bg-primary me-2">Grade A</span>大腸直腸癌篩檢</div>
                                建議每年進行糞便潛血檢查 (FIT) 或每10年進行大腸鏡檢查。
                            </div>
                            <button class="btn btn-sm btn-primary mt-1">開立預約單</button>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-start">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold"><span class="badge bg-primary me-2">Grade B</span>肺癌篩檢 (LDCT)</div>
                                因具有重度吸菸史 (30 pack-years)，建議進行低劑量電腦斷層掃描。
                            </div>
                            <button class="btn btn-sm btn-primary mt-1">開立預約單</button>
                        </a>
                    </div>

                    <h6 class="mt-4 mb-3 fw-bold text-secondary">Grade C (視情況建議)</h6>
                    <div class="list-group">
                         <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-start bg-light">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold"><span class="badge bg-secondary me-2">Grade C</span>攝護腺癌篩檢 (PSA)</div>
                                建議與醫師討論篩檢之利弊得失 (Shared Decision Making)。
                            </div>
                            <button class="btn btn-sm btn-outline-secondary mt-1">衛教資訊</button>
                        </a>
                    </div>
                </div>
            `
        };

        // --- Functions ---

        // 1. Navigation Router
        function loadPage(pageId) {
            // Update Content
            const contentDiv = document.getElementById('app-content');
            const pageTitle = document.getElementById('page-title');
            
            if(pages[pageId]) {
                contentDiv.innerHTML = pages[pageId];
            } else {
                contentDiv.innerHTML = `<div class="alert alert-warning">此模組仍在開發中 (Phase 2)</div>`;
            }

            // Update Sidebar Active State
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            // Fix for level 2/3 highlighting logic would go here, simple version:
            const activeLink = document.getElementById(`link-${pageId}`);
            if(activeLink) activeLink.classList.add('active');

            // Update Title
            const titles = {
                'dashboard': '總覽儀表板',
                'metabolic': '代謝症候群管理',
                'sarcopenia': '肌少症 AI 風險預測',
                'vaccine': '疫苗推播管理',
                'cancer': 'USPSTF 癌篩建議'
            };
            pageTitle.textContent = titles[pageId] |

| '預防保健平台';
        }

        // 2. Metabolic Syndrome Calculation Logic (Taiwan Standard)
        function calculateMetabolic(event) {
            event.preventDefault();
            const gender = document.getElementById('meta-gender').value;
            const waist = parseFloat(document.getElementById('meta-waist').value);
            const sbp = parseFloat(document.getElementById('meta-sbp').value);
            const dbp = parseFloat(document.getElementById('meta-dbp').value);
            const glu = parseFloat(document.getElementById('meta-glu').value);
            const tg = parseFloat(document.getElementById('meta-tg').value);
            const hdl = parseFloat(document.getElementById('meta-hdl').value);
            
            let riskCount = 0;
            let reasons =;

            // 1. Waist
            if ((gender === 'M' && waist >= 90) |

| (gender === 'F' && waist >= 80)) {
                riskCount++;
                reasons.push("腹部肥胖");
            }
            // 2. BP
            if (sbp >= 130 |

| dbp >= 85) {
                riskCount++;
                reasons.push("血壓偏高");
            }
            // 3. Glucose
            if (glu >= 100) {
                riskCount++;
                reasons.push("空腹血糖偏高");
            }
            // 4. TG
            if (tg >= 150) {
                riskCount++;
                reasons.push("三酸甘油酯偏高");
            }
            // 5. HDL
            if ((gender === 'M' && hdl < 40) |

| (gender === 'F' && hdl < 50)) {
                riskCount++;
                reasons.push("HDL-C 偏低");
            }

            const resultDiv = document.getElementById('meta-result');
            resultDiv.classList.remove('d-none', 'alert-success', 'alert-danger', 'alert-warning');
            
            if (riskCount >= 3) {
                resultDiv.classList.add('alert-danger');
                resultDiv.innerHTML = `<strong><i class="bi bi-exclamation-triangle-fill"></i> 判定為代謝症候群</strong><br>符合指標 (${riskCount}/5): ${reasons.join(', ')}`;
            } else if (riskCount > 0) {
                resultDiv.classList.add('alert-warning');
                resultDiv.innerHTML = `<strong>注意</strong><br>目前符合 ${riskCount} 項指標 (${reasons.join(', ')}), 未達代謝症候群標準 (3項)。`;
            } else {
                resultDiv.classList.add('alert-success');
                resultDiv.innerHTML = `<strong>健康</strong><br>各項指標皆在正常範圍內。`;
            }
        }

        // 3. Mock AI Prediction
        function mockAiPredict() {
            const card = document.getElementById('ai-result-card');
            const score = document.getElementById('risk-score');
            const badges = document.getElementById('risk-badges');
            
            card.style.opacity = '1';
            // Simulate loading
            score.innerHTML = '<div class="spinner-border text-primary" role="status"></div>';
            
            setTimeout(() => {
                // Mock Result
                const randomRisk = Math.floor(Math.random() * 30) + 50; // 50-80%
                score.innerText = randomRisk + '%';
                score.className = "display-1 fw-bold " + (randomRisk > 70? "text-danger" : "text-warning");
                
                badges.innerHTML = `
                    <span class="badge bg-danger mb-2">高風險 (High Risk)</span><br>
                    <button class="btn btn-sm btn-outline-dark mt-2">產生運動處方 (Phase 2)</button>
                `;
            }, 1000);
        }

        // Initialize
        window.onload = () => loadPage('dashboard');

    </script>
</body>
</html>