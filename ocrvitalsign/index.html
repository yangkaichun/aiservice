<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health+ (安全讀取 Key 版)</title>
    <style>
        /* (保留原本的 CSS 樣式) */
        body { font-family: sans-serif; background: #121212; color: white; margin: 0; padding: 20px; text-align: center;}
        #loading-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:black; display:flex; justify-content:center; align-items:center; z-index:999; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="loading-overlay">
    <div>讀取設定檔中...</div>
</div>

<div id="app-content" class="hidden">
    <h1>Health+ 系統</h1>
    <p>API Key 載入狀態：<span style="color:#4CAF50">✅ 成功</span></p>
    <button onclick="testApi()">測試 API 連線</button>
</div>

<script>
    // 全域變數，用來存 Key
    let GLOBAL_API_KEY = "";

    // 程式進入點
    window.addEventListener('load', async () => {
        try {
            // 1. 嘗試讀取 config/key.json
            // 注意：必須使用 Server 開啟 (如 Live Server)，不能直接點兩下 index.html
            const response = await fetch('./config/key.json');
            
            if (!response.ok) {
                throw new Error("找不到 key.json，請確認檔案位置");
            }

            const config = await response.json();
            
            if (config.GOOGLE_API_KEY && config.GOOGLE_API_KEY !== "YOUR_API_KEY_HERE") {
                GLOBAL_API_KEY = config.GOOGLE_API_KEY;
                console.log("金鑰載入成功");
                initApp(); // 啟動主程式
            } else {
                throw new Error("key.json 內容無效或為範本");
            }

        } catch (error) {
            console.error(error);
            alert("❌ 設定檔讀取失敗：\n請確保 config/key.json 存在且格式正確。\n" + error.message);
            // 可以在這裡加入 fallback，例如跳出 prompt 讓使用者手動輸入
        }
    });

    // 初始化應用程式 (原本的 onload 邏輯移到這裡)
    function initApp() {
        // 隱藏 Loading，顯示主畫面
        document.getElementById('loading-overlay').classList.add('hidden');
        document.getElementById('app-content').classList.remove('hidden');
        
        // 這裡執行原本的 initCamera() 或其他初始化
        // initCamera(); 
    }

    // 模擬使用 API 的函式
    function testApi() {
        if (!GLOBAL_API_KEY) return alert("沒有 Key！");
        alert("正在使用 Key: " + GLOBAL_API_KEY.substring(0, 5) + "..." + " 呼叫 Google Vision API");
        
        // 這裡接原本的 callGoogleAPI(base64, mode) 邏輯
        // callGoogleAPI(..., GLOBAL_API_KEY);
    }

</script>
</body>
</html>