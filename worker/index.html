<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HODS 醫院派工系統</title>
    
    <!-- Favicon Configuration -->
    <link rel="shortcut icon" href="feticon.ico" type="image/x-icon">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Prop Types (Required for Recharts UMD to work correctly) -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>

    <!-- Recharts (Chart library for React) - Using specific version for stability -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons (Lightweight icon set) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8fafc; /* Very light gray, almost white */
            overflow-x: hidden;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        /* Loading Animation Styles */
        .loader-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
            transition: opacity 0.5s ease-out;
        }
        
        .loader-hidden {
            opacity: 0;
            pointer-events: none;
        }

        .pulse-ring {
            content: '';
            width: 80px;
            height: 80px;
            border: 4px solid #3b82f6;
            border-radius: 50%;
            animation: pulse-ring 1.25s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }

        @keyframes pulse-ring {
            0% { transform: scale(0.33); opacity: 1; }
            80%, 100% { transform: scale(1); opacity: 0; }
        }

        /* Card Hover Effect */
        .hover-card {
            transition: all 0.2s ease-in-out;
        }
        .hover-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        // Ensure Recharts is defined before destructuring
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell } = window.Recharts || {};

        // --- Mock Data ---
        const MOCK_DATA = {
            stats: [
                { title: "待處理維修", value: 12, color: "text-red-500", icon: "Wrench" },
                { title: "今日請求", value: 45, color: "text-blue-500", icon: "FileText" },
                { title: "清潔任務", value: 8, color: "text-green-500", icon: "Sparkles" },
                { title: "設備妥善率", value: "98%", color: "text-purple-500", icon: "Activity" },
            ],
            chartData: [
                { name: '08:00', requests: 12, repairs: 2 },
                { name: '10:00', requests: 19, repairs: 5 },
                { name: '12:00', requests: 8, repairs: 1 },
                { name: '14:00', requests: 25, repairs: 6 },
                { name: '16:00', requests: 15, repairs: 3 },
                { name: '18:00', requests: 10, repairs: 4 },
            ],
            pieData: [
                { name: '已完成', value: 400 },
                { name: '處理中', value: 300 },
                { name: '待指派', value: 100 },
                { name: '異常', value: 50 },
            ],
            modules: [
                { id: 'repair', title: '儀器維修', icon: 'Stethoscope', desc: '醫療儀器故障排除與報修' },
                { id: 'request', title: '人員請求', icon: 'UserPlus', desc: '護理站人力支援與物資請求' },
                { id: 'maintain', title: '設備維護', icon: 'Settings', desc: '定期保養與巡檢排程' },
                { id: 'clean', title: '清潔派工', icon: 'SprayCan', desc: '病房與公共區域清潔調度' },
            ],
            tasks: [
                { id: 101, type: 'repair', title: '呼吸器故障 (Ventilator-02)', location: 'ICU-Bed 5', priority: 'High', status: 'Pending', time: '10:30', requester: '林護理長' },
                { id: 102, type: 'clean', title: '病床終期清潔', location: 'Ward 702', priority: 'Normal', status: 'Processing', time: '11:15', requester: '陳護理師' },
                { id: 103, type: 'maintain', title: 'MRI 季保養', location: 'Radiology', priority: 'Scheduled', status: 'Pending', time: '14:00', requester: '系統排程' },
                { id: 104, type: 'repair', title: '輸液幫浦異常', location: 'ER-03', priority: 'High', status: 'Done', time: '09:00', requester: '王醫師' },
            ]
        };

        const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042'];

        // --- Components ---

        // 1. Icon Helper
        const Icon = ({ name, size = 20, className = "" }) => {
            const lucideIcon = window.lucide && window.lucide.icons ? window.lucide.icons[name] : null;
            if (!lucideIcon) return <span className={className}>?</span>;
            
            return (
                <svg 
                    width={size} 
                    height={size} 
                    viewBox="0 0 24 24" 
                    fill="none" 
                    stroke="currentColor" 
                    strokeWidth="2" 
                    strokeLinecap="round" 
                    strokeLinejoin="round" 
                    className={className}
                    dangerouslySetInnerHTML={{ __html: lucideIcon.toSvg().match(/<svg[^>]*>([\s\S]*?)<\/svg>/)[1] }}
                />
            );
        };

        // 2. Loading Screen
        const LoadingScreen = ({ visible }) => {
            if (!visible) return null;
            return (
                <div className={`loader-container ${!visible ? 'loader-hidden' : ''}`}>
                    <div className="pulse-ring"></div>
                    <div className="mt-8 text-xl font-bold text-gray-600 tracking-widest">HODS</div>
                    <div className="text-sm text-gray-400 mt-2">系統載入中...</div>
                </div>
            );
        };

        // 3. Navigation Breadcrumb
        const Breadcrumb = ({ path, onNavigate }) => (
            <div className="flex items-center text-sm text-gray-500 mb-6">
                <span 
                    className="cursor-pointer hover:text-blue-600" 
                    onClick={() => onNavigate('home')}
                >
                    首頁
                </span>
                {path.map((p, idx) => (
                    <React.Fragment key={idx}>
                        <span className="mx-2">/</span>
                        <span 
                            className={`${idx === path.length - 1 ? 'font-bold text-gray-800' : 'cursor-pointer hover:text-blue-600'}`}
                            onClick={() => idx !== path.length - 1 && onNavigate(p.id)}
                        >
                            {p.label}
                        </span>
                    </React.Fragment>
                ))}
            </div>
        );

        // 4. Main Application Component
        const App = () => {
            const [loading, setLoading] = useState(true);
            // Navigation Stack: [{id: 'home', label: 'Home'}, {id: 'repair', label: '儀器維修'}]
            const [navPath, setNavPath] = useState([]); 
            const [selectedTask, setSelectedTask] = useState(null);

            // Simulate 3s loading
            useEffect(() => {
                const timer = setTimeout(() => setLoading(false), 3000);
                return () => clearTimeout(timer);
            }, []);

            // Navigation Handlers
            const goHome = () => {
                setNavPath([]);
                setSelectedTask(null);
            };

            const goToModule = (moduleId, moduleTitle) => {
                setNavPath([{ id: moduleId, label: moduleTitle }]);
                setSelectedTask(null);
            };

            const goToDetail = (task) => {
                setNavPath([...navPath, { id: 'detail', label: '任務詳情' }]);
                setSelectedTask(task);
            };

            const goBack = () => {
                if (selectedTask) {
                    // Back from detail to list
                    const newPath = [...navPath];
                    newPath.pop();
                    setNavPath(newPath);
                    setSelectedTask(null);
                } else {
                    // Back from list to home
                    setNavPath([]);
                }
            };

            // --- Render Logic ---
            
            // View: Dashboard (Layer 1)
            const renderDashboard = () => (
                <div className="animate-fade-in">
                    {/* Stats Row */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        {MOCK_DATA.stats.map((stat, idx) => (
                            <div key={idx} className="bg-white p-6 rounded-xl shadow-sm hover-card border border-gray-100">
                                <div className="flex justify-between items-start">
                                    <div>
                                        <p className="text-sm text-gray-500 mb-1">{stat.title}</p>
                                        <h3 className="text-3xl font-bold text-gray-800">{stat.value}</h3>
                                    </div>
                                    <div className={`p-3 rounded-lg bg-opacity-10 ${stat.color.replace('text-', 'bg-')}`}>
                                        <Icon name={stat.icon} className={stat.color} size={24} />
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* Modules Grid */}
                    <h2 className="text-xl font-bold text-gray-800 mb-4">功能模組</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        {MOCK_DATA.modules.map((mod) => (
                            <div 
                                key={mod.id} 
                                onClick={() => goToModule(mod.id, mod.title)}
                                className="bg-white p-6 rounded-xl shadow-sm hover-card cursor-pointer border border-gray-100 group"
                            >
                                <div className="flex items-center mb-4">
                                    <div className="p-3 bg-blue-50 rounded-lg group-hover:bg-blue-100 transition-colors">
                                        <Icon name={mod.icon} className="text-blue-600" size={24} />
                                    </div>
                                </div>
                                <h3 className="text-lg font-semibold text-gray-800 mb-2">{mod.title}</h3>
                                <p className="text-sm text-gray-500">{mod.desc}</p>
                            </div>
                        ))}
                    </div>

                    {/* Charts Section */}
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 lg:col-span-2">
                            <h3 className="text-lg font-semibold text-gray-800 mb-6">即時流量監控</h3>
                            <div className="h-64">
                                <ResponsiveContainer width="100%" height="100%">
                                    {LineChart ? (
                                        <LineChart data={MOCK_DATA.chartData}>
                                            <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                                            <XAxis dataKey="name" stroke="#94a3b8" />
                                            <YAxis stroke="#94a3b8" />
                                            <Tooltip 
                                                contentStyle={{ backgroundColor: '#fff', borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)' }}
                                            />
                                            <Line type="monotone" dataKey="requests" stroke="#3b82f6" strokeWidth={3} dot={{ r: 4 }} name="請求數" />
                                            <Line type="monotone" dataKey="repairs" stroke="#ef4444" strokeWidth={3} dot={{ r: 4 }} name="維修數" />
                                        </LineChart>
                                    ) : <div className="flex items-center justify-center h-full text-gray-400">圖表載入中...</div>}
                                </ResponsiveContainer>
                            </div>
                        </div>
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <h3 className="text-lg font-semibold text-gray-800 mb-6">案件狀態分佈</h3>
                            <div className="h-64">
                                <ResponsiveContainer width="100%" height="100%">
                                    {PieChart ? (
                                        <PieChart>
                                            <Pie
                                                data={MOCK_DATA.pieData}
                                                cx="50%"
                                                cy="50%"
                                                innerRadius={60}
                                                outerRadius={80}
                                                paddingAngle={5}
                                                dataKey="value"
                                            >
                                                {MOCK_DATA.pieData.map((entry, index) => (
                                                    <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                                                ))}
                                            </Pie>
                                            <Tooltip />
                                        </PieChart>
                                    ) : <div className="flex items-center justify-center h-full text-gray-400">圖表載入中...</div>}
                                </ResponsiveContainer>
                                <div className="flex justify-center gap-4 mt-4">
                                    {MOCK_DATA.pieData.map((entry, index) => (
                                        <div key={index} className="flex items-center text-xs text-gray-500">
                                            <div className="w-2 h-2 rounded-full mr-1" style={{ backgroundColor: COLORS[index % COLORS.length] }}></div>
                                            {entry.name}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );

            // View: List (Layer 2)
            const renderList = () => {
                const currentModuleId = navPath[0].id;
                // Filter tasks based on module (simple mock logic)
                const filteredTasks = MOCK_DATA.tasks.filter(t => t.type === currentModuleId || currentModuleId === 'request');
                
                return (
                    <div className="animate-fade-in">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold text-gray-800">{navPath[0].label} - 任務列表</h2>
                            <button className="bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center hover:bg-blue-700 transition-colors">
                                <Icon name="Plus" size={18} className="mr-2" />
                                新增任務
                            </button>
                        </div>

                        <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                            <table className="w-full text-left">
                                <thead className="bg-gray-50 border-b border-gray-100">
                                    <tr>
                                        <th className="p-4 text-sm font-semibold text-gray-600">ID</th>
                                        <th className="p-4 text-sm font-semibold text-gray-600">標題</th>
                                        <th className="p-4 text-sm font-semibold text-gray-600">位置</th>
                                        <th className="p-4 text-sm font-semibold text-gray-600">優先級</th>
                                        <th className="p-4 text-sm font-semibold text-gray-600">狀態</th>
                                        <th className="p-4 text-sm font-semibold text-gray-600">操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredTasks.length > 0 ? filteredTasks.map(task => (
                                        <tr key={task.id} className="border-b border-gray-50 hover:bg-blue-50/50 transition-colors">
                                            <td className="p-4 text-gray-600">#{task.id}</td>
                                            <td className="p-4 font-medium text-gray-800">{task.title}</td>
                                            <td className="p-4 text-gray-600 flex items-center">
                                                <Icon name="MapPin" size={14} className="mr-1 text-gray-400" />
                                                {task.location}
                                            </td>
                                            <td className="p-4">
                                                <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                                                    task.priority === 'High' ? 'bg-red-100 text-red-700' : 
                                                    task.priority === 'Scheduled' ? 'bg-purple-100 text-purple-700' :
                                                    'bg-green-100 text-green-700'
                                                }`}>
                                                    {task.priority}
                                                </span>
                                            </td>
                                            <td className="p-4">
                                                <span className="flex items-center text-sm text-gray-600">
                                                    <span className={`w-2 h-2 rounded-full mr-2 ${
                                                        task.status === 'Pending' ? 'bg-yellow-400' :
                                                        task.status === 'Processing' ? 'bg-blue-400' :
                                                        'bg-green-400'
                                                    }`}></span>
                                                    {task.status}
                                                </span>
                                            </td>
                                            <td className="p-4">
                                                <button 
                                                    onClick={() => goToDetail(task)}
                                                    className="text-blue-600 hover:text-blue-800 font-medium text-sm"
                                                >
                                                    查看詳情
                                                </button>
                                            </td>
                                        </tr>
                                    )) : (
                                        <tr>
                                            <td colSpan="6" className="p-8 text-center text-gray-400">目前此類別無待辦任務</td>
                                        </tr>
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>
                );
            };

            // View: Detail (Layer 3)
            const renderDetail = () => {
                if (!selectedTask) return null;
                return (
                    <div className="animate-fade-in max-w-4xl mx-auto">
                        <div className="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden">
                            {/* Header */}
                            <div className="p-6 border-b border-gray-100 bg-gray-50 flex justify-between items-center">
                                <div>
                                    <div className="flex items-center gap-3 mb-2">
                                        <span className="text-sm font-mono text-gray-500">#{selectedTask.id}</span>
                                        <span className={`px-2 py-0.5 rounded text-xs font-medium ${
                                            selectedTask.priority === 'High' ? 'bg-red-100 text-red-700' : 'bg-blue-100 text-blue-700'
                                        }`}>
                                            {selectedTask.priority}
                                        </span>
                                    </div>
                                    <h1 className="text-2xl font-bold text-gray-800">{selectedTask.title}</h1>
                                </div>
                                <div className="flex gap-2">
                                    <button className="p-2 text-gray-500 hover:bg-white hover:shadow rounded-lg transition-all">
                                        <Icon name="Printer" size={20} />
                                    </button>
                                    <button className="p-2 text-gray-500 hover:bg-white hover:shadow rounded-lg transition-all">
                                        <Icon name="Share2" size={20} />
                                    </button>
                                </div>
                            </div>

                            {/* Body */}
                            <div className="p-8 grid grid-cols-1 md:grid-cols-3 gap-8">
                                {/* Left Column: Info */}
                                <div className="md:col-span-2 space-y-6">
                                    <div>
                                        <h3 className="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3">基本資訊</h3>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="bg-gray-50 p-4 rounded-lg">
                                                <p className="text-xs text-gray-500 mb-1">發生地點</p>
                                                <p className="font-medium text-gray-800 flex items-center">
                                                    <Icon name="MapPin" size={16} className="mr-2 text-blue-500" />
                                                    {selectedTask.location}
                                                </p>
                                            </div>
                                            <div className="bg-gray-50 p-4 rounded-lg">
                                                <p className="text-xs text-gray-500 mb-1">通報時間</p>
                                                <p className="font-medium text-gray-800 flex items-center">
                                                    <Icon name="Clock" size={16} className="mr-2 text-blue-500" />
                                                    {selectedTask.time}
                                                </p>
                                            </div>
                                            <div className="bg-gray-50 p-4 rounded-lg">
                                                <p className="text-xs text-gray-500 mb-1">通報人員</p>
                                                <p className="font-medium text-gray-800 flex items-center">
                                                    <Icon name="User" size={16} className="mr-2 text-blue-500" />
                                                    {selectedTask.requester}
                                                </p>
                                            </div>
                                            <div className="bg-gray-50 p-4 rounded-lg">
                                                <p className="text-xs text-gray-500 mb-1">目前狀態</p>
                                                <p className="font-medium text-gray-800">{selectedTask.status}</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div>
                                        <h3 className="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3">處理紀錄</h3>
                                        <div className="border-l-2 border-blue-100 pl-4 space-y-6">
                                            <div className="relative">
                                                <div className="absolute -left-[21px] top-1 w-3 h-3 rounded-full bg-blue-500 border-2 border-white"></div>
                                                <p className="text-sm text-gray-500 mb-1">10:35 AM</p>
                                                <p className="text-gray-800">系統自動分派給維修組。</p>
                                            </div>
                                            <div className="relative">
                                                <div className="absolute -left-[21px] top-1 w-3 h-3 rounded-full bg-gray-300 border-2 border-white"></div>
                                                <p className="text-sm text-gray-500 mb-1">10:30 AM</p>
                                                <p className="text-gray-800">林護理長 建立此請求。</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Right Column: Actions */}
                                <div className="space-y-4">
                                    <h3 className="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3">執行操作</h3>
                                    <button className="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors flex justify-center items-center shadow-lg shadow-blue-200">
                                        <Icon name="CheckCircle" size={18} className="mr-2" />
                                        接單處理
                                    </button>
                                    <button className="w-full py-3 bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 rounded-lg font-medium transition-colors flex justify-center items-center">
                                        <Icon name="MessageSquare" size={18} className="mr-2" />
                                        新增註記
                                    </button>
                                    <button className="w-full py-3 bg-white border border-gray-200 text-red-600 hover:bg-red-50 hover:border-red-200 rounded-lg font-medium transition-colors flex justify-center items-center">
                                        <Icon name="AlertTriangle" size={18} className="mr-2" />
                                        回報異常
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen flex flex-col">
                    {loading && <LoadingScreen visible={loading} />}
                    
                    {/* Navbar */}
                    <nav className="bg-white border-b border-gray-200 sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between h-16">
                                <div className="flex items-center cursor-pointer" onClick={goHome}>
                                    {/* Logo Handling with Fallback */}
                                    <img 
                                        src="image/fetlogo.png" 
                                        alt="FET Logo" 
                                        className="h-8 mr-3"
                                        onError={(e) => {
                                            e.target.style.display = 'none';
                                            e.target.nextSibling.style.display = 'block';
                                        }}
                                    />
                                    <div className="hidden text-2xl font-bold text-blue-600 mr-3">FET</div>
                                    <div className="border-l border-gray-300 h-6 mx-2"></div>
                                    <span className="text-gray-800 font-medium text-lg tracking-wide">HODS 醫院派工系統</span>
                                </div>
                                <div className="flex items-center space-x-4">
                                    <button className="p-2 text-gray-400 hover:text-gray-600 relative">
                                        <Icon name="Bell" />
                                        <span className="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
                                    </button>
                                    <div className="flex items-center gap-2 pl-4 border-l border-gray-200">
                                        <div className="w-8 h-8 rounded-full bg-gradient-to-tr from-blue-500 to-cyan-400 flex items-center justify-center text-white text-xs font-bold">
                                            AD
                                        </div>
                                        <div className="hidden md:block text-sm">
                                            <p className="text-gray-700 font-medium">Admin User</p>
                                            <p className="text-xs text-gray-400">System Manager</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="flex-1 bg-slate-50 p-4 sm:p-6 lg:p-8">
                        <div className="max-w-7xl mx-auto">
                            {navPath.length > 0 && <Breadcrumb path={navPath} onNavigate={(id) => id === 'home' ? goHome() : goBack()} />}
                            
                            {navPath.length === 0 && renderDashboard()}
                            {navPath.length === 1 && renderList()}
                            {navPath.length === 2 && renderDetail()}
                        </div>
                    </main>

                    {/* Footer */}
                    <footer className="bg-white border-t border-gray-200 mt-auto">
                        <div className="max-w-7xl mx-auto py-4 px-4 text-center text-xs text-gray-400">
                            &copy; 2025 FET Hospital Operations Dispatch System. All rights reserved.
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>