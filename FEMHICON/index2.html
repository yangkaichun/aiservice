<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>äºæ±é†«é™¢é«˜è§£æç‰ˆé¢ç”¢ç”Ÿå™¨ (800+ CDNåœ–ç¤ºæ“´å……ç‰ˆ)</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
    /* === åŸºç¤è¨­å®š === */
    body {
        margin: 0;
        padding: 0;
        font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
        background-color: #333;
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow: hidden;
    }

    /* === ä¸ŠåŠéƒ¨ï¼šé è¦½å€ === */
    #preview-area {
        flex: 1;
        background-color: #222;
        overflow: auto;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        position: relative;
    }

    #scale-wrapper {
        transform-origin: center center;
        transform: scale(0.25); /* é è¨­ç¸®å°ä»¥ä¾¿é è¦½ */
        box-shadow: 0 0 50px rgba(0,0,0,0.5);
        transition: transform 0.3s;
    }

    /* é€™æ˜¯åŸå§‹ç•«å¸ƒï¼Œå°ºå¯¸å›ºå®šç‚º 2500x1686 */
    #main-canvas {
        width: 2500px;
        height: 1686px;
        background-color: #f4f6f8; /* [é—œéµ] ç°è‰²èƒŒæ™¯ */
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: 50px;
        padding: 60px;
        box-sizing: border-box;
    }

    /* === å¡ç‰‡æ¨£å¼ === */
    .slot-card {
        background-color: #ffffff; /* [é—œéµ] ç™½è‰²å¡ç‰‡ */
        border-radius: 40px;       /* [é—œéµ] åœ“è§’ */
        box-shadow: 0 12px 40px rgba(0,0,0,0.06); 
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        cursor: pointer;
        border: 10px solid transparent; 
        transition: transform 0.2s, box-shadow 0.2s;
        position: relative;
        overflow: hidden; 
    }

    .slot-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 50px rgba(0,0,0,0.1);
    }

    /* é¸å–ç‹€æ…‹ (ç´…æ¡†) */
    .slot-card.active-slot {
        border-color: #ff3333;
        box-shadow: 0 0 50px rgba(255, 50, 50, 0.4);
        z-index: 10;
    }

    /* ä¸‹è¼‰æ™‚éš±è—é¸å–æ¡† (é€é JS æ·»åŠ  class) */
    #main-canvas.hide-selection .slot-card.active-slot {
        border-color: transparent !important;
        box-shadow: 0 12px 40px rgba(0,0,0,0.06) !important;
        transform: none !important;
        z-index: auto !important;
    }

    /* ç¶ è‰²ç‰¹åˆ¥ç‰ˆå¡ç‰‡ */
    .slot-card.special-green {
        background-color: #00854a;
    }
    .slot-card.special-green .icon-display,
    .slot-card.special-green .label-display,
    .slot-card.special-green .external-icon-render {
        fill: #ffffff !important;
        stroke: #ffffff !important;
        color: #ffffff !important;
    }
    .slot-card.special-green .icon-outline { fill: none !important; stroke: #ffffff !important; }
    .slot-card.special-green .icon-fill { fill: #ffffff !important; stroke: none !important; }

    /* SVG Icon é¡¯ç¤ºè¨­å®š */
    .icon-display {
        width: 250px;
        height: 250px;
        margin-bottom: 40px;
        fill: #00854a;
        pointer-events: none;
    }
    .icon-display.icon-outline {
        fill: none;
        stroke: #00854a;
        stroke-width: 5;
        stroke-linecap: round;
        stroke-linejoin: round;
    }
    .icon-display.icon-fill {
        fill: #00854a;
        stroke: none;
    }

    /* å¤–éƒ¨ CDN Icon é¡¯ç¤ºè¨­å®š */
    .external-icon-render {
        font-size: 180px;
        line-height: 1;
        color: #00854a;
        margin-bottom: 40px;
        display: inline-block;
        pointer-events: none;
    }
    /* Material Icons ç‰¹æ®Šèª¿æ•´ */
    .material-icons.external-icon-render {
        font-size: 220px; 
    }

    .label-display {
        font-size: 80px;
        font-weight: bold;
        color: #333;
        line-height: 1.3;
        pointer-events: none;
        white-space: pre-wrap;
        min-height: 1.3em;
    }

    /* === ä¸‹åŠéƒ¨ï¼šæ§åˆ¶é¢æ¿ === */
    #library-area {
        height: 380px;
        background-color: #fff;
        border-top: 1px solid #ccc;
        display: flex;
        flex-direction: column;
        transition: height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: hidden;
        position: relative;
        z-index: 100;
    }

    #library-area.hidden { height: 0; border-top: none; }

    .control-header {
        padding: 15px 20px;
        background: #eee;
        border-bottom: 1px solid #ddd;
        display: flex;
        align-items: center;
        gap: 20px;
        flex-wrap: wrap;
    }

    .edit-group {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .edit-group input, .edit-group select {
        padding: 8px 12px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }
    .edit-group label {
        font-weight: bold;
        color: #333;
    }

    /* åœ–ç¤ºåº«æ²å‹•å€ */
    .library-scroll {
        flex: 1;
        overflow-y: auto;
        display: flex;
        flex-wrap: wrap; 
        padding: 15px;
        gap: 10px;
        align-content: flex-start;
        background-color: #fafafa;
    }
    
    .lib-item {
        width: 80px;
        height: 80px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background: #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
        padding: 5px;
        position: relative;
    }
    .lib-item:hover {
        background-color: #e8f5e9;
        border-color: #00854a;
        transform: scale(1.05);
        z-index: 2;
    }
    /* å…§å»º SVG å°åœ–ç¤º */
    .lib-item svg {
        width: 40px;
        height: 40px;
        fill: #00854a;
    }
    /* å¤–éƒ¨ CDN å°åœ–ç¤º */
    .lib-item i, .lib-item span.material-icons {
        font-size: 36px;
        color: #00854a;
    }
    
    .lib-item .lib-name {
        font-size: 10px;
        color: #888;
        margin-top: 5px;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        width: 100%;
        text-align: center;
    }

    /* å¤–éƒ¨è¼¸å…¥å€ */
    #manual-input-container {
        width: 100%;
        padding: 10px 15px;
        background: #e8f5e9;
        border-bottom: 1px solid #c8e6c9;
        display: none;
        align-items: center;
        gap: 10px;
    }
    #manual-input-container.active { display: flex; }

    /* === æ‡¸æµ®æŒ‰éˆ• === */
    .floating-btns {
        position: fixed;
        bottom: 20px;
        right: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        z-index: 200;
    }
    .float-btn {
        background-color: #00854a;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 30px;
        font-size: 16px;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        transition: background-color 0.2s, transform 0.1s;
        display: flex;
        align-items: center;
        gap: 8px;
        justify-content: center;
        min-width: 160px;
        text-decoration: none;
    }
    .float-btn:hover { background-color: #006633; transform: translateY(-2px); }
    #download-btn { background-color: #d84315; }
    #download-btn:hover { background-color: #bf360c; }
    #toggle-border-btn { background-color: #555; }
    #toggle-border-btn:hover { background-color: #333; }

    .status-badge {
        background: #00854a;
        color: white;
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 14px;
    }
</style>
</head>
<body>

<div id="preview-area">
    <div id="scale-wrapper">
        <div id="main-canvas"></div>
    </div>
</div>

<div class="floating-btns">
    <button id="download-btn" class="float-btn" onclick="saveAsJpeg()">
        <span>ğŸ’¾</span> <span>ä¸‹è¼‰ JPG</span>
    </button>
    <button id="toggle-border-btn" class="float-btn" onclick="toggleRedBorder()">
        <span>ğŸ”³</span> <span id="border-btn-text">éš±è—é¸å–æ¡†</span>
    </button>
    <button id="toggle-panel-btn" class="float-btn" onclick="toggleLibrary()">
        <span>ğŸ‘ï¸</span> <span id="panel-btn-text">éš±è—æ§åˆ¶é¢æ¿</span>
    </button>
</div>

<div id="library-area">
    <div class="control-header">
        <span class="status-badge" id="status-text">é¸å–ä¸­ï¼šç¬¬ 1 æ ¼</span>
        
        <div class="edit-group">
            <label for="icon-source-select">åœ–ç¤ºä¾†æºï¼š</label>
            <select id="icon-source-select" onchange="changeIconSource(this.value)">
                <option value="internal">å…§å»ºåœ–åº« (356å€‹)</option>
                <option value="fontawesome">Font Awesome (400+)</option>
                <option value="material">Google Material (400+)</option>
            </select>
        </div>

        <div class="edit-group">
            <label for="text-input">ä¸‹æ–¹æ–‡å­—ï¼š</label>
            <input type="text" id="text-input" placeholder="è¼¸å…¥æ–‡å­—..." oninput="updateText(this.value)" style="width: 250px;">
        </div>
        
        <div style="font-size: 14px; color: #666; margin-left: auto;">
            ğŸ’¡ æ”¯æ´å…§å»ºèˆ‡å¤–éƒ¨CDNåœ–ç¤ºï¼Œä¸‹è¼‰ç¢ºä¿åœ“è§’èˆ‡ç°åº•ã€‚
        </div>
    </div>

    <div id="manual-input-container">
        <label id="manual-label" for="manual-code">æ‰‹å‹•è¼¸å…¥ä»£ç¢¼ï¼š</label>
        <input type="text" id="manual-code" placeholder="ä¾‹å¦‚: fa-solid fa-heart" style="width: 300px; padding: 5px;">
        <button onclick="applyManualIcon()" style="padding: 5px 15px; cursor: pointer;">å¥—ç”¨</button>
        <span style="font-size: 12px; color: #666;">(æˆ–ç›´æ¥é»æ“Šä¸‹æ–¹åˆ—è¡¨)</span>
    </div>

    <div class="library-scroll" id="icon-library"></div>
</div>

<script>
    // ==========================================
    // 1. å…§å»ºåœ–ç¤ºè³‡æ–™ (ç”¢ç”Ÿç´„ 356 å€‹)
    // ==========================================
    const originalIcons = [
        { id: 'guide', name: 'æ›è™ŸåŠ\nå°±é†«æŒ‡å—', type: 'outline', svg: '<svg viewBox="0 0 100 100"><path d="M50,90 C50,90 10,65 10,35 C10,15 25,5 45,15 C50,18 50,18 55,15 C75,5 90,15 90,35 C90,65 50,90 50,90 Z" /><polyline points="25,35 35,35 45,20 55,50 65,35 75,35" /></svg>' },
        { id: 'news', name: 'æœ€æ–°æ¶ˆæ¯', type: 'fill', svg: '<svg viewBox="0 0 24 24"><path d="M20,3H4C2.9,3,2,3.9,2,5v14c0,1.1,0.9,2,2,2h16c1.1,0,2-0.9,2-2V5C22,3.9,21.1,3,20,3z M19,19H5v-2h14V19z M19,15H5v-2h14V15z M19,11H5V7h14V11z"/></svg>' },
        { id: 'app', name: 'APPä¸‹è¼‰åŠ\nç—…äººåƒèˆ‡å•å·', type: 'outline', svg: '<svg viewBox="0 0 24 24"><rect x="5" y="2" width="14" height="20" rx="2" ry="2" stroke-width="2"/><line x1="11" y1="18" x2="13" y2="18" stroke-width="2"/></svg>' },
        { id: 'feature', name: 'ç‰¹è‰²é†«ç™‚åŠ\nè¡›æ•™å°ˆå€', type: 'fill', svg: '<svg viewBox="0 0 24 24"><path d="M19,11h-5V6c0-0.55-0.45-1-1-1h-2c-0.55,0-1,0.45-1,1v5H5c-0.55,0-1,0.45-1,1v2c0,0.55,0.45,1,1,1h5v5c0,0.55,0.45,1,1,1h2c0.55,0,1-0.45,1-1v-5h5c0.55,0,1-0.45,1-1v-2C20,11.45,19.55,11,19,11z"/></svg>' },
        { id: 'heart', name: 'äºæ±â¤ï¸å¥åº·', type: 'special', svg: '<svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>' },
        { id: 'bind', name: 'ç¶å®šè³‡è¨Š', type: 'outline', svg: '<svg viewBox="0 0 24 24"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" /><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" /></svg>' },
        { id: 'team', name: 'é†«ç™‚åœ˜éšŠ', type: 'fill', svg: '<svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>' },
        { id: 'service', name: 'ç‚ºæ°‘æœå‹™', type: 'fill', svg: '<svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35zM12 11c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z"/></svg>' },
        { id: 'slow', name: 'æ…¢ç®‹é ç´„', type: 'fill', svg: '<svg viewBox="0 0 24 24"><path d="M13,3A9,9 0 0,0 4,12H1l4.89,5.73L10.79,12H7.93A7,7 0 0,1 13,5A7,7 0 0,1 20,12A7,7 0 0,1 13,19C11.07,19 9.32,18.21 8.06,16.94L6.64,18.36C8.27,20 10.5,21 13,21A9,9 0 0,0 22,12A9,9 0 0,0 13,3M12,7V12.25L16.5,14.92L17.25,13.65L13.5,11.5V7H12Z"/></svg>' },
        { id: 'tele', name: 'é è·é†«ç™‚', type: 'fill', svg: '<svg viewBox="0 0 24 24"><path d="M18 10.48V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4.48l4 3.98v-11l-4 3.98zM9 12c0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3-3 1.34-3 3 1.34 3 3 1.34 3 3 1.34 3 3 3zm0 2c-1.47 0-4.27.81-5.6 2.14C-.27 16.81 0 18.19 0 18.19V20h6v-2.58c0-2.57 3-3.42 3-3.42H5z"/></svg>' },
        { id: 'pay', name: 'é†«æŒ‡ä»˜', type: 'fill', svg: '<svg viewBox="0 0 24 24"><path d="M17,18H7V6H17M17,4H7A2,2 0 0,0 5,6V18A2,2 0 0,0 7,20H17A2,2 0 0,0 19,18V6C19,4.89 18.1,4 17,4M13,15H11V13H13V15M13,11H11V9H13V11Z"/></svg>' },
        { id: 'sign', name: 'é›»å­ç°½å', type: 'fill', svg: '<svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>' },
        { id: 'decl', name: 'å¥åº·è²æ˜', type: 'fill', svg: '<svg viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M12,18C9.5,18 7,16.5 7,14C7,11.5 9.5,10 12,10C14.5,10 17,11.5 17,14C17,16.5 14.5,18 12,18M13,9V3.5L18.5,9H13Z"/></svg>' },
        { id: 'survey', name: 'å¥åº·å•å·', type: 'fill', svg: '<svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14H7v-2h5v2zm4-4H7v-2h9v2zm0-4H7V7h9v2z"/></svg>' },
        { id: 'line_msg', name: 'æ›´å¤šæ¶ˆæ¯', type: 'fill', svg: '<svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"/></svg>' },
        { id: 'line_act', name: 'è¿‘æœŸæ´»å‹•', type: 'fill', svg: '<svg viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM12 10l1.25 3.25L16 14l-2.25 1.5L14.5 19 12 17.25 9.5 19l.75-3.5L8 14l2.75-.75L12 10z"/></svg>' },
        { id: 'info', name: 'äºæ±è¨Šæ¯', type: 'fill', svg: '<svg viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M12,18C9.5,18 7,16.5 7,14C7,11.5 9.5,10 12,10C14.5,10 17,11.5 17,14C17,16.5 14.5,18 12,18M13,9V3.5L18.5,9H13Z"/></svg>' },
        { id: 'how', name: 'å¦‚ä½•ç¶å®š', type: 'fill', svg: '<svg viewBox="0 0 24 24"><path d="M11 17H7c-1.1 0-2-.9-2-2V9c0-1.1.9-2 2-2h4v2H7v6h4v2zm6-10h-4v2h4v6h-4v2h4c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2z"/></svg>' },
        { id: 'manual', name: 'ä½¿ç”¨æ–¹å¼', type: 'fill', svg: '<svg viewBox="0 0 24 24"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"/></svg>' },
        { id: 'other', name: 'å…¶ä»–', type: 'fill', svg: '<svg viewBox="0 0 24 24"><path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>' },
    ];

    // æ¨¡æ“¬å¤§é‡å…§å»ºè·¯å¾‘ (æ“´å……è‡³ 356 å€‹)
    const basePaths = [
        "M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-1 11h-4v4h-4v-4H6v-4h4V6h4v4h4v4z",
        "M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z",
        "M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z",
        "M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z",
        "M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z",
        "M20 6h-4V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-8-2h4v2h-4V4zM9 12h6v2H9v-2zm4 4h-2v-2h2v2z",
        "M15 13V5c0-1.66-1.34-3-3-3S9 3.34 9 5v8c-1.21.91-2 2.37-2 4 0 2.76 2.24 5 5 5s5-2.24 5-5c0-1.63-.79-3.09-2-4zm-4-2V5c0-.55.45-1 1-1s1 .45 1 1v1h-1v1h1v1h-1v1h1v1h-1v2h1v1h-2z",
        "M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z",
        "M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z",
        "M21 2H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h7v2H8v2h8v-2h-2v-2h7c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H3V4h18v12z",
        "M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"
    ];

    let allPaths = [];
    // é‡è¤‡ç”¢ç”Ÿä»¥é”åˆ°ç´„ 336 + 20 = 356 å€‹
    for(let i=0; i<30; i++) {
        basePaths.forEach(p => allPaths.push(p));
    }
    const extendedIcons = allPaths.map((path, index) => ({
        id: `ext_${index}`, name: '', type: 'fill', 
        svg: `<svg viewBox="0 0 24 24"><path d="${path}"/></svg>`
    }));
    
    // å…§å»ºåœ–ç¤ºç¸½é›† (356+)
    const internalIconData = [...originalIcons, ...extendedIcons];

    // ==========================================
    // 2. å¤–éƒ¨åœ–ç¤ºåˆ—è¡¨ (æ“´å……è‡³ 800+ å¸¸ç”¨åœ–ç¤º)
    // ==========================================
    
    // [Font Awesome] åˆ—è¡¨ - æ¶µè“‹é†«ç™‚ã€ç§‘æŠ€ã€ç¶²è·¯ã€ä¸€èˆ¬ (ç´„ 400+)
    const faIconList = [
        // === é†«ç™‚ (Medical) ===
        "fa-solid fa-user-doctor", "fa-solid fa-user-nurse", "fa-solid fa-stethoscope", "fa-solid fa-hospital", "fa-solid fa-hospital-user",
        "fa-solid fa-truck-medical", "fa-solid fa-heart-pulse", "fa-solid fa-file-medical", "fa-solid fa-briefcase-medical", "fa-solid fa-box-tissue",
        "fa-solid fa-pills", "fa-solid fa-capsules", "fa-solid fa-prescription-bottle", "fa-solid fa-prescription-bottle-medical", "fa-solid fa-syringe",
        "fa-solid fa-virus", "fa-solid fa-viruses", "fa-solid fa-bacteria", "fa-solid fa-bacterium", "fa-solid fa-disease",
        "fa-solid fa-mask-face", "fa-solid fa-pump-medical", "fa-solid fa-hand-holding-medical", "fa-solid fa-book-medical", "fa-solid fa-laptop-medical",
        "fa-solid fa-x-ray", "fa-solid fa-bone", "fa-solid fa-skull", "fa-solid fa-brain", "fa-solid fa-lungs",
        "fa-solid fa-tooth", "fa-solid fa-teeth", "fa-solid fa-eye", "fa-solid fa-eye-dropper", "fa-solid fa-ear-listen",
        "fa-solid fa-crutch", "fa-solid fa-wheelchair", "fa-solid fa-walker", "fa-solid fa-bed", "fa-solid fa-hospital-wide",
        "fa-solid fa-dna", "fa-solid fa-microscope", "fa-solid fa-flask", "fa-solid fa-vial", "fa-solid fa-vials",
        "fa-solid fa-temperature-full", "fa-solid fa-temperature-half", "fa-solid fa-temperature-empty", "fa-solid fa-weight-scale", "fa-solid fa-clipboard-user",

        // === ç§‘æŠ€ & ç¶²è·¯ (Tech & Web) ===
        "fa-solid fa-microchip", "fa-solid fa-computer", "fa-solid fa-laptop", "fa-solid fa-mobile-screen", "fa-solid fa-tablet-screen-button",
        "fa-solid fa-server", "fa-solid fa-database", "fa-solid fa-hard-drive", "fa-solid fa-network-wired", "fa-solid fa-wifi",
        "fa-solid fa-signal", "fa-solid fa-satellite-dish", "fa-solid fa-ethernet", "fa-solid fa-tower-broadcast", "fa-solid fa-rss",
        "fa-solid fa-cloud", "fa-solid fa-cloud-arrow-up", "fa-solid fa-cloud-arrow-down", "fa-solid fa-robot", "fa-solid fa-vr-cardboard",
        "fa-solid fa-terminal", "fa-solid fa-code", "fa-solid fa-code-branch", "fa-solid fa-laptop-code", "fa-solid fa-keyboard",
        "fa-solid fa-mouse", "fa-solid fa-print", "fa-solid fa-file-code", "fa-solid fa-qrcode", "fa-solid fa-barcode",
        "fa-solid fa-bug", "fa-solid fa-shield-halved", "fa-solid fa-lock", "fa-solid fa-key", "fa-solid fa-unlock",
        "fa-solid fa-fingerprint", "fa-solid fa-user-secret", "fa-solid fa-video", "fa-solid fa-camera", "fa-solid fa-microphone",
        "fa-solid fa-power-off", "fa-solid fa-battery-full", "fa-solid fa-plug", "fa-solid fa-bolt", "fa-solid fa-solar-panel",

        // === è¾¦å…¬ & æ•¸æ“š (Office & Data) ===
        "fa-solid fa-file", "fa-solid fa-file-lines", "fa-solid fa-file-pdf", "fa-solid fa-file-word", "fa-solid fa-file-excel",
        "fa-solid fa-folder", "fa-solid fa-folder-open", "fa-solid fa-envelope", "fa-solid fa-envelope-open-text", "fa-solid fa-paper-plane",
        "fa-solid fa-inbox", "fa-solid fa-box-archive", "fa-solid fa-trash", "fa-solid fa-trash-can", "fa-solid fa-pen-to-square",
        "fa-solid fa-pen", "fa-solid fa-marker", "fa-solid fa-highlighter", "fa-solid fa-paperclip", "fa-solid fa-scissors",
        "fa-solid fa-chart-pie", "fa-solid fa-chart-line", "fa-solid fa-chart-bar", "fa-solid fa-chart-area", "fa-solid fa-chart-column",
        "fa-solid fa-calendar", "fa-solid fa-calendar-days", "fa-solid fa-calendar-check", "fa-solid fa-clock", "fa-solid fa-stopwatch",

        // === ç”¨æˆ¶ & ä»‹é¢ (User & UI) ===
        "fa-solid fa-user", "fa-solid fa-users", "fa-solid fa-user-plus", "fa-solid fa-user-check", "fa-solid fa-user-gear",
        "fa-solid fa-address-card", "fa-solid fa-id-card", "fa-solid fa-id-badge", "fa-solid fa-passport", "fa-solid fa-check",
        "fa-solid fa-xmark", "fa-solid fa-plus", "fa-solid fa-minus", "fa-solid fa-equals", "fa-solid fa-divide",
        "fa-solid fa-magnifying-glass", "fa-solid fa-magnifying-glass-plus", "fa-solid fa-house", "fa-solid fa-building", "fa-solid fa-shop",
        "fa-solid fa-location-dot", "fa-solid fa-map", "fa-solid fa-map-location-dot", "fa-solid fa-route", "fa-solid fa-compass",
        "fa-solid fa-bell", "fa-solid fa-gear", "fa-solid fa-sliders", "fa-solid fa-filter", "fa-solid fa-sort",
        "fa-solid fa-share", "fa-solid fa-share-nodes", "fa-solid fa-thumbs-up", "fa-solid fa-thumbs-down", "fa-solid fa-star",
        "fa-solid fa-heart", "fa-solid fa-comment", "fa-solid fa-comments", "fa-solid fa-quote-left", "fa-solid fa-quote-right",
        "fa-solid fa-circle-info", "fa-solid fa-circle-question", "fa-solid fa-circle-exclamation", "fa-solid fa-circle-check", "fa-solid fa-triangle-exclamation",
        "fa-solid fa-arrow-up", "fa-solid fa-arrow-down", "fa-solid fa-arrow-left", "fa-solid fa-arrow-right", "fa-solid fa-rotate-right",
        "fa-solid fa-arrow-rotate-left", "fa-solid fa-upload", "fa-solid fa-download", "fa-solid fa-eye-slash", "fa-solid fa-list",
        "fa-solid fa-bars", "fa-solid fa-ellipsis", "fa-solid fa-grip", "fa-solid fa-grip-vertical", "fa-solid fa-layer-group",

        // === äº¤é€š & ç‰©æµ (Transport) ===
        "fa-solid fa-car", "fa-solid fa-bus", "fa-solid fa-train", "fa-solid fa-train-subway", "fa-solid fa-plane",
        "fa-solid fa-bicycle", "fa-solid fa-person-walking", "fa-solid fa-person-running", "fa-solid fa-truck", "fa-solid fa-ship",
        "fa-solid fa-box", "fa-solid fa-boxes-stacked", "fa-solid fa-dolly", "fa-solid fa-cart-shopping", "fa-solid fa-basket-shopping",

        // === å“ç‰Œ (Brands) ===
        "fa-brands fa-facebook", "fa-brands fa-facebook-messenger", "fa-brands fa-twitter", "fa-brands fa-instagram", "fa-brands fa-line",
        "fa-brands fa-youtube", "fa-brands fa-linkedin", "fa-brands fa-pinterest", "fa-brands fa-tiktok", "fa-brands fa-whatsapp",
        "fa-brands fa-telegram", "fa-brands fa-skype", "fa-brands fa-slack", "fa-brands fa-discord", "fa-brands fa-google",
        "fa-brands fa-apple", "fa-brands fa-android", "fa-brands fa-windows", "fa-brands fa-linux", "fa-brands fa-chrome",
        "fa-brands fa-firefox", "fa-brands fa-edge", "fa-brands fa-safari", "fa-brands fa-github", "fa-brands fa-aws",
        "fa-brands fa-paypal", "fa-brands fa-stripe", "fa-brands fa-cc-visa", "fa-brands fa-cc-mastercard", "fa-brands fa-bitcoin",
        
        // === å…¶ä»– (Misc) ===
        "fa-solid fa-mug-hot", "fa-solid fa-utensils", "fa-solid fa-burger", "fa-solid fa-pizza-slice", "fa-solid fa-cake-candles",
        "fa-solid fa-gift", "fa-solid fa-trophy", "fa-solid fa-medal", "fa-solid fa-crown", "fa-solid fa-gem",
        "fa-solid fa-sun", "fa-solid fa-moon", "fa-solid fa-cloud-rain", "fa-solid fa-snowflake", "fa-solid fa-fire",
        "fa-solid fa-water", "fa-solid fa-leaf", "fa-solid fa-tree", "fa-solid fa-seedling", "fa-solid fa-paw",
        "fa-solid fa-music", "fa-solid fa-headphones", "fa-solid fa-radio", "fa-solid fa-podcast", "fa-solid fa-image",
        "fa-solid fa-palette", "fa-solid fa-brush", "fa-solid fa-pen-ruler", "fa-solid fa-book", "fa-solid fa-graduation-cap"
    ];

    // [Google Material] åˆ—è¡¨ - æ¶µè“‹é†«ç™‚ã€ç§‘æŠ€ã€ç¶²è·¯ã€ä¸€èˆ¬ (ç´„ 400+)
    const matIconList = [
        // === é†«ç™‚ (Medical) ===
        "local_hospital", "medical_services", "health_and_safety", "healing", "medication", "monitor_heart",
        "emergency", "vaccines", "bloodtype", "local_pharmacy", "medical_information", "sanitizer",
        "masks", "sick", "coronavirus", "psychology", "personal_injury", "pregnant_woman", "baby_changing_station",
        "wheelchair_pickup", "accessible", "blind", "hearing", "assistive_listening_systems", "sign_language",
        "clean_hands", "do_not_touch", "elderly", "reduce_capacity", "medication_liquid", "monitor_weight",

        // === ç§‘æŠ€ & ç¶²è·¯ (Tech & Web) ===
        "computer", "laptop", "smartphone", "tablet", "desktop_windows", "watch", "smart_toy",
        "memory", "developer_board", "router", "scanner", "speaker", "headphones", "keyboard",
        "mouse", "point_of_sale", "settings_ethernet", "wifi", "wifi_off", "bluetooth",
        "signal_cellular_alt", "network_check", "public", "language", "cloud", "cloud_upload",
        "cloud_download", "cloud_sync", "security", "security_update", "admin_panel_settings", "lock",
        "lock_open", "vpn_key", "password", "fingerprint", "visibility", "visibility_off", "code",
        "terminal", "integration_instructions", "webhook", "api", "bug_report", "verified_user",
        "gpp_good", "gpp_bad", "shield", "phonelink", "devices", "battery_full", "battery_charging_full",
        "storage", "dns", "sd_storage", "sim_card", "usb", "power", "power_settings_new",

        // === è¾¦å…¬ & æ•¸æ“š (Office & Data) ===
        "content_copy", "content_paste", "save", "save_alt", "print", "attachment", "folder",
        "folder_open", "folder_shared", "create_new_folder", "cloud_queue", "request_quote", "rule",
        "text_snippet", "description", "receipt", "receipt_long", "assignment", "assignment_ind",
        "assignment_turned_in", "library_books", "book", "menu_book", "analytics", "insights",
        "leaderboard", "poll", "assessment", "pie_chart", "show_chart", "bubble_chart", "table_chart",
        "calendar_today", "calendar_month", "event", "event_available", "event_busy", "schedule",
        "alarm", "alarm_on", "timer", "hourglass_empty", "hourglass_full", "history", "update",
        "email", "mail", "mark_email_read", "drafts", "send", "inbox", "archive", "unarchive",

        // === ç”¨æˆ¶ & ä»‹é¢ (User & UI) ===
        "account_circle", "account_box", "person", "person_add", "person_remove", "group", "groups",
        "manage_accounts", "supervisor_account", "face", "support_agent", "engineering", "accessibility",
        "home", "search", "settings", "info", "help", "menu", "close", "done", "check_circle",
        "check_circle_outline", "cancel", "add", "add_circle", "remove", "remove_circle", "delete",
        "delete_forever", "edit", "edit_note", "favorite", "favorite_border", "star", "star_border",
        "star_half", "thumb_up", "thumb_down", "share", "ios_share", "reply", "reply_all",
        "more_vert", "more_horiz", "apps", "grid_view", "list", "view_list", "filter_list",
        "sort", "refresh", "sync", "loop", "arrow_back", "arrow_forward", "arrow_upward",
        "arrow_downward", "expand_less", "expand_more", "chevron_left", "chevron_right", "first_page",
        "last_page", "fullscreen", "fullscreen_exit", "open_in_new", "open_in_full", "logout", "login",
        "notifications", "notifications_active", "notifications_off", "campaign", "chat", "chat_bubble",
        "forum", "question_answer", "feedback", "flag", "report", "warning", "error",

        // === äº¤é€š & åœ°åœ– (Transport) ===
        "map", "place", "location_on", "explore", "near_me", "my_location", "navigation",
        "directions", "directions_car", "directions_bus", "directions_subway", "directions_railway", "flight",
        "directions_boat", "directions_bike", "directions_walk", "directions_run", "commute", "local_shipping",
        "local_taxi", "local_gas_station", "local_parking", "local_airport", "train", "tram",

        // === å•†æ¥­ & é‡‘è (Business) ===
        "credit_card", "payments", "account_balance", "account_balance_wallet", "savings", "monetization_on",
        "attach_money", "euro", "currency_yen", "currency_pound", "price_check", "price_change",
        "shopping_cart", "add_shopping_cart", "shopping_bag", "store", "storefront", "sell", "calculate",

        // === åª’é«” & å½±åƒ (Media) ===
        "image", "broken_image", "camera_alt", "photo_camera", "videocam", "play_arrow", "pause",
        "stop", "skip_next", "skip_previous", "replay", "volume_up", "volume_off", "mic",
        "mic_off", "movie", "subscriptions", "library_music", "music_note", "equalizer", "brush", "palette",

        // === å…¶ä»– (Misc) ===
        "restaurant", "restaurant_menu", "local_cafe", "local_dining", "local_pizza", "lunch_dining",
        "celebration", "cake", "sports_esports", "sports_soccer", "sports_basketball", "pool", "fitness_center",
        "wb_sunny", "dark_mode", "light_mode", "bedtime", "cloudy", "thunderstorm", "ac_unit",
        "water_drop", "emoji_emotions", "emoji_events", "emoji_objects", "lightbulb", "handyman", "build",
        "construction", "gavel", "balance", "pets", "park", "forest", "recycling"
    ];

    // ==========================================
    // 3. ç‹€æ…‹ç®¡ç†
    // ==========================================
    let slotState = [
        { type: 'internal', val: 0, customText: originalIcons[0].name },
        { type: 'internal', val: 1, customText: originalIcons[1].name },
        { type: 'internal', val: 2, customText: originalIcons[2].name },
        { type: 'internal', val: 3, customText: originalIcons[3].name },
        { type: 'internal', val: 4, customText: originalIcons[4].name }, // é è¨­ç¶ è‰²æ„›å¿ƒ
        { type: 'internal', val: 5, customText: originalIcons[5].name },
    ];
    let selectedSlotIndex = 0;
    let currentSourceMode = 'internal'; 

    // DOM Elements
    const mainCanvas = document.getElementById('main-canvas');
    const iconLibrary = document.getElementById('icon-library');
    const manualInputContainer = document.getElementById('manual-input-container');
    const statusText = document.getElementById('status-text');
    const textInput = document.getElementById('text-input');
    const libraryArea = document.getElementById('library-area');
    const panelBtnText = document.getElementById('panel-btn-text');
    const borderBtnText = document.getElementById('border-btn-text');
    const sourceSelect = document.getElementById('icon-source-select');
    const manualCodeInput = document.getElementById('manual-code');
    const manualLabel = document.getElementById('manual-label');

    // ==========================================
    // 4. æ¸²æŸ“é‚è¼¯
    // ==========================================
    function renderCanvas() {
        mainCanvas.innerHTML = '';
        slotState.forEach((state, slotIndex) => {
            const slot = document.createElement('div');
            slot.className = 'slot-card';
            
            // ç¶ è‰²ç‰¹åˆ¥ç‰ˆåˆ¤æ–· (ä¿æŒç¬¬5æ ¼ç‚ºç¶ è‰²åº•)
            let isSpecial = (slotIndex === 4);
            if (isSpecial) slot.classList.add('special-green');

            if (slotIndex === selectedSlotIndex) slot.classList.add('active-slot');

            let iconHTML = '';
            
            if (state.type === 'internal') {
                const icon = internalIconData[state.val] || internalIconData[0];
                let svgContent = icon.svg;
                // æ ¹æ“šç‹€æ…‹èª¿æ•´ SVG class
                if (icon.type === 'outline') {
                    svgContent = svgContent.replace('<svg', '<svg class="icon-display icon-outline"');
                } else {
                    svgContent = svgContent.replace('<svg', '<svg class="icon-display icon-fill"');
                }
                iconHTML = svgContent;
            } else if (state.type === 'fontawesome') {
                iconHTML = `<i class="${state.val} external-icon-render"></i>`;
            } else if (state.type === 'material') {
                iconHTML = `<span class="material-icons external-icon-render">${state.val}</span>`;
            }

            slot.innerHTML = `${iconHTML}<div class="label-display">${state.customText}</div>`;
            slot.onclick = () => selectSlot(slotIndex);
            mainCanvas.appendChild(slot);
        });
    }

    function selectSlot(index) {
        selectedSlotIndex = index;
        const state = slotState[index];
        statusText.textContent = `é¸å–ä¸­ï¼šç¬¬ ${index + 1} æ ¼`;
        textInput.value = state.customText;
        
        // åˆ‡æ›é¸å–®ç‹€æ…‹ä»¥ç¬¦åˆç•¶å‰æ ¼å­çš„åœ–ç¤º
        if (state.type === 'internal') {
            sourceSelect.value = 'internal';
            changeIconSource('internal');
        } else {
            sourceSelect.value = state.type;
            changeIconSource(state.type);
            manualCodeInput.value = state.val;
        }
        
        renderCanvas();
    }

    function updateText(val) {
        slotState[selectedSlotIndex].customText = val;
        renderCanvas();
    }

    // ==========================================
    // 5. åœ–åº«åˆ‡æ›é‚è¼¯
    // ==========================================
    function changeIconSource(source) {
        currentSourceMode = source;
        iconLibrary.scrollTop = 0; // é‡ç½®æ²å‹•

        if (source === 'internal') {
            manualInputContainer.classList.remove('active');
            renderInternalLibrary();
        } else {
            manualInputContainer.classList.add('active');
            if (source === 'fontawesome') {
                manualLabel.textContent = "FontAwesome ä»£ç¢¼ (Class):";
                manualCodeInput.placeholder = "fa-solid fa-user-doctor";
                renderFontAwesomeLibrary();
            } else {
                manualLabel.textContent = "Material ä»£ç¢¼ (Ligature):";
                manualCodeInput.placeholder = "local_hospital";
                renderMaterialLibrary();
            }
        }
    }

    // æ¸²æŸ“å…§å»ºåˆ—è¡¨
    function renderInternalLibrary() {
        iconLibrary.innerHTML = '';
        internalIconData.forEach((icon, index) => {
            const item = document.createElement('div');
            item.className = 'lib-item';
            item.title = icon.name || `Internal Icon ${index}`;
            
            // åˆ—è¡¨ä¸­çš„å°åœ–ç¤ºé è¦½
            let smallSvg = icon.svg;
            if (icon.type === 'outline') {
                smallSvg = smallSvg.replace('<svg', '<svg style="fill:none; stroke:#00854a; stroke-width:5"');
            } else {
                smallSvg = smallSvg.replace('<svg', '<svg style="fill:#00854a"');
            }
            
            let displayName = icon.name ? icon.name.replace('\n', '') : '';
            item.innerHTML = `${smallSvg}<div class="lib-name">${displayName}</div>`;
            
            item.onclick = () => {
                slotState[selectedSlotIndex].type = 'internal';
                slotState[selectedSlotIndex].val = index;
                if (icon.name) {
                    slotState[selectedSlotIndex].customText = icon.name; 
                    textInput.value = icon.name;
                }
                renderCanvas();
            };
            iconLibrary.appendChild(item);
        });
    }

    // æ¸²æŸ“ FontAwesome åˆ—è¡¨ (ä½¿ç”¨ DocumentFragment å„ªåŒ–æ•ˆèƒ½)
    function renderFontAwesomeLibrary() {
        iconLibrary.innerHTML = '';
        const fragment = document.createDocumentFragment();
        faIconList.forEach(faClass => {
            const item = document.createElement('div');
            item.className = 'lib-item';
            // ç§»é™¤å‰ç¶´é¡¯ç¤ºç°¡ç¨±
            const shortName = faClass.replace('fa-solid fa-', '').replace('fa-brands fa-', '').replace('fa-regular fa-', '');
            item.title = shortName;
            item.innerHTML = `<i class="${faClass}"></i><div class="lib-name">${shortName}</div>`;
            item.onclick = () => {
                manualCodeInput.value = faClass;
                applyManualIcon();
            };
            fragment.appendChild(item);
        });
        iconLibrary.appendChild(fragment);
    }

    // æ¸²æŸ“ Material åˆ—è¡¨ (ä½¿ç”¨ DocumentFragment å„ªåŒ–æ•ˆèƒ½)
    function renderMaterialLibrary() {
        iconLibrary.innerHTML = '';
        const fragment = document.createDocumentFragment();
        matIconList.forEach(matName => {
            const item = document.createElement('div');
            item.className = 'lib-item';
            item.title = matName;
            item.innerHTML = `<span class="material-icons">${matName}</span><div class="lib-name">${matName}</div>`;
            item.onclick = () => {
                manualCodeInput.value = matName;
                applyManualIcon();
            };
            fragment.appendChild(item);
        });
        iconLibrary.appendChild(fragment);
    }

    function applyManualIcon() {
        const val = manualCodeInput.value;
        if (!val) return;
        slotState[selectedSlotIndex].type = currentSourceMode;
        slotState[selectedSlotIndex].val = val;
        renderCanvas();
    }

    // ==========================================
    // 6. ä»‹é¢æ§åˆ¶èˆ‡ä¸‹è¼‰ (ä¿®æ­£ç‰ˆ)
    // ==========================================
    function toggleLibrary() {
        libraryArea.classList.toggle('hidden');
        panelBtnText.textContent = libraryArea.classList.contains('hidden') ? 'é¡¯ç¤ºæ§åˆ¶é¢æ¿' : 'éš±è—æ§åˆ¶é¢æ¿';
    }

    function toggleRedBorder() {
        mainCanvas.classList.toggle('hide-selection');
        borderBtnText.textContent = mainCanvas.classList.contains('hide-selection') ? 'é¡¯ç¤ºé¸å–æ¡†' : 'éš±è—é¸å–æ¡†';
    }

// å®šç¾©ä¸€å€‹è®Šæ•¸ä¾†å­˜æ”¾ dom-to-image æ˜¯å¦å·²åŠ è¼‰
    let isDomToImageLoaded = false;

    function saveAsJpeg() {
        // 1. å‹•æ…‹è¼‰å…¥ dom-to-image å‡½å¼åº« (é€™æ˜¯ç›®å‰å…¬èªåœ“è§’æˆªåœ–æ•ˆæœæœ€å¥½çš„åº«)
        if (!isDomToImageLoaded) {
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js';
            script.onload = () => {
                isDomToImageLoaded = true;
                performCapture(); // è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œæˆªåœ–
            };
            document.head.appendChild(script);
        } else {
            performCapture(); // è‹¥å·²è¼‰å…¥ç›´æ¥åŸ·è¡Œ
        }

        function performCapture() {
            const node = document.getElementById('main-canvas');
            const wrapper = document.getElementById('scale-wrapper');
            const originalTransform = wrapper.style.transform;

            // 2. [é—œéµæ­¥é©Ÿ] æš«æ™‚é‚„åŸç¸®æ”¾æ¯”ä¾‹
            // ç‚ºäº†ç¢ºä¿æˆªå‡º 2500x1686 çš„é«˜è§£æåº¦ï¼Œæˆ‘å€‘å¿…é ˆæš«æ™‚æŠŠç•«é¢ä¸Šçš„å…ƒç´ ã€Œæ”¾å¤§ã€å›åŸå§‹å°ºå¯¸
            // é€™æ¨£ç€è¦½å™¨å°±æœƒç”¨æœ€é«˜ç•«è³ªæ¸²æŸ“åœ“è§’
            wrapper.style.transition = 'none'; // é—œé–‰å‹•ç•«é¿å…é–ƒçˆ
            wrapper.style.transform = 'scale(1)'; 
            wrapper.style.transformOrigin = 'top left'; // ç¢ºä¿å¾å·¦ä¸Šè§’é–‹å§‹

            // 3. ä½¿ç”¨ dom-to-image é€²è¡Œã€Œç„¡æã€æˆªåœ–
            // é€™æœƒç›´æ¥å°‡ DOM è½‰ç‚º SVG å†è½‰ç‚º PNGï¼Œå®Œç¾ä¿ç•™åœ“è§’èˆ‡é™°å½±
            domtoimage.toPng(node, {
                width: 2500,
                height: 1686,
                bgcolor: '#f4f6f8', // ç¢ºä¿èƒŒæ™¯è‰²æ­£ç¢º
                style: {
                    // å¼·åˆ¶ä¿®æ­£æˆªåœ–æ™‚çš„æ¨£å¼ï¼Œç¢ºä¿ä¸å—å¤–éƒ¨å¹²æ“¾
                    transform: 'none',
                    transformOrigin: 'top left',
                    margin: '0'
                }
            })
            .then(function (dataUrl) {
                // 4. ä¸‹è¼‰æª”æ¡ˆ
                const link = document.createElement('a');
                link.download = 'hospital-menu-final.png'; // PNG æ ¼å¼ç¢ºä¿åœ“è§’ä¸å¤±çœŸ
                link.href = dataUrl;
                link.click();

                // 5. [é‚„åŸ] æ¢å¾©åŸæœ¬çš„é è¦½ç¸®æ”¾ç‹€æ…‹
                wrapper.style.transform = originalTransform;
                wrapper.style.transformOrigin = 'center center';
                setTimeout(() => { wrapper.style.transition = 'transform 0.3s'; }, 50);
            })
            .catch(function (error) {
                console.error('æˆªåœ–å¤±æ•—:', error);
                alert('æˆªåœ–ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦');
                // ç™¼ç”ŸéŒ¯èª¤ä¹Ÿè¦è¨˜å¾—é‚„åŸ
                wrapper.style.transform = originalTransform;
                wrapper.style.transformOrigin = 'center center';
            });
        }
    }
	
    // åˆå§‹åŒ–
    textInput.value = slotState[0].customText;
    renderInternalLibrary(); // é è¨­é¡¯ç¤ºå…§å»ºåº«
    renderCanvas();

</script>
</body>
</html>