<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>亞東醫院版面產生器 (Mobile UX Optimized)</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Noto+Serif+TC:wght@400;700&family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css">
<script src="https://unpkg.com/@phosphor-icons/web"></script>
<link href="https://unpkg.com/ionicons@4.5.10-0/dist/css/ionicons.min.css" rel="stylesheet">

<style>
    :root {
        --primary: #00854a;
        --primary-dark: #006633;
        --accent: #d84315;
        --bg-dark: #1a1a1a;
        --panel-bg: #ffffff;
        --border: #e0e0e0;
        --text: #333;
        --text-sub: #666;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
        margin: 0;
        padding: 0;
        font-family: "Noto Sans TC", sans-serif;
        background-color: var(--bg-dark);
        display: flex;
        flex-direction: column;
        height: 100vh;
        height: 100dvh;
        overflow: hidden;
    }

    /* === Top Bar === */
    .app-header {
        height: 60px;
        background: rgba(30, 30, 30, 0.95);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center; /* Title Centered */
        padding: 0 16px;
        border-bottom: 1px solid #333;
        z-index: 200;
        flex-shrink: 0;
        position: relative;
    }

    .app-title {
        color: white;
        font-weight: 700;
        font-size: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .app-title span { background: var(--primary); padding: 2px 6px; border-radius: 4px; font-size: 12px; }

    /* === Preview Area === */
    #preview-area {
        flex: 1;
        background-color: var(--bg-dark);
        background-image: radial-gradient(#333 1px, transparent 1px);
        background-size: 20px 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        position: relative;
        padding: 20px 20px 100px 20px; /* Bottom padding for floating dock */
    }

    #scale-wrapper {
        transform-origin: center center;
        box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    #main-canvas {
        width: 2500px;
        height: 1686px;
        background-color: #f4f6f8; 
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: 50px;
        padding: 60px;
        box-sizing: border-box;
    }

    /* === Cards === */
    .slot-card {
        background-color: #ffffff;
        border-radius: 40px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        cursor: pointer;
        border: 10px solid transparent; 
        position: relative;
        overflow: hidden;
    }

    .slot-card.active-slot {
        border-color: #ff3333;
        box-shadow: 0 0 0 15px rgba(255, 50, 50, 0.2);
        z-index: 10;
    }
    
    #main-canvas.hide-selection .slot-card.active-slot {
        border-color: transparent !important;
        box-shadow: 0 10px 25px rgba(0,0,0,0.05) !important;
    }

    .slot-card.special-green { background-color: var(--primary); }
    .slot-card.special-green .external-icon-render,
    .slot-card.special-green .icon-display,
    .slot-card.special-green .label-display { fill: #fff!important; stroke: #fff!important; color: #fff!important; }
    .slot-card.special-green .icon-outline { fill: none!important; stroke: #fff!important; }
    .slot-card.special-green .icon-fill { fill: #fff!important; stroke: none!important; }

    .icon-display { width: 250px; height: 250px; margin-bottom: 40px; fill: var(--primary); pointer-events: none; }
    .icon-display.icon-outline { fill: none; stroke: var(--primary); stroke-width: 5; stroke-linecap: round; stroke-linejoin: round; }
    .icon-display.icon-fill { fill: var(--primary); stroke: none; }
    
    .external-icon-render { font-size:180px; line-height:1; color:var(--primary); margin-bottom:40px; display:inline-block; pointer-events:none; }
    .material-icons.external-icon-render { font-size:220px; }
    
    .label-display {
        font-weight: 700;
        color: #333;
        line-height: 1.3;
        pointer-events: none;
        white-space: pre-wrap;
        min-height: 1.3em;
    }

    /* === Bottom Panel (Editor) === */
    #library-area {
        background-color: var(--panel-bg);
        border-radius: 24px 24px 0 0;
        box-shadow: 0 -5px 30px rgba(0,0,0,0.3);
        display: flex;
        flex-direction: column;
        height: 55%;
        transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        z-index: 100;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        transform: translateY(110%); /* Default hidden */
    }

    #library-area.visible {
        transform: translateY(0);
    }

    /* Overlay for panel */
    #panel-overlay {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 90;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
    }
    #panel-overlay.visible {
        opacity: 1;
        pointer-events: auto;
    }

    .panel-handle {
        width: 100%;
        height: 30px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
    }
    .panel-handle::after {
        content: '';
        width: 40px;
        height: 5px;
        background: #ddd;
        border-radius: 10px;
    }

    .editor-container {
        padding: 0 20px 40px 20px;
        overflow-y: auto;
        flex: 1;
    }

    .section-title {
        font-size: 12px;
        color: var(--text-sub);
        text-transform: uppercase;
        letter-spacing: 1px;
        margin: 15px 0 8px 0;
        font-weight: 700;
    }

    .control-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }
    .control-full { grid-column: span 2; }

    .input-wrapper {
        position: relative;
        background: #f5f5f5;
        border-radius: 12px;
        padding: 8px 12px;
        border: 1px solid transparent;
        transition: all 0.2s;
    }
    .input-wrapper:focus-within {
        background: #fff;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(0, 133, 74, 0.1);
    }
    .input-label {
        font-size: 10px;
        color: var(--text-sub);
        display: block;
        margin-bottom: 2px;
    }
    .styled-input {
        width: 100%;
        border: none;
        background: transparent;
        font-size: 15px;
        color: var(--text);
        font-weight: 500;
        outline: none;
        padding: 0;
    }
    
    .style-toggle {
        background: #f0fdf4;
        color: var(--primary);
        border: 1px solid var(--primary);
        padding: 10px;
        border-radius: 12px;
        font-weight: 700;
        width: 100%;
        text-align: center;
        cursor: pointer;
    }

    .library-scroll {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
        gap: 8px;
        margin-top: 10px;
    }
    
    .lib-item {
        aspect-ratio: 1;
        border: 1px solid #eee;
        border-radius: 12px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: #fff;
        transition: all 0.2s;
    }
    .lib-item:active { background-color: #e8f5e9; border-color: var(--primary); transform: scale(0.95); }
    .lib-item svg { width: 28px; height: 28px; fill: var(--primary); }
    .lib-item i, .lib-item span { font-size: 26px; color: var(--primary); }
    .lib-item .lib-name { display: none; } 

    .status-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }
    .current-slot-badge {
        background: var(--primary);
        color: white;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
    }
    
    #manual-input-container { display: none; gap: 8px; margin-top: 10px; }
    #manual-input-container.active { display: flex; }
    #manual-code { flex: 1; }

    /* === NEW: Floating Action Dock (底部懸浮工具列) === */
    .floating-dock {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(35, 35, 35, 0.9);
        backdrop-filter: blur(15px);
        padding: 8px;
        border-radius: 50px;
        display: flex;
        align-items: center;
        gap: 12px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        border: 1px solid rgba(255,255,255,0.1);
        z-index: 300;
        transition: transform 0.3s;
    }
    
    /* 當面板打開時，工具列稍微隱藏或下移 (這裡選擇保留但變透明一點) */
    body.panel-open .floating-dock {
        transform: translate(-50%, 150%);
    }

    .dock-btn {
        background: transparent;
        color: #aaa;
        border: none;
        width: 44px;
        height: 44px;
        border-radius: 50%;
        font-size: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .dock-btn.active {
        background: rgba(255,255,255,0.1);
        color: white;
    }

    /* 下載按鈕特別樣式 */
    .dock-btn.primary {
        background: var(--primary);
        color: white;
        width: auto;
        padding: 0 20px;
        border-radius: 40px;
        font-size: 16px;
        font-weight: bold;
        gap: 8px;
    }
    
    .dock-btn:active { transform: scale(0.92); }
    
    /* 隱藏預覽紅框時的按鈕狀態 */
    .dock-btn.toggled-off { opacity: 0.5; }

</style>
</head>
<body>

<header class="app-header">
    <div class="app-title">
        <span>Mobile</span> 版面產生器
    </div>
</header>

<div id="preview-area" onclick="closePanel()"> 
    <div id="scale-wrapper">
        <div id="main-canvas"></div>
    </div>
</div>

<div id="panel-overlay" onclick="closePanel()"></div>

<div class="floating-dock">
    <button class="dock-btn" id="toggle-panel-btn" onclick="openPanel()">
        <i class="fa-solid fa-sliders"></i>
    </button>
    <button class="dock-btn" id="toggle-border-btn" onclick="toggleRedBorder()">
        <i class="fa-regular fa-square"></i>
    </button>
    <div style="width:1px; height:24px; background:rgba(255,255,255,0.2);"></div>
    <button class="dock-btn primary" onclick="saveAsJpeg()">
        <i class="fa-solid fa-download"></i> <span>下載</span>
    </button>
</div>

<div id="library-area">
    <div class="panel-handle" onclick="closePanel()"></div> 
    
    <div class="editor-container">
        <div class="status-bar">
            <div class="current-slot-badge" id="status-text">正在編輯 #1</div>
            <button class="style-toggle" style="width:auto; padding:4px 12px; font-size:12px;" onclick="closePanel()">
                <i class="fa-solid fa-chevron-down"></i> 收起
            </button>
        </div>

        <div class="section-title">內容設定</div>
        <div class="control-grid">
            <div class="input-wrapper control-full">
                <span class="input-label">顯示文字</span>
                <input type="text" id="text-input" class="styled-input" placeholder="輸入文字..." oninput="updateText(this.value)">
            </div>
            
            <button class="style-toggle" onclick="toggleSlotStyle()">
                <i class="fa-solid fa-fill-drip"></i> 綠色/白色
            </button>

            <div class="input-wrapper">
                <span class="input-label">字體大小</span>
                <input type="number" id="font-size-input" class="styled-input" value="80" step="2" onchange="updateFontSize(this.value)">
            </div>
            
            <div class="input-wrapper control-full">
                <span class="input-label">字型</span>
                <select id="font-family-select" class="styled-input" onchange="updateFontFamily(this.value)">
                    <option value='"Microsoft JhengHei", "Heiti TC", sans-serif'>微軟正黑</option>
                    <option value='"Noto Sans TC", sans-serif'>思源黑體</option>
                    <option value='"Noto Serif TC", serif'>思源宋體</option>
                    <option value='"Zen Maru Gothic", sans-serif'>圓體 (Zen Maru)</option>
                </select>
            </div>
        </div>

        <div class="section-title">圖示設定</div>
        <div class="control-grid">
             <div class="input-wrapper control-full">
                <span class="input-label">來源圖庫 (1000+ Icons)</span>
                <select id="icon-source-select" class="styled-input" onchange="changeIconSource(this.value)">
                    <option value="internal">內建精選 (350+)</option>
                    <option value="none">無圖示</option>
                    <option value="fontawesome">Font Awesome</option>
                    <option value="material">Google Material</option>
                    <option value="bootstrap">Bootstrap</option>
                    <option value="remix">Remix Icons</option>
                    <option value="boxicons">Boxicons</option>
                    <option value="tabler">Tabler Icons</option>
                    <option value="phosphor">Phosphor Icons</option>
                    <option value="ionicons">Ionicons</option>
                </select>
            </div>
             <div class="input-wrapper control-full">
                <span class="input-label">圖示大小</span>
                <input type="number" id="icon-size-input" class="styled-input" value="250" step="10" onchange="updateIconSize(this.value)">
            </div>
        </div>

        <div id="manual-input-container">
            <div class="input-wrapper" style="flex:1;">
                <span class="input-label" id="manual-label">代碼</span>
                <input type="text" id="manual-code" class="styled-input" placeholder="Icon Code">
            </div>
            <button class="style-toggle" style="width: auto;" onclick="applyManualIcon()">OK</button>
        </div>

        <div class="section-title">選擇圖示</div>
        <div class="library-scroll" id="icon-library"></div>
    </div>
</div>

<script src="scriptmobile.js"></script>

<script>
    // 覆蓋/新增 UI 相關邏輯
    const overlay = document.getElementById('panel-overlay');
    const libraryPanel = document.getElementById('library-area');

    function openPanel() {
        libraryPanel.classList.add('visible');
        overlay.classList.add('visible');
        document.body.classList.add('panel-open');
    }

    function closePanel() {
        libraryPanel.classList.remove('visible');
        overlay.classList.remove('visible');
        document.body.classList.remove('panel-open');
    }

    // 修改 scriptmobile.js 中的 selectSlot，讓它點擊時自動開啟面板
    const originalSelectSlot = selectSlot;
    selectSlot = function(index) {
        originalSelectSlot(index);
        openPanel(); // 自動打開面板
    }

    // 修改 toggleRedBorder 以更新按鈕樣式
    const originalToggleRedBorder = toggleRedBorder;
    toggleRedBorder = function() {
        originalToggleRedBorder();
        const btn = document.getElementById("toggle-border-btn");
        if(mainCanvas.classList.contains("hide-selection")){
            btn.classList.add('toggled-off');
            btn.innerHTML = '<i class="fa-solid fa-square-check"></i>';
        } else {
            btn.classList.remove('toggled-off');
            btn.innerHTML = '<i class="fa-regular fa-square"></i>';
        }
    }
</script>
</body>
</html>