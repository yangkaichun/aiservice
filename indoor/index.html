<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>台北榮總 室內定位導航（Demo）</title>
<style>
  :root{
    --accent:#0a66c2;
    --bg:#ffffff;
    --text:#111;
    --muted:#666;
    --icon:#111;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans TC", "Helvetica Neue", Arial;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text)}
  .app{max-width:420px;margin:0 auto;border-left:1px solid #eee;border-right:1px solid #eee;min-height:100vh;display:flex;flex-direction:column;}
  header {padding:12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #f0f0f0}
  .brand{display:flex;align-items:center;gap:10px}
  .lang{display:flex;gap:6px}
  .lang button{background:transparent;border:1px solid #eee;padding:6px 8px;border-radius:8px;font-size:12px}
  main{padding:12px;flex:1;overflow:auto}
  .big-entry{display:flex;flex-direction:column;align-items:center;gap:14px;padding:18px 12px;border-radius:12px;box-shadow:0 6px 18px rgba(10,10,10,0.04);background:#fff}
  .icon-circle{width:84px;height:84px;border-radius:24px;display:flex;align-items:center;justify-content:center;border:1px solid #eee}
  .muted{color:var(--muted);font-size:13px}
  .bt-prompt{margin-top:6px;font-size:13px;color:var(--muted);display:flex;gap:8px;align-items:center}
  .btn {background:var(--accent);color:#fff;padding:10px 14px;border-radius:10px;border:0;font-weight:600}
  .map-area{margin-top:12px}
  .map-wrap{background:#fff;border-radius:12px;padding:8px;border:1px solid #f0f0f0}
  svg{width:100%;height:auto;display:block}
  .controls{display:flex;gap:8px;margin-top:10px}
  .search-box{flex:1;display:flex;gap:8px}
  .input{flex:1;border:1px solid #eee;padding:8px 10px;border-radius:10px;font-size:14px}
  .mic{width:44px;border-radius:10px;border:1px solid #eee;display:flex;align-items:center;justify-content:center}
  .frequent{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
  .chip{padding:8px 10px;border-radius:10px;border:1px solid #eee;font-size:14px;background:#fff}
  .route-steps{margin-top:12px;padding:10px;border-radius:10px;border:1px dashed #eee;background:#fafafa;font-size:14px}
  footer{padding:10px;border-top:1px solid #f0f0f0;font-size:13px;color:var(--muted)}
  /* SVG classes */
  .building{fill:#f6f6f6;stroke:#ddd;stroke-width:1}
  .label{font-size:12px;fill:var(--text)}
  .you{fill:var(--accent)}
  .path-line{stroke:var(--accent);stroke-width:4;fill:none;stroke-linecap:round;opacity:0.95}
  .hidden{display:none}
  /* small screens */
  @media (max-width:420px){ .app{border:none} header{padding:10px} .big-entry{padding:12px} }
</style>
</head>
<body>
<div class="app" id="app">
  <header>
    <div class="brand">
      <!-- single-color hospital icon -->
      <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden>
        <rect x="3" y="7" width="18" height="12" rx="2" stroke="var(--icon)" stroke-width="1.4" fill="none"/>
        <path d="M12 3v6" stroke="var(--icon)" stroke-width="1.4" stroke-linecap="round"/>
        <rect x="10.2" y="10.5" width="3.6" height="3.6" rx="0.6" fill="var(--icon)"/>
      </svg>
      <div style="font-weight:700">榮總 室內定位（Demo）</div>
    </div>
    <div class="lang" aria-hidden>
      <button data-lang="zh">中文</button>
      <button data-lang="en">EN</button>
      <button data-lang="ms">MS</button>
      <button data-lang="vi">VI</button>
    </div>
  </header>

  <main>
    <!-- Home entry -->
    <section id="home">
      <div class="big-entry" role="menu" aria-label="入口">
        <div style="display:flex;flex-direction:column;align-items:center">
          <div class="icon-circle" id="enterBtn" role="button" tabindex="0" aria-label="進入室內定位">
            <!-- location single-color svg -->
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" aria-hidden>
              <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 11 7 11s7-5.75 7-11c0-3.87-3.13-7-7-7z" stroke="var(--icon)" stroke-width="1.2" fill="none"/>
              <circle cx="12" cy="9" r="2.2" fill="var(--icon)"/>
            </svg>
          </div>
          <div style="font-weight:700;margin-top:6px">室內定位系統</div>
        </div>

        <div class="bt-prompt" id="btPrompt">
          <!-- bluetooth single-color svg -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden>
            <path d="M6 6l6 6-6 6V6zM18 6l-6 6 6 6V6z" stroke="var(--icon)" stroke-width="1.2" fill="none"/>
          </svg>
          <div>
            <div id="btText" style="font-weight:600">請開啟藍牙以利室內定位</div>
            <div class="muted" style="font-size:12px">建議開啟藍牙與位置權限（模擬）</div>
          </div>
        </div>

        <button class="btn" id="enableBt">啟用藍牙（模擬）</button>
      </div>
    </section>

    <!-- Main map + controls -->
    <section id="mapScreen" class="hidden" aria-hidden>
      <div class="map-area">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:700" id="currentLocationTitle">目前位置</div>
          <div class="muted" id="floorLabel">B1</div>
        </div>

        <div class="map-wrap" style="margin-top:8px">
          <!-- Simulated SVG GIS map (簡化) -->
          <svg id="campusSvg" viewBox="0 0 600 380" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="院區平面圖">
            <!-- Grounds -->
            <rect x="0" y="0" width="600" height="380" fill="#fff"/>
            <!-- lake -->
            <ellipse cx="480" cy="120" rx="60" ry="36" fill="#e9f5ff" stroke="#d6eafc"/>
            <!-- buildings -->
            <g id="buildings">
              <rect id="zhongzheng" class="building" x="170" y="90" width="160" height="120" rx="8"/>
              <text x="250" y="150" text-anchor="middle" class="label">中正樓</text>

              <rect id="first" class="building" x="40" y="210" width="140" height="110" rx="8"/>
              <text x="110" y="265" text-anchor="middle" class="label">第一門診</text>

              <rect id="second" class="building" x="210" y="220" width="140" height="90" rx="8"/>
              <text x="280" y="265" text-anchor="middle" class="label">第二門診</text>

              <rect id="third" class="building" x="370" y="210" width="150" height="110" rx="8"/>
              <text x="445" y="265" text-anchor="middle" class="label">第三門診</text>

              <rect id="ct" class="building" x="430" y="40" width="90" height="50" rx="6"/>
              <text x="475" y="66" text-anchor="middle" class="label">CT 檢查室</text>
            </g>

            <!-- your (current) location marker -->
            <g id="youMarker" transform="translate(100,250)">
              <circle cx="0" cy="0" r="8" class="you"/>
              <text x="14" y="6" class="label">你(模擬)</text>
            </g>

            <!-- route path (hidden initially) -->
            <path id="routePath" class="path-line" d="" />

          </svg>
        </div>

        <!-- controls -->
        <div class="controls">
          <div class="search-box">
            <input id="searchInput" class="input" placeholder="輸入目的地或說出來" aria-label="輸入目的地" />
            <div class="mic" id="micBtn" title="語音輸入" role="button" aria-label="語音輸入">
              <!-- mic single-color svg -->
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden>
                <path d="M12 14a3 3 0 0 0 3-3V6a3 3 0 1 0-6 0v5a3 3 0 0 0 3 3z" stroke="var(--icon)" stroke-width="1.2" fill="none"/>
                <path d="M19 11v1a7 7 0 0 1-14 0v-1" stroke="var(--icon)" stroke-width="1.2" fill="none"/>
                <path d="M12 19v3" stroke="var(--icon)" stroke-width="1.2" fill="none"/>
              </svg>
            </div>
          </div>
          <button class="btn" id="goBtn">前往</button>
        </div>

        <!-- frequent places -->
        <div style="margin-top:10px" class="muted">常用地點</div>
        <div class="frequent" id="frequentList">
          <!-- chips injected -->
        </div>

        <!-- route steps -->
        <div id="routeSteps" class="route-steps hidden"></div>

        <!-- departments quick search -->
        <div style="margin-top:12px">
          <div style="font-weight:700;margin-bottom:6px">院內科別（快速查詢）</div>
          <div id="deptList" style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px"></div>
        </div>

      </div>
    </section>

  </main>

  <footer>
    本 Demo 參考台北榮民總醫院公開院區平面與科別資訊（示意用）。實際導引請依現場標示。
  </footer>
</div>

<script>
/* --------- 文字多語系 ---------- */
const i18n = {
  zh: {
    enter: "室內定位系統",
    btPrompt: "請開啟藍牙以利室內定位",
    enableBt: "啟用藍牙（模擬）",
    currentLocation: "目前位置",
    floor: "B1",
    placeholder: "輸入目的地或說出來",
    go: "前往",
    frequent: ["第一門診","第二門診","第三門診","CT 檢查室"],
    deptTitle: "院內科別（快速查詢）",
    stepsTitle: "導航指引"
  },
  en: {
    enter: "Indoor Positioning",
    btPrompt: "Please enable Bluetooth for indoor positioning",
    enableBt: "Enable Bluetooth (demo)",
    currentLocation: "Current location",
    floor: "B1",
    placeholder: "Type or speak destination",
    go: "Go",
    frequent: ["Outpatient 1","Outpatient 2","Outpatient 3","CT Room"],
    deptTitle: "Departments (quick search)",
    stepsTitle: "Navigation Steps"
  },
  ms: {
    enter: "Penentududukan Dalam Bangunan",
    btPrompt: "Sila aktifkan Bluetooth untuk penentududukan dalam bangunan",
    enableBt: "Aktifkan Bluetooth (demo)",
    currentLocation: "Lokasi sekarang",
    floor: "B1",
    placeholder: "Taip atau sebut destinasi",
    go: "Pergi",
    frequent: ["Poliklinik 1","Poliklinik 2","Poliklinik 3","Bilik CT"],
    deptTitle: "Jabatan (carian pantas)",
    stepsTitle: "Arahan Navigasi"
  },
  vi: {
    enter: "Định vị trong nhà",
    btPrompt: "Vui lòng bật Bluetooth để định vị trong nhà",
    enableBt: "Bật Bluetooth (demo)",
    currentLocation: "Vị trí hiện tại",
    floor: "B1",
    placeholder: "Gõ hoặc nói điểm đến",
    go: "Đi",
    frequent: ["Phòng khám 1","Phòng khám 2","Phòng khám 3","Phòng CT"],
    deptTitle: "Khoa (tìm nhanh)",
    stepsTitle: "Hướng dẫn điều hướng"
  }
};

let lang = 'zh';
function applyLang(){
  document.documentElement.lang = (lang==='zh'?'zh-Hant':(lang==='en'?'en-US':(lang==='ms'?'ms':'vi')));
  const t = i18n[lang];
  document.querySelector('#btText').textContent = t.btPrompt;
  document.querySelector('#enableBt').textContent = t.enableBt;
  document.querySelector('#currentLocationTitle').textContent = t.currentLocation;
  document.querySelector('#floorLabel').textContent = t.floor;
  document.querySelector('#searchInput').placeholder = t.placeholder;
  document.querySelector('#goBtn').textContent = t.go;
  // frequent chips
  renderFrequent(t.frequent);
  document.querySelector('#deptList').previousElementSibling && (document.querySelector('#deptList').previousElementSibling.textContent = t.deptTitle);
}
document.querySelectorAll('.lang button').forEach(b=>{
  b.addEventListener('click', ()=>{ lang = b.dataset.lang; applyLang(); });
});

/* --------- 模擬藍牙 啟用 ---------- */
document.getElementById('enableBt').addEventListener('click', async ()=>{
  // 模擬：試圖呼叫 navigator.bluetooth 若無則顯示說明
  if (navigator.bluetooth){
    try{
      // 真實情況會要求使用者選擇裝置；此處僅示意
      console.log('navigator.bluetooth available');
      alert(i18n[lang].btPrompt + "\\n(實際定位需要實體藍牙 Beacon 與後端支援)");
    }catch(e){
      alert('藍牙啟用失敗（模擬）');
    }
  } else {
    alert(i18n[lang].btPrompt + "\\n(您的瀏覽器不支援 Web Bluetooth，請使用 Chrome 手機或其他支援瀏覽器測試。)");
  }
});

/* --------- 進入 map 畫面 ---------- */
const enterBtn = document.getElementById('enterBtn');
enterBtn.addEventListener('click', openMap);
enterBtn.addEventListener('keydown', (e)=>{ if(e.key==='Enter') openMap(); });
function openMap(){
  document.getElementById('home').classList.add('hidden');
  const ms = document.getElementById('mapScreen');
  ms.classList.remove('hidden');
  ms.removeAttribute('aria-hidden');
  applyLang();
  // 模擬：設定目前位置（可由藍牙或定位決定）
  setCurrentLocation({x:100,y:250,label:i18n[lang].currentLocation});
}

/* --------- current location marker ---------- */
function setCurrentLocation(pt){
  const gm = document.getElementById('youMarker');
  gm.setAttribute('transform', `translate(${pt.x},${pt.y})`);
  // update floor label if provided
  // (在實作中可依藍牙 Beacon 回傳樓層)
}

/* --------- Frequent list & departments ---------- */
const frequentTargets = ["第一門診","第二門診","第三門診","CT 檢查室"];
function renderFrequent(list){
  const el = document.getElementById('frequentList');
  el.innerHTML = '';
  (list||frequentTargets).forEach(name=>{
    const btn = document.createElement('button');
    btn.className='chip';
    btn.textContent = name;
    btn.addEventListener('click', ()=>{ chooseDestination(name); });
    el.appendChild(btn);
  });
}

// 模擬從官方抓取的科別清單（取代表性項目）
const departments = [
  "內科部","外科部","骨科部","婦女醫學部","兒童醫學部","影像診療部",
  "腫瘤醫學部","核醫部","牙科門診","復健醫學部","麻醉部","皮膚部"
];
function renderDepts(){
  const dl = document.getElementById('deptList');
  dl.innerHTML = '';
  departments.forEach(d=>{
    const b = document.createElement('button');
    b.className='chip';
    b.textContent = d;
    b.addEventListener('click', ()=>chooseDestination(d));
    dl.appendChild(b);
  });
}
renderDepts();

/* --------- Destination selection & route drawing (模擬) ---------- */
let currentDest = null;
function chooseDestination(name){
  document.getElementById('searchInput').value = name;
  // find coordinates for demo (簡化)
  const coords = {
    "第一門診":{x:110,y:260},
    "第二門診":{x:280,y:260},
    "第三門診":{x:445,y:260},
    "CT 檢查室":{x:475,y:66},
    "內科部":{x:250,y:150},
    "外科部":{x:210,y:230},
    "骨科部":{x:110,y:260},
    "兒童醫學部":{x:445,y:260}
  }[name] || {x:250,y:150};
  currentDest = {name, coords};
  highlightRouteTo(coords, name);
}

function highlightRouteTo(pt, name){
  const pathEl = document.getElementById('routePath');
  // build a smooth path from youMarker to pt (simple cubic path)
  const you = document.getElementById('youMarker');
  const tr = you.getAttribute('transform');
  let m = tr.match(/translate\(([\d.]+),([\d.]+)\)/);
  let sx = 100, sy = 250;
  if (m){ sx = +m[1]; sy = +m[2]; }
  const mx = (sx + pt.x)/2;
  const my = Math.min(sy, pt.y) - 40;
  const d = `M ${sx} ${sy} C ${sx} ${my} ${pt.x} ${my} ${pt.x} ${pt.y}`;
  pathEl.setAttribute('d', d);
  pathEl.classList.remove('hidden');

  // show steps
  const stepsEl = document.getElementById('routeSteps');
  stepsEl.classList.remove('hidden');
  const t = i18n[lang];
  stepsEl.innerHTML = `<strong>${t.stepsTitle || '導航指引'}</strong><br/>
    1. 從目前位置出發<br/>
    2. 依路徑前往 ${name}<br/>
    3. 到達後請依現場標示進入樓層/門診櫃檯。`;
}

/* --------- Search / Go button ---------- */
document.getElementById('goBtn').addEventListener('click', ()=>{
  const q = document.getElementById('searchInput').value.trim();
  if(!q){ alert(i18n[lang].placeholder); return; }
  chooseDestination(q);
});

/* --------- Voice input（Web Speech API） ---------- */
const micBtn = document.getElementById('micBtn');
let recognition = null;
if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window){
  const SpeechRec = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRec();
  recognition.lang = (lang==='zh'?'zh-TW':(lang==='en'?'en-US':(lang==='ms'?'ms-MY':'vi-VN')));
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;
  recognition.onresult = (e)=>{
    const txt = e.results[0][0].transcript;
    document.getElementById('searchInput').value = txt;
    chooseDestination(txt);
  };
  recognition.onerror = (e)=>{ console.log('speech error', e); alert('語音辨識失敗（可能瀏覽器不支援）'); }
}
micBtn.addEventListener('click', ()=>{
  if(!recognition){ alert('您的瀏覽器不支援語音辨識，請使用 Chrome 手機測試'); return;}
  recognition.lang = (lang==='zh'?'zh-TW':(lang==='en'?'en-US':(lang==='ms'?'ms-MY':'vi-VN')));
  recognition.start();
});

/* --------- initial lang apply ---------- */
applyLang();

</script>
</body>
</html>
