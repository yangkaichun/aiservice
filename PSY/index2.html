<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ—æŠ•æ™ºæ…§é è·ç²¾ç¥é†«ç™‚ç…§è­·å¹³å° (Demo)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #27ae60; /* é†«ç™‚ç¶  */
            --bg-light: #f8f9fa;
            --chat-bg-user: #dcf8c6;
            --chat-bg-ai: #ffffff;
            --risk-high: #e74c3c;
            --risk-med: #f1c40f;
            --risk-low: #2ecc71;
        }

        body {
            background-color: #e9ecef;
            font-family: 'Microsoft JhengHei', sans-serif;
            height: 100vh;
            overflow: hidden;
        }

        /* æ¨¡æ“¬åˆ‡æ›è§’è‰²çš„å°èˆªåˆ— */
       .role-switcher {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 50px;
            background: #343a40;
            color: white;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

       .role-btn {
            background: transparent;
            border: 1px solid #6c757d;
            color: #ddd;
            margin: 0 10px;
            padding: 5px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: 0.3s;
        }

       .role-btn.active {
            background: #0d6efd;
            border-color: #0d6efd;
            color: white;
            font-weight: bold;
        }

       .main-container {
            padding-top: 60px;
            height: 100%;
            display: flex;
            justify-content: center;
        }

        /* --- ç—…æ‚£ç«¯ (Mobile View) --- */
       .mobile-frame {
            width: 375px; /* iPhone å¯¬åº¦ */
            height: 85vh;
            background: white;
            border-radius: 30px;
            border: 10px solid #333;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            position: relative;
        }

       .mobile-header {
            background: var(--accent-color);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }

       .mobile-content {
            flex: 1;
            overflow-y: auto;
            background: #f0f2f5;
            padding: 10px;
        }

       .chat-box {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding-bottom: 20px;
        }

       .message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 15px;
            font-size: 14px;
            line-height: 1.4;
            position: relative;
        }

       .msg-ai {
            align-self: flex-start;
            background: var(--chat-bg-ai);
            border-bottom-left-radius: 2px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
       .msg-ai::before {
            content: "ğŸŒ³ å°æ¨¹";
            position: absolute;
            top: -18px;
            left: 0;
            font-size: 10px;
            color: #666;
        }

       .msg-user {
            align-self: flex-end;
            background: var(--chat-bg-user);
            border-bottom-right-radius: 2px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

       .mobile-footer {
            background: white;
            padding: 10px;
            border-top: 1px solid #ddd;
            display: flex;
            gap: 5px;
        }

        /* --- é†«è­·ç«¯ (Admin Dashboard) --- */
       .admin-frame {
            width: 90%;
            height: 90vh;
            background: white;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

       .admin-nav {
            background: var(--primary-color);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

       .admin-body {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

       .sidebar {
            width: 250px;
            background: #34495e;
            color: #ecf0f1;
            padding-top: 20px;
        }

       .sidebar-item {
            padding: 12px 20px;
            cursor: pointer;
            border-left: 4px solid transparent;
            transition: 0.2s;
        }

       .sidebar-item:hover,.sidebar-item.active {
            background: #2c3e50;
            border-left-color: #3498db;
        }

       .content-area {
            flex: 1;
            padding: 20px;
            background: #f4f6f9;
            overflow-y: auto;
        }

       .kpi-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-left: 5px solid #ddd;
        }
       .border-red { border-left-color: var(--risk-high); }
       .border-yellow { border-left-color: var(--risk-med); }
       .border-green { border-left-color: var(--risk-low); }

       .patient-table th { background-color: #f8f9fa; }
       .risk-badge {
            padding: 5px 10px;
            border-radius: 12px;
            color: white;
            font-size: 12px;
        }
       .bg-red { background-color: var(--risk-high); }
       .bg-yellow { background-color: var(--risk-med); }
       .bg-green { background-color: var(--risk-low); }

        /* éš±è—/é¡¯ç¤ºæ§åˆ¶ */
       .d-none { display: none!important; }

    </style>
</head>
<body>

    <div class="role-switcher">
        <span><i class="fas fa-eye"></i> è¦–è§’åˆ‡æ›ï¼š</span>
        <button class="role-btn active" onclick="switchRole('patient')">ğŸ“± ç—…æ‚£ç«¯ (LINE)</button>
        <button class="role-btn" onclick="switchRole('admin')">ğŸ‘¨â€âš•ï¸ é†«è­·ç«¯ (Javaå¾Œå°)</button>
    </div>

    <div class="main-container">

        <div id="view-patient" class="mobile-frame">
            <div class="mobile-header">
                <div>åŒ—æŠ•å…±ç…§é›² - AI å¤¥ä¼´å°æ¨¹</div>
                <div style="font-size: 10px; opacity: 0.8;">ä»Šæ—¥ä»»å‹™ï¼šæœè—¥ âœ… | é‡è¡€å£“ âš ï¸</div>
            </div>
            
            <div class="mobile-content" id="chat-container">
                <div class="text-center text-muted my-3" style="font-size: 12px;">2025/01/20 é€±ä¸€</div>
                
                <div class="message msg-ai">
                    æ—©å®‰ï¼æˆ‘æ˜¯å°æ¨¹ ğŸŒ±<br>
                    ä»Šå¤©åŒ—æŠ•çš„å¤©æ°£æœ‰é»æ¶¼ï¼Œè¨˜å¾—å¤šç©¿ä»¶å¤–å¥—å–”ã€‚<br>
                    æ˜¨æ™šç¡å¾—å¥½å—ï¼Ÿ
                </div>

                <div class="message msg-user">
                    å…¶å¯¦ä¸å¤ªå¥½ï¼Œä¸€ç›´åšå¤¢...è¦ºå¾—å¾ˆç´¯ã€‚
                </div>

                <div class="message msg-ai">
                    è¾›è‹¦ä½ äº†ã€‚ä¸€ç›´åšå¤¢çœŸçš„æœƒè®“äººèµ·åºŠå¾Œé‚„æ˜¯è¦ºå¾—ç–²æ†Šã€‚<br>
                    æ˜¯å› ç‚ºæœ€è¿‘æœ‰ä»€éº¼äº‹æƒ…è®“ä½ æ„Ÿåˆ°ç„¦æ…®å—ï¼Ÿ
                </div>
            </div>

            <div class="mobile-footer">
                <button class="btn btn-light rounded-circle text-muted"><i class="fas fa-plus"></i></button>
                <input type="text" id="user-input" class="form-control" placeholder="å‚³é€è¨Šæ¯..." onkeypress="handleEnter(event)">
                <button class="btn btn-success rounded-circle" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
            </div>
            
            <div style="background: #f8f9fa; border-top: 1px solid #ddd; display: flex;">
                <div class="p-3 text-center flex-fill border-end" style="font-size: 12px; cursor: pointer;">
                    <i class="fas fa-heartbeat fa-lg mb-1 text-danger"></i><br>å¥åº·å­˜æ‘º
                </div>
                <div class="p-3 text-center flex-fill border-end" style="font-size: 12px; cursor: pointer;">
                    <i class="fas fa-robot fa-lg mb-1 text-success"></i><br>AI é™ªä¼´
                </div>
                <div class="p-3 text-center flex-fill" style="font-size: 12px; cursor: pointer;">
                    <i class="fas fa-video fa-lg mb-1 text-primary"></i><br>è¦–è¨Šçœ‹è¨º
                </div>
            </div>
        </div>

        <div id="view-admin" class="admin-frame d-none">
            <div class="admin-nav">
                <div class="d-flex align-items-center gap-3">
                    <h5 class="m-0"><i class="fas fa-hospital-symbol me-2"></i>æ™ºæ…§é è·ç…§è­·æˆ°æƒ…å®¤ (Admin)</h5>
                    <span class="badge bg-warning text-dark">æ¸¬è©¦ç’°å¢ƒ</span>
                </div>
                <div class="d-flex align-items-center gap-3">
                    <span style="font-size: 14px;">é™³å€‹ç®¡å¸«ï¼Œæ‚¨å¥½</span>
                    <button class="btn btn-sm btn-outline-light"><i class="fas fa-sign-out-alt"></i></button>
                </div>
            </div>

            <div class="admin-body">
                <div class="sidebar">
                    <div class="sidebar-item active"><i class="fas fa-tachometer-alt me-2"></i> ç¸½è¦½å„€è¡¨æ¿</div>
                    <div class="sidebar-item"><i class="fas fa-users me-2"></i> å€‹æ¡ˆç®¡ç†åˆ—è¡¨</div>
                    <div class="sidebar-item"><i class="fas fa-chart-line me-2"></i> ç”Ÿç†æ•¸æ“šè¶¨å‹¢</div>
                    <div class="sidebar-item"><i class="fas fa-robot me-2"></i> AI å°è©±ç¨½æ ¸</div>
                    <div class="sidebar-item"><i class="fas fa-cog me-2"></i> ç³»çµ±è¨­å®š</div>
                </div>

                <div class="content-area">
                    <div class="row g-3 mb-4">
                        <div class="col-md-3">
                            <div class="kpi-card border-red">
                                <h6 class="text-muted">ğŸ”´ ä»Šæ—¥é«˜é¢¨éšªå€‹æ¡ˆ</h6>
                                <h2 class="text-danger fw-bold m-0">3 <small class="fs-6 text-muted">äºº</small></h2>
                                <small class="text-muted">éœ€ç«‹å³ä»‹å…¥è™•ç†</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="kpi-card border-yellow">
                                <h6 class="text-muted">ğŸŸ¡ ç•°å¸¸è­¦ç¤º</h6>
                                <h2 class="text-warning fw-bold m-0">12 <small class="fs-6 text-muted">ä»¶</small></h2>
                                <small class="text-muted">æœªæœè—¥/ç”Ÿç†æ•¸å€¼åé«˜</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="kpi-card border-green">
                                <h6 class="text-muted">ğŸŸ¢ AIoT æ•¸æ“šä¸Šå‚³ç‡</h6>
                                <h2 class="text-success fw-bold m-0">92%</h2>
                                <small class="text-success"><i class="fas fa-arrow-up"></i> è¼ƒä¸Šé€±æå‡</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="kpi-card">
                                <h6 class="text-muted">ç¸½æ”¶æ¡ˆäººæ•¸</h6>
                                <h2 class="fw-bold m-0">358</h2>
                                <small class="text-muted">æœ¬æœˆæ–°å¢ +15</small>
                            </div>
                        </div>
                    </div>

                    <div class="row g-3">
                        <div class="col-md-8">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                                    <h6 class="m-0 fw-bold">ğŸš© å¾…è™•ç†å€‹æ¡ˆè¿½è¹¤</h6>
                                    <button class="btn btn-sm btn-primary">åŒ¯å‡ºå ±è¡¨</button>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-hover align-middle mb-0 patient-table">
                                        <thead>
                                            <tr>
                                                <th>ç‹€æ…‹</th>
                                                <th>ç—…æ­·è™Ÿ</th>
                                                <th>å§“å (å»è­˜åˆ¥)</th>
                                                <th>è¨ºæ–·</th>
                                                <th>AI æ‘˜è¦ / è­¦ç¤ºåŸå› </th>
                                                <th>æ“ä½œ</th>
                                            </tr>
                                        </thead>
                                        <tbody id="patient-list">
                                            <tr style="background-color: #fff5f5;">
                                                <td><span class="risk-badge bg-red">é«˜é¢¨éšª</span></td>
                                                <td>P-2025001</td>
                                                <td>ç‹â—‹æ˜</td>
                                                <td>é›™ç›¸æƒ…ç·’éšœç¤™</td>
                                                <td class="text-danger"><i class="fas fa-exclamation-circle"></i> åµæ¸¬åˆ°è‡ªæ®ºé—œéµå­—ã€Œä¸æƒ³æ´»äº†ã€</td>
                                                <td><button class="btn btn-sm btn-outline-danger">ä»‹å…¥</button></td>
                                            </tr>
                                            <tr>
                                                <td><span class="risk-badge bg-yellow">æ³¨æ„</span></td>
                                                <td>P-2025042</td>
                                                <td>æ—â—‹å„€</td>
                                                <td>é‡åº¦æ†‚é¬±ç—‡</td>
                                                <td>é€£çºŒ 3 å¤©ç¡çœ æ™‚æ•¸ < 4 å°æ™‚</td>
                                                <td><button class="btn btn-sm btn-outline-secondary">æŸ¥çœ‹</button></td>
                                            </tr>
                                            <tr>
                                                <td><span class="risk-badge bg-green">ç©©å®š</span></td>
                                                <td>P-2025108</td>
                                                <td>å¼µâ—‹è±ª</td>
                                                <td>æ€è¦ºå¤±èª¿ç—‡</td>
                                                <td>æœè—¥ä¾å¾æ€§è‰¯å¥½ï¼Œæƒ…ç·’å¹³ç©©</td>
                                                <td><button class="btn btn-sm btn-outline-secondary">æŸ¥çœ‹</button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-header bg-white py-3">
                                    <h6 class="m-0 fw-bold">ğŸ“Š æƒ…ç·’èˆ‡æœè—¥è¶¨å‹¢ (å…¨é™¢)</h6>
                                </div>
                                <div class="card-body">
                                    <canvas id="complianceChart"></canvas>
                                    <div class="mt-3">
                                        <small class="text-muted d-block mb-1">AI å»ºè­°ï¼š</small>
                                        <div class="alert alert-info py-2 px-3" style="font-size: 13px;">
                                            <i class="fas fa-lightbulb me-1"></i> é€±æœ«æœè—¥ç‡ç•¥æœ‰ä¸‹é™ï¼Œå»ºè­°ç³»çµ±æ–¼é€±äº”æ™šé–“åŠ å¼·æ¨æ’­æé†’ã€‚
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </div>

    <script>
        // 1. è§’è‰²åˆ‡æ›é‚è¼¯
        function switchRole(role) {
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // åˆ‡æ›è¦–åœ–
            if (role === 'patient') {
                document.getElementById('view-patient').classList.remove('d-none');
                document.getElementById('view-admin').classList.add('d-none');
            } else {
                document.getElementById('view-patient').classList.add('d-none');
                document.getElementById('view-admin').classList.remove('d-none');
                // é¦–æ¬¡åˆ‡æ›åˆ°å¾Œå°æ™‚æ¸²æŸ“åœ–è¡¨
                if (!window.chartRendered) {
                    renderAdminChart();
                    window.chartRendered = true;
                }
            }
        }

        // 2. ç—…æ‚£ç«¯ AI èŠå¤©é‚è¼¯ (æ¨¡æ“¬ Java å¾Œç«¯å›æ‡‰)
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');

        function handleEnter(e) {
            if (e.key === 'Enter') sendMessage();
        }

        function sendMessage() {
            const text = userInput.value.trim();
            if (!text) return;

            // é¡¯ç¤ºä½¿ç”¨è€…è¨Šæ¯
            addMessage(text, 'user');
            userInput.value = '';

            // æ¨¡æ“¬å¾Œç«¯ API å»¶é²èˆ‡ AI é‚è¼¯
            showTyping();
            setTimeout(() => {
                removeTyping();
                const aiResponse = getSimulatedAIResponse(text);
                addMessage(aiResponse.text, 'ai');
                
                // å¦‚æœè§¸ç™¼é«˜é¢¨éšªé—œéµå­—ï¼Œæ¨¡æ“¬å¾Œå°æ•¸æ“šæ›´æ–° (Console log demo)
                if (aiResponse.isRisk) {
                    console.log("ã€ç³»çµ±æ¨¡æ“¬ã€‘Java Backend: åµæ¸¬åˆ°é¢¨éšªé—œéµå­—ï¼Œå¯«å…¥è³‡æ–™åº«ä¸¦è§¸ç™¼ WebSocket è­¦å ± -> Admin Dashboard");
                    alert("ç³»çµ±æ¨¡æ“¬æç¤ºï¼šAI åµæ¸¬åˆ°é¢¨éšªé—œéµå­—ï¼Œå¾Œå°å·²åŒæ­¥ç”¢ç”Ÿç´…ç‡ˆè­¦ç¤ºï¼");
                }
            }, 1000);
        }

        function addMessage(text, sender) {
            const div = document.createElement('div');
            div.className = `message msg-${sender}`;
            div.innerHTML = text;
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function showTyping() {
            const div = document.createElement('div');
            div.id = 'typing-indicator';
            div.className = 'message msg-ai';
            div.innerHTML = '<i class="fas fa-ellipsis-h"></i>';
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function removeTyping() {
            const el = document.getElementById('typing-indicator');
            if (el) el.remove();
        }

        // ç°¡å–®çš„è¦å‰‡å¼•æ“ (æ¨¡æ“¬ Java Spring Boot ä¸­çš„ Drools æˆ– NLP é‚è¼¯)
        function getSimulatedAIResponse(input) {
            input = input.toLowerCase();
            if (input.includes('æ­»') || input.includes('ä¸æƒ³æ´»') || input.includes('çµæŸ')) {
                return {
                    text: "æˆ‘æ„Ÿè¦ºåˆ°ä½ ç¾åœ¨éå¸¸ç—›è‹¦ã€‚è«‹è¨˜å¾—ï¼Œæˆ‘å€‘éƒ½åœ¨é€™è£¡é™ªä½ ã€‚<br>å¦‚æœä½ é¡˜æ„ï¼Œå¯ä»¥æ’¥æ‰“ <strong>1925 å®‰å¿ƒå°ˆç·š</strong>ï¼Œæˆ–è€…æˆ‘è«‹å€‹ç®¡å¸«å§Šå§Šè·Ÿä½ è¯çµ¡å¥½å—ï¼Ÿ",
                    isRisk: true
                };
            } else if (input.includes('è—¥') || input.includes('åƒè—¥')) {
                return { text: "åƒè—¥æ˜¯ç‚ºäº†å¹«åŠ©å¤§è…¦ä¼‘æ¯å–”ã€‚å¦‚æœæ“”å¿ƒå‰¯ä½œç”¨ï¼Œæˆ‘å€‘å¯ä»¥ç´€éŒ„ä¸‹ä¾†ï¼Œä¸‹æ¬¡é–€è¨ºè·Ÿé†«ç”Ÿè¨è«–ã€‚ä»Šå¤©åƒäº†å—ï¼Ÿ", isRisk: false };
            } else if (input.includes('ç¡') || input.includes('å¤±çœ ')) {
                return { text: "ç¡ä¸å¥½çœŸçš„æœƒè®“äººå¿ƒæƒ…ä½è½ã€‚ä»Šæ™šè©¦è©¦çœ‹ç¡å‰ä¸æ»‘æ‰‹æ©Ÿï¼Œåšå€‹ç°¡å–®çš„è…¹å¼å‘¼å¸å¥½å—ï¼Ÿ", isRisk: false };
            } else {
                return { text: "æˆ‘äº†è§£äº†ã€‚è¬è¬ä½ é¡˜æ„è·Ÿæˆ‘åˆ†äº«ï¼Œæˆ‘æœƒä¸€ç›´åœ¨é€™è£¡é™ªè‘—ä½ ã€‚", isRisk: false };
            }
        }

        // 3. é†«è­·ç«¯åœ–è¡¨ (Chart.js)
        function renderAdminChart() {
            const ctx = document.getElementById('complianceChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['é€±ä¸€', 'é€±äºŒ', 'é€±ä¸‰', 'é€±å››', 'é€±äº”', 'é€±å…­', 'é€±æ—¥'],
                    datasets: [{
                        label: 'å¹³å‡æœè—¥ä¾å¾æ€§ (%)',
                        data: [85, 88, 87, 90, 85, 75, 78], // ä¿®æ­£æ•¸æ“šç¯„ä¾‹
                        borderColor: '#27ae60',
                        tension: 0.4,
                        fill: false
                    }, {
                        label: 'å¹³å‡æƒ…ç·’æŒ‡æ•¸',
                        data: [7.5, 7.8, 8.0, 8.2, 7.9, 6.5, 6.8], // ä¿®æ­£æ•¸æ“šç¯„ä¾‹
                        borderColor: '#3498db',
                        borderDash: [5, 5],
                        tension: 0.4,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    },
                    scales: {
                        y: { beginAtZero: true, max: 100 }
                    }
                }
            });
        }
    </script>
</body>
</html>