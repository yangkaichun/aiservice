<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‰è»ç¸½é†«é™¢æ™ºæ…§è­·ç†ç«™é›»å­ç™½æ¿ç³»çµ± (TSGH Demo)</title>
    <style>
        :root {
            --bg-dark: #121212;
            --bg-panel: #1e1e1e;
            --text-main: #e0e0e0;
            --text-muted: #a0a0a0;
            --accent-blue: #4fc3f7;
            --accent-green: #81c784;
            --accent-red: #e57373;
            --accent-yellow: #fff176;
            --status-cleaning: #ffb74d;
            --border-radius: 8px;
            --shadow: 0 4px 6px rgba(0,0,0,0.4);
        }

        * { box-sizing: border-box; user-select: none; -webkit-user-select: none; }
        
        body {
            font-family: "Microsoft JhengHei", "Segoe UI", sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- Header & Marquee Area --- */
        header {
            height: 70px;
            background-color: #000;
            display: flex;
            align-items: center;
            padding: 0 25px;
            border-bottom: 2px solid #333;
        }

       .hospital-logo { 
            font-size: 1.8rem; 
            font-weight: bold; 
            color: var(--accent-blue); 
            margin-right: 30px; 
            display: flex;
            align-items: center;
        }
        
       .marquee-container {
            flex: 1;
            background: #222;
            height: 45px;
            overflow: hidden;
            display: flex;
            align-items: center;
            margin: 0 20px;
            border-radius: 4px;
            border: 1px solid #444;
        }
        
       .marquee-content {
            white-space: nowrap;
            animation: scroll 25s linear infinite;
            color: var(--accent-yellow);
            font-size: 1.4rem;
            font-weight: bold;
        }
        @keyframes scroll { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

       .clock { 
            font-size: 1.5rem; 
            margin-left: auto; 
            font-family: monospace; 
            color: var(--accent-green);
            font-weight: bold;
        }

        /* --- Layer 1: Dashboard Grid System --- */
        #layer-1-dashboard {
            display: grid;
            /* Sidebar (Staff), Main Content (Beds), Side Panel (Stats/Schedule) */
            grid-template-columns: 280px 1fr 320px; 
            grid-template-rows: 1fr 300px;
            gap: 12px;
            padding: 15px;
            height: calc(100vh - 70px);
            transition: filter 0.3s;
        }

       .panel {
            background-color: var(--bg-panel);
            border-radius: var(--border-radius);
            padding: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            border: 1px solid #333;
        }

       .panel-header {
            font-size: 1.3rem;
            font-weight: bold;
            border-bottom: 2px solid #444;
            padding-bottom: 8px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            color: var(--accent-blue);
        }

        /* Bed Matrix Styling */
       .bed-grid-container {
            grid-column: 2;
            grid-row: 1 / span 2;
            display: grid;
            /* Responsive grid for 20+ beds */
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
            grid-template-rows: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            overflow-y: auto;
            padding-right: 5px;
        }

       .bed-card {
            background: #2c2c2c;
            border-radius: 6px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            position: relative;
            border-left: 6px solid #555; /* Default empty */
            transition: transform 0.1s;
        }
       .bed-card:active { transform: scale(0.98); }
        
        /* Status Indicators */
       .bed-card.occupied { border-left-color: var(--accent-green); }
       .bed-card.cleaning { border-left-color: var(--status-cleaning); background: #3e2723; }
       .bed-card.isolation { border: 2px solid var(--accent-red); }

        /* Gender Colors */
       .bed-card.female.patient-name { color: #f48fb1; } 
       .bed-card.male.patient-name { color: #90caf9; }

       .bed-number { 
            font-size: 1.6rem; 
            font-weight: bold; 
            position: absolute; 
            top: 5px; 
            right: 8px; 
            color: #666; 
        }
       .patient-name { font-size: 1.4rem; margin-top: 10px; font-weight: bold; }
       .patient-detail { font-size: 1rem; color: #bbb; margin-top: 4px; line-height: 1.2; }
        
       .tags { display: flex; gap: 5px; margin-top: auto; flex-wrap: wrap; }
       .tag { 
            font-size: 0.8rem; 
            padding: 2px 6px; 
            border-radius: 4px; 
            color: #000; 
            font-weight: bold; 
        }
       .tag.dnr { background: var(--accent-red); color: white; }
       .tag.fall { background: var(--accent-yellow); }
       .tag.allergy { background: var(--accent-blue); color: white; }

        /* Staff & Schedule Panels */
       .staff-list { grid-column: 1; grid-row: 1 / span 2; overflow-y: auto; }
       .stat-panel { grid-column: 3; grid-row: 1; }
       .schedule-panel { grid-column: 3; grid-row: 2; }

       .staff-item { 
            margin-bottom: 12px; 
            border-bottom: 1px solid #444; 
            padding-bottom: 8px; 
        }
       .staff-role { font-size: 0.9rem; color: var(--accent-blue); display:block; margin-bottom:2px;}
       .staff-name { font-size: 1.2rem; font-weight: bold; }
       .staff-ext { font-size: 1rem; color: #888; float: right; }

        /* --- Layer 2: Detailed View (Slider) --- */
        #layer-2-detail {
            position: absolute;
            top: 70px;
            left: 0;
            width: 100%;
            height: calc(100vh - 70px);
            background: var(--bg-dark);
            z-index: 10;
            padding: 20px;
            display: none; /* Hidden by default */
            flex-direction: column;
        }

       .nav-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

       .back-btn {
            background: var(--accent-blue);
            border: none;
            color: #000;
            padding: 12px 25px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
       .back-btn:hover { background: #81d4fa; }

       .detail-content {
            flex: 1;
            background: var(--bg-panel);
            border-radius: var(--border-radius);
            padding: 20px;
            overflow-y: auto;
            border: 1px solid #444;
        }

        /* Data Tables */
        table.data-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        table.data-table th { 
            text-align: left; 
            padding: 15px; 
            background-color: #333; 
            color: var(--accent-blue); 
            font-size: 1.1rem;
            position: sticky; top: 0;
        }
        table.data-table td { 
            text-align: left; 
            padding: 15px; 
            border-bottom: 1px solid #444; 
            font-size: 1.1rem;
        }
        table.data-table tr:hover { background-color: #2a2a2a; }

        /* --- Layer 3: Modal Overlay --- */
        #layer-3-modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 20;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

       .modal-card {
            background: #252525;
            width: 70%;
            height: 80%;
            border-radius: 12px;
            padding: 25px;
            display: flex;
            flex-direction: column;
            border: 1px solid #555;
            box-shadow: 0 0 30px rgba(0,0,0,0.7);
        }
        
       .modal-header { 
            font-size: 1.8rem; 
            border-bottom: 2px solid #444; 
            padding-bottom: 15px; 
            margin-bottom: 20px; 
            display: flex; 
            justify-content: space-between; 
            color: var(--accent-green);
        }
       .close-modal { 
            background: transparent; 
            border: none; 
            color: #fff; 
            font-size: 2rem; 
            cursor: pointer; 
        }

        /* --- Network Error Overlay (Requirement 1.6) --- */
        #network-error {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(50, 0, 0, 0.3); /* Semi-transparent red tint */
            border: 8px solid #d32f2f;
            box-sizing: border-box;
            z-index: 100;
            display: none;
            pointer-events: none; /* Allow underlying data to be seen */
            justify-content: center;
            align-items: flex-start;
            padding-top: 120px;
        }
       .error-box {
            background: #d32f2f;
            color: white;
            padding: 25px 50px;
            font-size: 1.8rem;
            font-weight: bold;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            text-align: center;
            max-width: 80%;
            pointer-events: auto;
        }

        /* --- Simulation Controls --- */
       .sim-controls { 
            position: fixed; bottom: 10px; right: 10px; 
            background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px;
            z-index: 200; 
        }
       .sim-btn {
            background: #444; color: white; border: 1px solid #666;
            padding: 5px 10px; margin: 0 5px; cursor: pointer;
        }
       .sim-btn:hover { background: #666; }

        /* Chart Placeholders */
       .chart-placeholder {
            width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            flex-direction: column;
        }
       .pie-chart {
            width: 120px; height: 120px; border-radius: 50%;
            background: conic-gradient(var(--accent-blue) 0% 60%, var(--accent-red) 60% 80%, #444 80% 100%);
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <header>
        <div class="hospital-logo">
            <span>ğŸ¥ ä¸‰è»ç¸½é†«é™¢</span>
            <span style="font-size: 1.2rem; margin-left: 15px; color: #aaa;">52ç—…æˆ¿è­·ç†ç«™ (é›»å­ç™½æ¿ç³»çµ±)</span>
        </div>
        <div class="marquee-container">
            <div class="marquee-content" id="marquee-text">
                ã€å…¬å‘Šã€‘æœ¬é€±ä¸‰ä¸‹åˆ2é»ç”±è­·ç†é•·å¬é–‹ç—…å®‰æœƒè­°ï¼Œè«‹å„ä½åŒä»æº–æ™‚åƒåŠ ã€‚ | é˜²ç–«æœŸé–“è«‹è½å¯¦æ‰‹éƒ¨è¡›ç”Ÿèˆ‡é…æˆ´å£ç½©ã€‚ | æ­å–œ 52ç—…æˆ¿ æ¦®ç²æœ¬æœˆæœ€ä½³æœå‹™åœ˜éšŠï¼
            </div>
        </div>
        <div class="clock" id="clock">00:00:00</div>
    </header>

    <div id="network-error">
        <div class="error-box">
            ç¶²è·¯ä¸­æ–·ä¸­ï¼Œè«‹ç¨å¾Œå†è©¦ï¼Œå¦‚æœ‰ä»»ä½•å•é¡Œï¼Œè«‹é€£çµ¡è³‡è¨Šçµ„æ©Ÿæˆ¿é›»è©± 88630
        </div>
    </div>

    <div id="layer-1-dashboard">
        <div class="panel staff-list">
            <div class="panel-header">
                <span>ç…§è­·åœ˜éšŠå€¼ç­è¡¨</span>
                <span style="font-size:0.9rem; cursor:pointer;">âœ ç·¨è¼¯</span>
            </div>
            <div id="staff-container">
                </div>
            
            <div style="margin-top: auto; border-top: 1px solid #444; padding-top:15px;">
                <div class="panel-header" style="font-size:1.1rem;">ç—…æˆ¿è¯çµ¡è³‡è¨Š</div>
                <div class="staff-item"><span class="staff-role">å–®ä½æ›¸è¨˜</span><span class="staff-name">æ—é›…å©·</span><span class="staff-ext">1234</span></div>
                <div class="staff-item"><span class="staff-role">ç¤¾å·¥å¸«</span><span class="staff-name">é™³å»ºåœ‹</span><span class="staff-ext">5678</span></div>
                <div class="staff-item"><span class="staff-role">æ©Ÿæˆ¿ç†±ç·š</span><span class="staff-name">è³‡è¨Šçµ„</span><span class="staff-ext">88630</span></div>
            </div>
        </div>

        <div class="panel bed-grid-container" id="bed-grid">
            </div>

        <div class="panel stat-panel" onclick="navigateToLayer2('stats')">
            <div class="panel-header">ç—…æˆ¿å‹•æ…‹ (é»æ“Šè©³æƒ…)</div>
            <div class="chart-placeholder">
                <div class="pie-chart"></div>
                <div style="display:flex; gap:15px; font-size:0.9rem;">
                    <span style="color:var(--accent-blue)">â–  ä½”åºŠ (60%)</span>
                    <span style="color:var(--accent-red)">â–  é å‡º (20%)</span>
                    <span style="color:#666">â–  ç©ºåºŠ (20%)</span>
                </div>
                <div style="margin-top:10px; font-weight:bold;">ä»Šæ—¥å…¥é™¢: 3 | ä»Šæ—¥å‡ºé™¢: 2</div>
            </div>
        </div>

        <div class="panel schedule-panel" onclick="navigateToLayer2('schedule')">
            <div class="panel-header">ä»Šæ—¥æ’ç¨‹ (é»æ“Šè©³æƒ…)</div>
            <ul style="list-style: none; padding: 0; margin: 0;">
                <li style="margin-bottom: 12px; border-left: 4px solid var(--accent-yellow); padding-left: 10px;">
                    <div style="font-size:0.9rem; color:var(--accent-yellow); font-weight:bold;">æ‰‹è¡“ (OP) - 09:00</div>
                    <div>05-01 ç‹Oæ˜ (Laparoscopic...)</div>
                    <div style="color:#888; font-size:0.8rem;">ç‹€æ…‹: æ‰‹è¡“ä¸­</div>
                </li>
                <li style="margin-bottom: 12px; border-left: 4px solid var(--accent-blue); padding-left: 10px;">
                    <div style="font-size:0.9rem; color:var(--accent-blue); font-weight:bold;">æª¢æŸ¥ (CT) - 10:30</div>
                    <div>05-03 æOè¯ (Abdominal CT)</div>
                    <div style="color:#888; font-size:0.8rem;">ç‹€æ…‹: å‚³é€ä¸­</div>
                </li>
                <li style="margin-bottom: 12px; border-left: 4px solid var(--accent-green); padding-left: 10px;">
                    <div style="font-size:0.9rem; color:var(--accent-green); font-weight:bold;">æ´—è… (HD) - 14:00</div>
                    <div>06-02 é™³Oè±ª</div>
                    <div style="color:#888; font-size:0.8rem;">ç‹€æ…‹: å¾…æ’ç¨‹</div>
                </li>
            </ul>
        </div>
    </div>

    <div id="layer-2-detail">
        <div class="nav-bar">
            <button class="back-btn" onclick="backToLayer1()">â¬… è¿”å›ç¸½è¦½å„€è¡¨æ¿</button>
            <div style="font-size:1.5rem; font-weight:bold; color:var(--accent-blue);" id="layer-2-title">è©³ç´°è³‡è¨Š</div>
        </div>
        <div class="detail-content" id="layer-2-content">
            </div>
    </div>

    <div id="layer-3-modal">
        <div class="modal-card">
            <div class="modal-header">
                <span id="modal-title">è©³ç´°è³‡è¨Š</span>
                <button class="close-modal" onclick="closeLayer3()">Ã—</button>
            </div>
            <div id="modal-body" style="flex:1; overflow: auto; display: flex; gap: 20px;">
                </div>
            <div style="margin-top: 20px; padding-top: 10px; border-top: 1px solid #444; display: flex; justify-content: flex-end; gap: 10px;">
                 <button class="sim-btn" style="padding: 10px 20px; background: var(--accent-blue); color: black; border:none; border-radius:5px;">é–‹å•Ÿ PACS å½±åƒ</button>
                 <button class="sim-btn" style="padding: 10px 20px; background: #444; border-radius:5px;">åˆ—å°ç—…æ­·æ‘˜è¦</button>
            </div>
        </div>
    </div>

    <div class="sim-controls">
        <span style="color:#aaa; margin-right:10px;">Demo Controls:</span>
        <button class="sim-btn" onclick="toggleNetwork()">æ¨¡æ“¬ç¶²è·¯ä¸­æ–· (Toggle Network)</button>
        <button class="sim-btn" onclick="randomizeData()">æ›´æ–°æ•¸æ“š (Refresh Data)</button>
    </div>

    <script>
        // --- MOCK DATA GENERATION ---
        const DOCTORS = ["æå¿—è±ª", "å¼µå‰æ–‡", "é™³æ·‘èŠ¬", "æ—æ€¡å›"];
        const NURSES = ["ç‹å°ç¾", "é™³é›…å©·", "æ—æ¬£æ€¡", "å¼µæƒ é›¯"];
        
        // Generating 24 Beds for the Demo (Requirement: 20+ beds)
        const BEDS = Array.from({length: 24}, (_, i) => {
            const bedNum = `05-${(i+1).toString().padStart(2, '0')}`;
            const statusRand = Math.random();
            let status = 'occupied';
            if (statusRand > 0.8) status = 'empty';
            else if (statusRand > 0.7) status = 'cleaning';
            
            const gender = Math.random() > 0.5? 'M' : 'F';
            const nameRaw = gender === 'M'? "ç‹å¤§æ˜" : "æ—å°ç¾";
            const maskedName = nameRaw + "O" + nameRaw; // Privacy Masking
            
            return {
                id: bedNum,
                bed: bedNum,
                status: status,
                name: status === 'occupied'? maskedName : (status === 'cleaning'? 'æ¸…æ½”ä¸­' : 'ç©ºåºŠ'),
                rawName: nameRaw,
                gender: gender,
                mrn: `88${Math.floor(Math.random()*100000)}`,
                doctor: DOCTORS,
                nurse: NURSES,
                admissionDate: "2023/10/25",
                tags: status === 'occupied'?.filter(Boolean) :
            };
        });

        const STAFF_DATA =;

        // --- APP STATE ---
        let isNetworkOnline = true;

        // --- INITIALIZATION ---
        function init() {
            updateClock();
            renderBedGrid();
            renderStaff();
            setInterval(updateClock, 1000);
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleString('zh-TW', { hour12: false });
        }

        // --- RENDERING LAYER 1 ---
        function renderBedGrid() {
            const grid = document.getElementById('bed-grid');
            grid.innerHTML = '';
            BEDS.forEach(bed => {
                const card = document.createElement('div');
                let classes = `bed-card ${bed.status}`;
                if (bed.status === 'occupied') classes += ` ${bed.gender === 'M'? 'male' : 'female'}`;
                if (bed.tags.includes('Iso')) classes += ' isolation';
                
                card.className = classes;
                card.onclick = () => openPatientDetail(bed);

                // Tag Rendering
                let tagsHtml = '';
                if (bed.tags.length > 0) {
                    tagsHtml = bed.tags.map(t => {
                        let label = t; 
                        let cls = 'tag';
                        if (t === 'DNR') { cls += ' dnr'; label = 'DNR'; }
                        if (t === 'Fall') { cls += ' fall'; label = 'è·Œå€’'; }
                        if (t === 'Allergy') { cls += ' allergy'; label = 'éæ•'; }
                        if (t === 'Iso') { cls += ' allergy'; label = 'éš”é›¢'; background='purple'; }
                        return `<span class="${cls}">${label}</span>`;
                    }).join('');
                }

                // Inner Content based on status
                if (bed.status === 'occupied') {
                    card.innerHTML = `
                        <div class="bed-number">${bed.bed}</div>
                        <div class="patient-name">${bed.name}</div>
                        <div class="patient-detail">${bed.doctor}<br>RN: ${bed.nurse}</div>
                        <div class="tags">${tagsHtml}</div>
                    `;
                } else if (bed.status === 'cleaning') {
                    card.innerHTML = `
                        <div class="bed-number">${bed.bed}</div>
                        <div class="patient-name" style="color: var(--status-cleaning);">æ¸…æ½”ä¸­</div>
                        <div class="patient-detail">é è¨ˆå®Œæˆ: 10min</div>
                        <button style="margin-top:auto; background:#555; border:none; color:white; padding:5px;">åˆ·å¡å®Œæˆ</button>
                    `;
                } else {
                    card.innerHTML = `
                        <div class="bed-number">${bed.bed}</div>
                        <div class="patient-name" style="color: #666;">ç©ºåºŠ</div>
                    `;
                }
                grid.appendChild(card);
            });
        }

        function renderStaff() {
            const container = document.getElementById('staff-container');
            container.innerHTML = STAFF_DATA.map(s => `
                <div class="staff-item">
                    <span class="staff-role">${s.role} (${s.type})</span>
                    <span class="staff-name">${s.name}</span>
                    <span class="staff-ext">Ext. ${s.ext}</span>
                </div>
            `).join('');
        }

        // --- NAVIGATION CONTROLLERS (Layers 2 & 3) ---
        
        function navigateToLayer2(view) {
            const layer2 = document.getElementById('layer-2-detail');
            const content = document.getElementById('layer-2-content');
            const title = document.getElementById('layer-2-title');
            
            layer2.style.display = 'flex';
            
            if (view === 'schedule') {
                title.innerText = "ä»Šæ—¥å®Œæ•´æ‰‹è¡“èˆ‡æª¢æŸ¥æ’ç¨‹è¡¨";
                content.innerHTML = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æ™‚é–“</th><th>é¡åˆ¥</th><th>åºŠè™Ÿ</th><th>å§“å</th><th>é …ç›®åç¨±</th><th>åœ°é»</th><th>ç‹€æ…‹</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>08:30</td><td>æ‰‹è¡“</td><td>05-01</td><td>ç‹Oæ˜</td><td>Laparoscopic Cholecystectomy</td><td>OR-03</td><td>é€²è¡Œä¸­</td></tr>
                            <tr><td>09:00</td><td>æª¢æŸ¥</td><td>05-12</td><td>å¼µOæ…¶</td><td>MRI Brain w/o contrast</td><td>MRIå®¤</td><td>å·²å ±åˆ°</td></tr>
                            <tr><td>10:30</td><td>æª¢æŸ¥</td><td>05-03</td><td>æOè¯</td><td>Abdominal CT</td><td>CTå®¤</td><td>å‚³é€ä¸­</td></tr>
                            <tr><td>13:00</td><td>æ´—è…</td><td>06-02</td><td>é™³Oè±ª</td><td>Hemodialysis</td><td>æ´—è…å®¤</td><td>å¾…æ’ç¨‹</td></tr>
                            <tr><td>15:00</td><td>æ‰‹è¡“</td><td>05-08</td><td>æ—Oå©·</td><td>ORIF (Left Femur)</td><td>OR-05</td><td>è¡“å‰æº–å‚™</td></tr>
                        </tbody>
                    </table>
                `;
            } else if (view === 'stats') {
                title.innerText = "ç—…æˆ¿ç®¡ç†çµ±è¨ˆå ±è¡¨ & è­·ç†äººåŠ›é…ç½®";
                content.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="panel">
                            <div class="panel-header">è­·ç†äººåŠ›å‹•æ…‹</div>
                            <div style="font-size:1.2rem;">
                                <p>ç™½ç­æ‡‰åˆ°: 8äºº / å¯¦åˆ°: 8äºº (Leader: é™³æ·‘èŠ¬)</p>
                                <p>å°å¤œé è¨ˆ: 5äºº</p>
                                <p>å¤§å¤œé è¨ˆ: 4äºº</p>
                            </div>
                        </div>
                        <div class="panel">
                            <div class="panel-header">ç—…æˆ¿å“è³ªæŒ‡æ¨™ (Quality Metrics)</div>
                            <p>æœ¬æœˆè·Œå€’ä»¶æ•¸: 0</p>
                            <p>æœ¬æœˆå£“ç˜¡ç™¼ç”Ÿç‡: 0.02%</p>
                            <p>å¹³å‡ä½é™¢å¤©æ•¸: 4.5 å¤©</p>
                        </div>
                        <div class="panel" style="grid-column: 1 / span 2;">
                             <div class="panel-header">å‡ºå…¥é™¢å‹•æ…‹</div>
                             <table class="data-table">
                                <tr><th>é¡åˆ¥</th><th>åºŠè™Ÿ</th><th>å§“å</th><th>ä¸»æ²»é†«å¸«</th><th>å‚™è¨»</th></tr>
                                <tr><td>é è¨ˆå‡ºé™¢</td><td>05-06</td><td>é™³OåŒ</td><td>æé†«å¸«</td><td>ç­‰å¾…æ‰¹åƒ¹</td></tr>
                                <tr><td>é è¨ˆå…¥é™¢</td><td>05-19</td><td>é»ƒOç¾©</td><td>å¼µé†«å¸«</td><td>ç”±æ€¥è¨ºè½‰å…¥</td></tr>
                             </table>
                        </div>
                    </div>
                `;
            }
        }

        function backToLayer1() {
            document.getElementById('layer-2-detail').style.display = 'none';
        }

        function openPatientDetail(bed) {
            if (bed.status === 'empty') return;
            
            const modal = document.getElementById('layer-3-modal');
            document.getElementById('modal-title').innerText = `åºŠä½è©³ç´°è³‡è¨Š: ${bed.bed}`;
            
            const leftCol = `
                <div style="flex: 1;">
                    <h3 style="color:var(--accent-blue); border-bottom:1px solid #444; padding-bottom:10px;">åŸºæœ¬è³‡æ–™</h3>
                    <p><strong>å§“å:</strong> ${bed.name} (${bed.gender})</p>
                    <p><strong>ç—…æ­·è™Ÿ:</strong> ${bed.mrn}</p>
                    <p><strong>ä¸»æ²»é†«å¸«:</strong> ${bed.doctor}</p>
                    <p><strong>ä¸»è²¬è­·ç†:</strong> ${bed.nurse}</p>
                    <p><strong>å…¥é™¢æ—¥æœŸ:</strong> ${bed.admissionDate} (ä½é™¢ç¬¬ 3 å¤©)</p>
                    
                    <h3 style="color:var(--accent-red); border-bottom:1px solid #444; padding-bottom:10px; margin-top:30px;">è‡¨åºŠè­¦ç¤º</h3>
                    <div style="display:flex; gap:10px; flex-wrap:wrap;">
                         ${bed.tags.map(t => `<span class="tag" style="background:var(--accent-red); color:white; padding:8px; font-size:1rem;">${t}</span>`).join('') |

| 'ç„¡ç‰¹æ®Šè¨»è¨˜'}
                    </div>
                </div>
            `;
            
            const rightCol = `
                <div style="flex: 1; border-left:1px solid #444; padding-left:25px;">
                    <h3 style="color:var(--accent-yellow); border-bottom:1px solid #444; padding-bottom:10px;">ä»Šæ—¥é†«å›‘èˆ‡åˆ°æœŸæé†’</h3>
                    <ul style="font-size:1.1rem; line-height:1.8;">
                        <li>âš ï¸ [åˆ°æœŸ] CVC ä¸­å¤®éœè„ˆå°ç®¡ (Day 7)</li>
                        <li>âš ï¸ [åˆ°æœŸ] æŠ—ç”Ÿç´  Vancomycin (Day 14)</li>
                        <li>âœ… 10:00 æ›è—¥ (å·²åŸ·è¡Œ)</li>
                        <li>â¬œ 14:00 è¡€ç³–ç›£æ¸¬ (AC)</li>
                    </ul>
                    
                    <h3 style="color:var(--accent-green); border-bottom:1px solid #444; padding-bottom:10px; margin-top:30px;">å®¶å±¬èˆ‡è¯çµ¡è¨»è¨˜</h3>
                    <p>ä¸»è¦ç…§é¡§è€…: å¤ªå¤ª (0912-345-678)</p>
                    <p>å‚™è¨»: å®¶å±¬è¦æ±‚ç—…æƒ…è§£é‡‹è«‹æ–¼ä¸‹åˆ 5 é»å¾Œã€‚</p>
                </div>
            `;

            document.getElementById('modal-body').innerHTML = leftCol + rightCol;
            modal.style.display = 'flex';
        }

        function closeLayer3() {
            document.getElementById('layer-3-modal').style.display = 'none';
        }

        // --- NETWORK SIMULATION (Toggle) ---
        function toggleNetwork() {
            isNetworkOnline =!isNetworkOnline;
            const overlay = document.getElementById('network-error');
            // Requirement 1.6: Show overlay but KEEP data visible underneath
            if (!isNetworkOnline) {
                overlay.style.display = 'flex';
                document.getElementById('layer-1-dashboard').style.filter = 'grayscale(0.8) blur(2px)'; // Visual cue for stale data
            } else {
                overlay.style.display = 'none';
                document.getElementById('layer-1-dashboard').style.filter = 'none';
            }
        }
        
        function randomizeData() {
            // Reload page to refresh mock data
            location.reload();
        }

        // Start
        init();
    </script>
</body>
</html>